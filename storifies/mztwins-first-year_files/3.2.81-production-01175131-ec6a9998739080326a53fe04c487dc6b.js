!function(e){function t(e,t){return"function"==typeof e?e.call(t):e}function n(t,n){this.$element=e(t),this.options=n,this.enabled=!0,this.fixTitle()}n.prototype={show:function(){var n=this.getTitle();if(n&&this.enabled){var r=this.tip();r.find(".tipsy-inner")[this.options.html?"html":"text"](n),r[0].className="tipsy",r.remove().css({top:0,left:0,visibility:"hidden",display:"block"}).prependTo(document.body);var i,s=e.extend({},this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight}),a=r[0].offsetWidth,o=r[0].offsetHeight,l=t(this.options.gravity,this.$element[0]);switch(l.charAt(0)){case"n":i={top:s.top+s.height+this.options.offset,left:s.left+s.width/2-a/2};break;case"s":i={top:s.top-o-this.options.offset,left:s.left+s.width/2-a/2};break;case"e":i={top:s.top+s.height/2-o/2,left:s.left-a-this.options.offset};break;case"w":i={top:s.top+s.height/2-o/2,left:s.left+s.width+this.options.offset}}2==l.length&&(i.left="w"==l.charAt(1)?s.left+s.width/2-15:s.left+s.width/2-a+15),r.css(i).addClass("tipsy-"+l),r.find(".tipsy-arrow")[0].className="tipsy-arrow tipsy-arrow-"+l.charAt(0),this.options.className&&r.addClass(t(this.options.className,this.$element[0])),this.options.fade?r.stop().css({opacity:0,display:"block",visibility:"visible"}).animate({opacity:this.options.opacity}):r.css({visibility:"visible",opacity:this.options.opacity})}},hide:function(){this.options.fade?this.tip().stop().fadeOut(function(){e(this).remove()}):this.tip().remove()},fixTitle:function(){var e=this.$element;(e.attr("title")||"string"!=typeof e.attr("original-title"))&&e.attr("original-title",e.attr("title")||"").removeAttr("title")},getTitle:function(){var e,t=this.$element,n=this.options;this.fixTitle();var e,n=this.options;return"string"==typeof n.title?e=t.attr("title"==n.title?"original-title":n.title):"function"==typeof n.title&&(e=n.title.call(t[0])),e=(""+e).replace(/(^\s*|\s*$)/,""),e||n.fallback},tip:function(){return this.$tip||(this.$tip=e('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"></div>')),this.$tip},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled}},e.fn.tipsy=function(t){function r(r){var i=e.data(r,"tipsy");return i||(i=new n(r,e.fn.tipsy.elementOptions(r,t)),e.data(r,"tipsy",i)),i}function i(){var e=r(this);e.hoverState="in",0==t.delayIn?e.show():(e.fixTitle(),setTimeout(function(){"in"==e.hoverState&&e.show()},t.delayIn))}function s(){var e=r(this);e.hoverState="out",0==t.delayOut?e.hide():setTimeout(function(){"out"==e.hoverState&&e.hide()},t.delayOut)}if(t===!0)return this.data("tipsy");if("string"==typeof t){var a=this.data("tipsy");return a&&a[t](),this}if(t=e.extend({},e.fn.tipsy.defaults,t),t.live||this.each(function(){r(this)}),"manual"!=t.trigger){var o=t.live?"live":"bind",l="hover"==t.trigger?"mouseenter":"focus",u="hover"==t.trigger?"mouseleave":"blur";this[o](l,i)[o](u,s)}return this},e.fn.tipsy.defaults={className:null,delayIn:0,delayOut:0,fade:!1,fallback:"",gravity:"n",html:!1,live:!1,offset:0,opacity:.8,title:"title",trigger:"hover"},e.fn.tipsy.elementOptions=function(t,n){return e.metadata?e.extend({},n,e(t).metadata()):n},e.fn.tipsy.autoNS=function(){return e(this).offset().top>e(document).scrollTop()+e(window).height()/2?"s":"n"},e.fn.tipsy.autoWE=function(){return e(this).offset().left>e(document).scrollLeft()+e(window).width()/2?"e":"w"},e.fn.tipsy.autoBounds=function(t,n){return function(){var r={ns:n[0],ew:n.length>1?n[1]:!1},i=e(document).scrollTop()+t,s=e(document).scrollLeft()+t,a=e(this);return a.offset().top<i&&(r.ns="n"),a.offset().left<s&&(r.ew="w"),e(window).width()+e(document).scrollLeft()-a.offset().left<t&&(r.ew="e"),e(window).height()+e(document).scrollTop()-a.offset().top<t&&(r.ns="s"),r.ns+(r.ew?r.ew:"")}}}(jQuery),function(e){e.fn.zclip=function(t){if("object"==typeof t&&!t.length){var n=e.extend({path:"ZeroClipboard.swf",copy:null,beforeCopy:null,afterCopy:null,clickAfter:!0,setHandCursor:!0,setCSSEffects:!0},t);return this.each(function(){var t=e(this);if(t.is(":visible")&&("string"==typeof n.copy||e.isFunction(n.copy))){ZeroClipboard.setMoviePath(n.path);var r=new ZeroClipboard.Client;e.isFunction(n.copy)&&t.bind("zClip_copy",n.copy),e.isFunction(n.beforeCopy)&&t.bind("zClip_beforeCopy",n.beforeCopy),e.isFunction(n.afterCopy)&&t.bind("zClip_afterCopy",n.afterCopy),r.setHandCursor(n.setHandCursor),r.setCSSEffects(n.setCSSEffects),r.addEventListener("mouseOver",function(){t.trigger("mouseenter")}),r.addEventListener("mouseOut",function(){t.trigger("mouseleave")}),r.addEventListener("mouseDown",function(){t.trigger("mousedown"),e.isFunction(n.copy)?r.setText(t.triggerHandler("zClip_copy")):r.setText(n.copy),e.isFunction(n.beforeCopy)&&t.trigger("zClip_beforeCopy")}),r.addEventListener("complete",function(r,i){e.isFunction(n.afterCopy)?t.trigger("zClip_afterCopy"):(i.length>500&&(i=i.substr(0,500)+"...\n\n("+(i.length-500)+" characters not shown)"),t.removeClass("hover"),alert("Copied text to clipboard:\n\n "+i)),n.clickAfter&&t.trigger("click")}),r.glue(t[0],t.parent()[0]),e(window).bind("load resize",function(){r.reposition()})}})}return"string"==typeof t?this.each(function(){var n=e(this);t=t.toLowerCase();var r=n.data("zclipId"),i=e("#"+r+".zclip");"remove"==t?(i.remove(),n.removeClass("active hover")):"hide"==t?(i.hide(),n.removeClass("active hover")):"show"==t&&i.show()}):void 0}}(jQuery);var ZeroClipboard={version:"1.0.7",clients:{},moviePath:"ZeroClipboard.swf",nextId:1,$:function(e){return"string"==typeof e&&(e=document.getElementById(e)),e.addClass||(e.hide=function(){this.style.display="none"},e.show=function(){this.style.display=""},e.addClass=function(e){this.removeClass(e),this.className+=" "+e},e.removeClass=function(e){for(var t=this.className.split(/\s+/),n=-1,r=0;r<t.length;r++)t[r]==e&&(n=r,r=t.length);return n>-1&&(t.splice(n,1),this.className=t.join(" ")),this},e.hasClass=function(e){return!!this.className.match(new RegExp("\\s*"+e+"\\s*"))}),e},setMoviePath:function(e){this.moviePath=e},dispatch:function(e,t,n){var r=this.clients[e];r&&r.receiveEvent(t,n)},register:function(e,t){this.clients[e]=t},getDOMObjectPosition:function(e,t){var n={left:0,top:0,width:e.width?e.width:e.offsetWidth,height:e.height?e.height:e.offsetHeight};return e&&e!=t&&(n.left+=e.offsetLeft,n.top+=e.offsetTop),n},Client:function(e){this.handlers={},this.id=ZeroClipboard.nextId++,this.movieId="ZeroClipboardMovie_"+this.id,ZeroClipboard.register(this.id,this),e&&this.glue(e)}};ZeroClipboard.Client.prototype={id:0,ready:!1,movie:null,clipText:"",handCursorEnabled:!0,cssEffects:!0,handlers:null,glue:function(e,t,n){this.domElement=ZeroClipboard.$(e);var r=99;this.domElement.style.zIndex&&(r=parseInt(this.domElement.style.zIndex,10)+1),"string"==typeof t?t=ZeroClipboard.$(t):"undefined"==typeof t&&(t=document.getElementsByTagName("body")[0]);var i=ZeroClipboard.getDOMObjectPosition(this.domElement,t);this.div=document.createElement("div"),this.div.className="zclip",this.div.id="zclip-"+this.movieId,$(this.domElement).data("zclipId","zclip-"+this.movieId);var s=this.div.style;if(s.position="absolute",s.left=""+i.left+"px",s.top=""+i.top+"px",s.width=""+i.width+"px",s.height=""+i.height+"px",s.zIndex=r,"object"==typeof n)for(addedStyle in n)s[addedStyle]=n[addedStyle];t.appendChild(this.div),this.div.innerHTML=this.getHTML(i.width,i.height)},getHTML:function(e,t){var n="",r="id="+this.id+"&width="+e+"&height="+t;if(navigator.userAgent.match(/MSIE/)){var i=location.href.match(/^https/i)?"https://":"http://";n+='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="'+i+'download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="'+e+'" height="'+t+'" id="'+this.movieId+'" align="middle"><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="false" /><param name="movie" value="'+ZeroClipboard.moviePath+'" /><param name="loop" value="false" /><param name="menu" value="false" /><param name="quality" value="best" /><param name="bgcolor" value="#ffffff" /><param name="flashvars" value="'+r+'"/><param name="wmode" value="transparent"/></object>'}else n+='<embed id="'+this.movieId+'" src="'+ZeroClipboard.moviePath+'" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="'+e+'" height="'+t+'" name="'+this.movieId+'" align="middle" allowScriptAccess="always" allowFullScreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+r+'" wmode="transparent" />';return n},hide:function(){this.div&&(this.div.style.left="-2000px")},show:function(){this.reposition()},destroy:function(){if(this.domElement&&this.div){this.hide(),this.div.innerHTML="";var e=document.getElementsByTagName("body")[0];try{e.removeChild(this.div)}catch(t){}this.domElement=null,this.div=null}},reposition:function(e){if(e&&(this.domElement=ZeroClipboard.$(e),this.domElement||this.hide()),this.domElement&&this.div){var t=ZeroClipboard.getDOMObjectPosition(this.domElement),n=this.div.style;n.left=""+t.left+"px",n.top=""+t.top+"px"}},setText:function(e){this.clipText=e,this.ready&&this.movie.setText(e)},addEventListener:function(e,t){e=e.toString().toLowerCase().replace(/^on/,""),this.handlers[e]||(this.handlers[e]=[]),this.handlers[e].push(t)},setHandCursor:function(e){this.handCursorEnabled=e,this.ready&&this.movie.setHandCursor(e)},setCSSEffects:function(e){this.cssEffects=!!e},receiveEvent:function(e,t){switch(e=e.toString().toLowerCase().replace(/^on/,"")){case"load":if(this.movie=document.getElementById(this.movieId),!this.movie){var n=this;return setTimeout(function(){n.receiveEvent("load",null)},1),void 0}if(!this.ready&&navigator.userAgent.match(/Firefox/)&&navigator.userAgent.match(/Windows/)){var n=this;return setTimeout(function(){n.receiveEvent("load",null)},100),this.ready=!0,void 0}this.ready=!0;try{this.movie.setText(this.clipText)}catch(r){}try{this.movie.setHandCursor(this.handCursorEnabled)}catch(r){}break;case"mouseover":this.domElement&&this.cssEffects&&(this.domElement.addClass("hover"),this.recoverActive&&this.domElement.addClass("active"));break;case"mouseout":this.domElement&&this.cssEffects&&(this.recoverActive=!1,this.domElement.hasClass("active")&&(this.domElement.removeClass("active"),this.recoverActive=!0),this.domElement.removeClass("hover"));break;case"mousedown":this.domElement&&this.cssEffects&&this.domElement.addClass("active");break;case"mouseup":this.domElement&&this.cssEffects&&(this.domElement.removeClass("active"),this.recoverActive=!1)}if(this.handlers[e])for(var i=0,s=this.handlers[e].length;s>i;i++){var a=this.handlers[e][i];"function"==typeof a?a(this,t):"object"==typeof a&&2==a.length?a[0][a[1]](this,t):"string"==typeof a&&window[a](this,t)}}},function(e){e.oauthpopup=function(t){if(!t||!t.path)throw new Error("options.path must not be empty");t=e.extend({windowName:"ConnectWithOAuth",windowOptions:"location=0,status=0,width=800,height=400",callback:function(){window.location.reload()}},t);var n=window.open(t.path,t.windowName,t.windowOptions),r=window.setInterval(function(){return n?(n.closed&&(window.clearInterval(r),t.callback()),void 0):(window.clearInterval(r),console&&console.error("Please make sure your browser is allowing popups for this domain"),t.callback(!1))},1e3)}}(jQuery),function(){var e;e=function(){function e(){this.options_index=0,this.parsed=[]}return e.prototype.add_node=function(e){return"OPTGROUP"===e.nodeName?this.add_group(e):this.add_option(e)},e.prototype.add_group=function(e){var t,n,r,i,s,a;for(t=this.parsed.length,this.parsed.push({array_index:t,group:!0,label:e.label,children:0,disabled:e.disabled}),s=e.childNodes,a=[],r=0,i=s.length;i>r;r++)n=s[r],a.push(this.add_option(n,t,e.disabled));return a},e.prototype.add_option=function(e,t,n){return"OPTION"===e.nodeName?(""!==e.text?(null!=t&&(this.parsed[t].children+=1),this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,value:e.value,text:e.text,html:e.innerHTML,selected:e.selected,disabled:n===!0?n:e.disabled,group_array_index:t,classes:e.className,style:e.style.cssText})):this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,empty:!0}),this.options_index+=1):void 0},e}(),e.select_to_array=function(t){var n,r,i,s,a;for(r=new e,a=t.childNodes,i=0,s=a.length;s>i;i++)n=a[i],r.add_node(n);return r.parsed},this.SelectParser=e}.call(this),function(){var e,t;t=this,e=function(){function e(e,t){this.form_field=e,this.options=null!=t?t:{},this.set_default_values(),this.is_multiple=this.form_field.multiple,this.set_default_text(),this.setup(),this.set_up_html(),this.register_observers(),this.finish_setup()}return e.prototype.set_default_values=function(){var e=this;return this.click_test_action=function(t){return e.test_active_click(t)},this.activate_action=function(t){return e.activate_field(t)},this.active_field=!1,this.mouse_on_container=!1,this.results_showing=!1,this.result_highlighted=null,this.result_single_selected=null,this.allow_single_deselect=null!=this.options.allow_single_deselect&&null!=this.form_field.options[0]&&""===this.form_field.options[0].text?this.options.allow_single_deselect:!1,this.disable_search_threshold=this.options.disable_search_threshold||0,this.search_contains=this.options.search_contains||!1,this.choices=0,this.single_backstroke_delete=this.options.single_backstroke_delete||!1,this.max_selected_options=this.options.max_selected_options||1/0},e.prototype.set_default_text=function(){return this.default_text=this.form_field.getAttribute("data-placeholder")?this.form_field.getAttribute("data-placeholder"):this.is_multiple?this.options.placeholder_text_multiple||this.options.placeholder_text||"Select Some Options":this.options.placeholder_text_single||this.options.placeholder_text||"Select an Option",this.results_none_found=this.form_field.getAttribute("data-no_results_text")||this.options.no_results_text||"No results match"},e.prototype.mouse_enter=function(){return this.mouse_on_container=!0},e.prototype.mouse_leave=function(){return this.mouse_on_container=!1},e.prototype.input_focus=function(){var e=this;return this.active_field?void 0:setTimeout(function(){return e.container_mousedown()},50)},e.prototype.input_blur=function(){var e=this;return this.mouse_on_container?void 0:(this.active_field=!1,setTimeout(function(){return e.blur_test()},100))},e.prototype.result_add_option=function(e){var t,n;return e.disabled?"":(e.dom_id=this.container_id+"_o_"+e.array_index,t=e.selected&&this.is_multiple?[]:["active-result"],e.selected&&t.push("result-selected"),null!=e.group_array_index&&t.push("group-option"),""!==e.classes&&t.push(e.classes),n=""!==e.style.cssText?' style="'+e.style+'"':"",'<li id="'+e.dom_id+'" class="'+t.join(" ")+'"'+n+">"+e.html+"</li>")},e.prototype.results_update_field=function(){return this.is_multiple||this.results_reset_cleanup(),this.result_clear_highlight(),this.result_single_selected=null,this.results_build()},e.prototype.results_toggle=function(){return this.results_showing?this.results_hide():this.results_show()},e.prototype.results_search=function(){return this.results_showing?this.winnow_results():this.results_show()},e.prototype.keyup_checker=function(e){var t,n;switch(t=null!=(n=e.which)?n:e.keyCode,this.search_field_scale(),t){case 8:if(this.is_multiple&&this.backstroke_length<1&&this.choices>0)return this.keydown_backstroke();if(!this.pending_backstroke)return this.result_clear_highlight(),this.results_search();break;case 13:if(e.preventDefault(),this.results_showing)return this.result_select(e);break;case 27:return this.results_showing&&this.results_hide(),!0;case 9:case 38:case 40:case 16:case 91:case 17:break;default:return this.results_search()}},e.prototype.generate_field_id=function(){var e;return e=this.generate_random_id(),this.form_field.id=e,e},e.prototype.generate_random_char=function(){var e,t,n;return e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",n=Math.floor(Math.random()*e.length),t=e.substring(n,n+1)},e}(),t.AbstractChosen=e}.call(this),function(){var e,t,n,r,i=Object.prototype.hasOwnProperty,s=function(e,t){function n(){this.constructor=e}for(var r in t)i.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};r=this,e=jQuery,e.fn.extend({chosen:function(n){return!e.browser.msie||"6.0"!==e.browser.version&&"7.0"!==e.browser.version?this.each(function(){var r;return r=e(this),r.hasClass("chzn-done")?void 0:r.data("chosen",new t(this,n))}):this}}),t=function(t){function i(){i.__super__.constructor.apply(this,arguments)}return s(i,t),i.prototype.setup=function(){return this.form_field_jq=e(this.form_field),this.current_value=this.form_field_jq.val(),this.is_rtl=this.form_field_jq.hasClass("chzn-rtl")},i.prototype.finish_setup=function(){return this.form_field_jq.addClass("chzn-done")},i.prototype.set_up_html=function(){var t,r,i,s;return this.container_id=this.form_field.id.length?this.form_field.id.replace(/[^\w]/g,"_"):this.generate_field_id(),this.container_id+="_chzn",this.f_width=this.form_field_jq.outerWidth(),t=e("<div />",{id:this.container_id,"class":"chzn-container"+(this.is_rtl?" chzn-rtl":""),style:"width: "+this.f_width+"px;"}),this.is_multiple?t.html('<ul class="chzn-choices"><li class="search-field"><input type="text" value="'+this.default_text+'" class="default" autocomplete="off" style="width:25px;" /></li></ul><div class="chzn-drop" style="left:-9000px;"><ul class="chzn-results"></ul></div>'):t.html('<a href="javascript:void(0)" class="chzn-single chzn-default"><span>'+this.default_text+'</span><div><b></b></div></a><div class="chzn-drop" style="left:-9000px;"><div class="chzn-search"><input type="text" autocomplete="off" /></div><ul class="chzn-results"></ul></div>'),this.form_field_jq.hide().after(t),this.container=e("#"+this.container_id),this.container.addClass("chzn-container-"+(this.is_multiple?"multi":"single")),this.dropdown=this.container.find("div.chzn-drop").first(),r=this.container.height(),i=this.f_width-n(this.dropdown),this.dropdown.css({width:i+"px",top:r+"px"}),this.search_field=this.container.find("input").first(),this.search_results=this.container.find("ul.chzn-results").first(),this.search_field_scale(),this.search_no_results=this.container.find("li.no-results").first(),this.is_multiple?(this.search_choices=this.container.find("ul.chzn-choices").first(),this.search_container=this.container.find("li.search-field").first()):(this.search_container=this.container.find("div.chzn-search").first(),this.selected_item=this.container.find(".chzn-single").first(),s=i-n(this.search_container)-n(this.search_field),this.search_field.css({width:s+"px"})),this.results_build(),this.set_tab_index(),this.form_field_jq.trigger("liszt:ready",{chosen:this})},i.prototype.register_observers=function(){var e=this;return this.container.mousedown(function(t){return e.container_mousedown(t)}),this.container.mouseup(function(t){return e.container_mouseup(t)}),this.container.mouseenter(function(t){return e.mouse_enter(t)}),this.container.mouseleave(function(t){return e.mouse_leave(t)}),this.search_results.mouseup(function(t){return e.search_results_mouseup(t)}),this.search_results.mouseover(function(t){return e.search_results_mouseover(t)}),this.search_results.mouseout(function(t){return e.search_results_mouseout(t)}),this.form_field_jq.bind("liszt:updated",function(t){return e.results_update_field(t)}),this.search_field.blur(function(t){return e.input_blur(t)}),this.search_field.keyup(function(t){return e.keyup_checker(t)}),this.search_field.keydown(function(t){return e.keydown_checker(t)}),this.is_multiple?(this.search_choices.click(function(t){return e.choices_click(t)}),this.search_field.focus(function(t){return e.input_focus(t)})):this.container.click(function(e){return e.preventDefault()})},i.prototype.search_field_disabled=function(){return this.is_disabled=this.form_field_jq[0].disabled,this.is_disabled?(this.container.addClass("chzn-disabled"),this.search_field[0].disabled=!0,this.is_multiple||this.selected_item.unbind("focus",this.activate_action),this.close_field()):(this.container.removeClass("chzn-disabled"),this.search_field[0].disabled=!1,this.is_multiple?void 0:this.selected_item.bind("focus",this.activate_action))},i.prototype.container_mousedown=function(t){var n;return this.is_disabled?void 0:(n=null!=t?e(t.target).hasClass("search-choice-close"):!1,t&&"mousedown"===t.type&&!this.results_showing&&t.stopPropagation(),this.pending_destroy_click||n?this.pending_destroy_click=!1:(this.active_field?!this.is_multiple&&t&&(e(t.target)[0]===this.selected_item[0]||e(t.target).parents("a.chzn-single").length)&&(t.preventDefault(),this.results_toggle()):(this.is_multiple&&this.search_field.val(""),e(document).click(this.click_test_action),this.results_show()),this.activate_field()))},i.prototype.container_mouseup=function(e){return"ABBR"!==e.target.nodeName||this.is_disabled?void 0:this.results_reset(e)},i.prototype.blur_test=function(){return!this.active_field&&this.container.hasClass("chzn-container-active")?this.close_field():void 0},i.prototype.close_field=function(){return e(document).unbind("click",this.click_test_action),this.is_multiple||(this.selected_item.attr("tabindex",this.search_field.attr("tabindex")),this.search_field.attr("tabindex",-1)),this.active_field=!1,this.results_hide(),this.container.removeClass("chzn-container-active"),this.winnow_results_clear(),this.clear_backstroke(),this.show_search_field_default(),this.search_field_scale()},i.prototype.activate_field=function(){return!this.is_multiple&&!this.active_field&&(this.search_field.attr("tabindex",this.selected_item.attr("tabindex")),this.selected_item.attr("tabindex",-1)),this.container.addClass("chzn-container-active"),this.active_field=!0,this.search_field.val(this.search_field.val()),this.search_field.focus()},i.prototype.test_active_click=function(t){return e(t.target).parents("#"+this.container_id).length?this.active_field=!0:this.close_field()},i.prototype.results_build=function(){var e,t,n,i,s;for(this.parsing=!0,this.results_data=r.SelectParser.select_to_array(this.form_field),this.is_multiple&&this.choices>0?(this.search_choices.find("li.search-choice").remove(),this.choices=0):this.is_multiple||(this.selected_item.addClass("chzn-default").find("span").text(this.default_text),this.form_field.options.length<=this.disable_search_threshold?this.container.addClass("chzn-container-single-nosearch"):this.container.removeClass("chzn-container-single-nosearch")),e="",s=this.results_data,n=0,i=s.length;i>n;n++)t=s[n],t.group?e+=this.result_add_group(t):t.empty||(e+=this.result_add_option(t),t.selected&&this.is_multiple?this.choice_build(t):t.selected&&!this.is_multiple&&(this.selected_item.removeClass("chzn-default").find("span").text(t.text),this.allow_single_deselect&&this.single_deselect_control_build()));return this.search_field_disabled(),this.show_search_field_default(),this.search_field_scale(),this.search_results.html(e),this.parsing=!1},i.prototype.result_add_group=function(t){return t.disabled?"":(t.dom_id=this.container_id+"_g_"+t.array_index,'<li id="'+t.dom_id+'" class="group-result">'+e("<div />").text(t.label).html()+"</li>")},i.prototype.result_do_highlight=function(e){var t,n,r,i,s;if(e.length){if(this.result_clear_highlight(),this.result_highlight=e,this.result_highlight.addClass("highlighted"),r=parseInt(this.search_results.css("maxHeight"),10),s=this.search_results.scrollTop(),i=r+s,n=this.result_highlight.position().top+this.search_results.scrollTop(),t=n+this.result_highlight.outerHeight(),t>=i)return this.search_results.scrollTop(t-r>0?t-r:0);if(s>n)return this.search_results.scrollTop(n)}},i.prototype.result_clear_highlight=function(){return this.result_highlight&&this.result_highlight.removeClass("highlighted"),this.result_highlight=null},i.prototype.results_show=function(){var e;if(this.is_multiple){if(this.max_selected_options<=this.choices)return this.form_field_jq.trigger("liszt:maxselected",{chosen:this}),!1}else this.selected_item.addClass("chzn-single-with-drop"),this.result_single_selected&&this.result_do_highlight(this.result_single_selected);return e=this.is_multiple?this.container.height():this.container.height()-1,this.form_field_jq.trigger("liszt:showing_dropdown",{chosen:this}),this.dropdown.css({top:e+"px",left:0}),this.results_showing=!0,this.search_field.focus(),this.search_field.val(this.search_field.val()),this.winnow_results()},i.prototype.results_hide=function(){return this.is_multiple||this.selected_item.removeClass("chzn-single-with-drop"),this.result_clear_highlight(),this.form_field_jq.trigger("liszt:hiding_dropdown",{chosen:this}),this.dropdown.css({left:"-9000px"}),this.results_showing=!1},i.prototype.set_tab_index=function(){var e;return this.form_field_jq.attr("tabindex")?(e=this.form_field_jq.attr("tabindex"),this.form_field_jq.attr("tabindex",-1),this.is_multiple?this.search_field.attr("tabindex",e):(this.selected_item.attr("tabindex",e),this.search_field.attr("tabindex",-1))):void 0},i.prototype.show_search_field_default=function(){return this.is_multiple&&this.choices<1&&!this.active_field?(this.search_field.val(this.default_text),this.search_field.addClass("default")):(this.search_field.val(""),this.search_field.removeClass("default"))},i.prototype.search_results_mouseup=function(t){var n;return n=e(t.target).hasClass("active-result")?e(t.target):e(t.target).parents(".active-result").first(),n.length?(this.result_highlight=n,this.result_select(t)):void 0},i.prototype.search_results_mouseover=function(t){var n;return n=e(t.target).hasClass("active-result")?e(t.target):e(t.target).parents(".active-result").first(),n?this.result_do_highlight(n):void 0},i.prototype.search_results_mouseout=function(t){return e(t.target).hasClass("active-result")?this.result_clear_highlight():void 0},i.prototype.choices_click=function(t){return t.preventDefault(),!this.active_field||e(t.target).hasClass("search-choice")||this.results_showing?void 0:this.results_show()},i.prototype.choice_build=function(t){var n,r,i=this;return this.is_multiple&&this.max_selected_options<=this.choices?(this.form_field_jq.trigger("liszt:maxselected",{chosen:this}),!1):(n=this.container_id+"_c_"+t.array_index,this.choices+=1,this.search_container.before('<li class="search-choice" id="'+n+'"><span>'+t.html+'</span><a href="javascript:void(0)" class="search-choice-close" rel="'+t.array_index+'"></a></li>'),r=e("#"+n).find("a").first(),r.click(function(e){return i.choice_destroy_link_click(e)}))},i.prototype.choice_destroy_link_click=function(t){return t.preventDefault(),this.is_disabled?t.stopPropagation:(this.pending_destroy_click=!0,this.choice_destroy(e(t.target)))},i.prototype.choice_destroy=function(e){return this.choices-=1,this.show_search_field_default(),this.is_multiple&&this.choices>0&&this.search_field.val().length<1&&this.results_hide(),this.result_deselect(e.attr("rel")),e.parents("li").first().remove()},i.prototype.results_reset=function(){return this.form_field.options[0].selected=!0,this.selected_item.find("span").text(this.default_text),this.is_multiple||this.selected_item.addClass("chzn-default"),this.show_search_field_default(),this.results_reset_cleanup(),this.form_field_jq.trigger("change"),this.active_field?this.results_hide():void 0},i.prototype.results_reset_cleanup=function(){return this.selected_item.find("abbr").remove()},i.prototype.result_select=function(e){var t,n,r,i;return this.result_highlight?(t=this.result_highlight,n=t.attr("id"),this.result_clear_highlight(),this.is_multiple?this.result_deactivate(t):(this.search_results.find(".result-selected").removeClass("result-selected"),this.result_single_selected=t,this.selected_item.removeClass("chzn-default")),t.addClass("result-selected"),i=n.substr(n.lastIndexOf("_")+1),r=this.results_data[i],r.selected=!0,this.form_field.options[r.options_index].selected=!0,this.is_multiple?this.choice_build(r):(this.selected_item.find("span").first().text(r.text),this.allow_single_deselect&&this.single_deselect_control_build()),(!e.metaKey||!this.is_multiple)&&this.results_hide(),this.search_field.val(""),(this.is_multiple||this.form_field_jq.val()!==this.current_value)&&this.form_field_jq.trigger("change",{selected:this.form_field.options[r.options_index].value}),this.current_value=this.form_field_jq.val(),this.search_field_scale()):void 0},i.prototype.result_activate=function(e){return e.addClass("active-result")},i.prototype.result_deactivate=function(e){return e.removeClass("active-result")},i.prototype.result_deselect=function(t){var n,r;return r=this.results_data[t],r.selected=!1,this.form_field.options[r.options_index].selected=!1,n=e("#"+this.container_id+"_o_"+t),n.removeClass("result-selected").addClass("active-result").show(),this.result_clear_highlight(),this.winnow_results(),this.form_field_jq.trigger("change",{deselected:this.form_field.options[r.options_index].value}),this.search_field_scale()},i.prototype.single_deselect_control_build=function(){return this.allow_single_deselect&&this.selected_item.find("abbr").length<1?this.selected_item.find("span").first().after('<abbr class="search-choice-close"></abbr>'):void 0},i.prototype.winnow_results=function(){var t,n,r,i,s,a,o,l,u,c,d,f,h,p,m,g,v,y;for(this.no_results_clear(),u=0,c=this.search_field.val()===this.default_text?"":e("<div/>").text(e.trim(this.search_field.val())).html(),a=this.search_contains?"":"^",s=new RegExp(a+c.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"i"),h=new RegExp(c.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"i"),y=this.results_data,p=0,g=y.length;g>p;p++)if(n=y[p],!n.disabled&&!n.empty)if(n.group)e("#"+n.dom_id).css("display","none");else if(!this.is_multiple||!n.selected){if(t=!1,l=n.dom_id,o=e("#"+l),s.test(n.html))t=!0,u+=1;else if((n.html.indexOf(" ")>=0||0===n.html.indexOf("["))&&(i=n.html.replace(/\[|\]/g,"").split(" "),i.length))for(m=0,v=i.length;v>m;m++)r=i[m],s.test(r)&&(t=!0,u+=1);t?(c.length?(d=n.html.search(h),f=n.html.substr(0,d+c.length)+"</em>"+n.html.substr(d+c.length),f=f.substr(0,d)+"<em>"+f.substr(d)):f=n.html,o.html(f),this.result_activate(o),null!=n.group_array_index&&e("#"+this.results_data[n.group_array_index].dom_id).css("display","list-item")):(this.result_highlight&&l===this.result_highlight.attr("id")&&this.result_clear_highlight(),this.result_deactivate(o))}return 1>u&&c.length?this.no_results(c):this.winnow_results_set_highlight()},i.prototype.winnow_results_clear=function(){var t,n,r,i,s;for(this.search_field.val(""),n=this.search_results.find("li"),s=[],r=0,i=n.length;i>r;r++)t=n[r],t=e(t),t.hasClass("group-result")?s.push(t.css("display","auto")):this.is_multiple&&t.hasClass("result-selected")?s.push(void 0):s.push(this.result_activate(t));return s},i.prototype.winnow_results_set_highlight=function(){var e,t;return this.result_highlight||(t=this.is_multiple?[]:this.search_results.find(".result-selected.active-result"),e=t.length?t.first():this.search_results.find(".active-result").first(),null==e)?void 0:this.result_do_highlight(e)},i.prototype.no_results=function(t){var n;return n=e('<li class="no-results">'+this.results_none_found+' "<span></span>"</li>'),n.find("span").first().html(t),this.search_results.append(n)},i.prototype.no_results_clear=function(){return this.search_results.find(".no-results").remove()},i.prototype.keydown_arrow=function(){var t,n;return this.result_highlight?this.results_showing&&(n=this.result_highlight.nextAll("li.active-result").first(),n&&this.result_do_highlight(n)):(t=this.search_results.find("li.active-result").first(),t&&this.result_do_highlight(e(t))),this.results_showing?void 0:this.results_show()},i.prototype.keyup_arrow=function(){var e;return this.results_showing||this.is_multiple?this.result_highlight?(e=this.result_highlight.prevAll("li.active-result"),e.length?this.result_do_highlight(e.first()):(this.choices>0&&this.results_hide(),this.result_clear_highlight())):void 0:this.results_show()
},i.prototype.keydown_backstroke=function(){return this.pending_backstroke?(this.choice_destroy(this.pending_backstroke.find("a").first()),this.clear_backstroke()):(this.pending_backstroke=this.search_container.siblings("li.search-choice").last(),this.single_backstroke_delete?this.keydown_backstroke():this.pending_backstroke.addClass("search-choice-focus"))},i.prototype.clear_backstroke=function(){return this.pending_backstroke&&this.pending_backstroke.removeClass("search-choice-focus"),this.pending_backstroke=null},i.prototype.keydown_checker=function(e){var t,n;switch(t=null!=(n=e.which)?n:e.keyCode,this.search_field_scale(),8!==t&&this.pending_backstroke&&this.clear_backstroke(),t){case 8:this.backstroke_length=this.search_field.val().length;break;case 9:this.results_showing&&!this.is_multiple&&this.result_select(e),this.mouse_on_container=!1;break;case 13:e.preventDefault();break;case 38:e.preventDefault(),this.keyup_arrow();break;case 40:this.keydown_arrow()}},i.prototype.search_field_scale=function(){var t,n,r,i,s,a,o,l,u;if(this.is_multiple){for(r=0,o=0,s="position:absolute; left: -1000px; top: -1000px; display:none;",a=["font-size","font-style","font-weight","font-family","line-height","text-transform","letter-spacing"],l=0,u=a.length;u>l;l++)i=a[l],s+=i+":"+this.search_field.css(i)+";";return n=e("<div />",{style:s}),n.text(this.search_field.val()),e("body").append(n),o=n.width()+25,n.remove(),o>this.f_width-10&&(o=this.f_width-10),this.search_field.css({width:o+"px"}),t=this.container.height(),this.dropdown.css({top:t+"px"})}},i.prototype.generate_random_id=function(){var t;for(t="sel"+this.generate_random_char()+this.generate_random_char()+this.generate_random_char();e("#"+t).length>0;)t+=this.generate_random_char();return t},i}(AbstractChosen),n=function(e){var t;return t=e.outerWidth()-e.width()},r.get_side_border_padding=n}.call(this),function(e,t){"use strict";var n,r=t.event,i=t.event.handle?"handle":"dispatch";r.special.smartresize={setup:function(){t(this).bind("resize",r.special.smartresize.handler)},teardown:function(){t(this).unbind("resize",r.special.smartresize.handler)},handler:function(e,t){var s=this,a=arguments;e.type="smartresize",n&&clearTimeout(n),n=setTimeout(function(){r[i].apply(s,a)},"execAsap"===t?0:100)}},t.fn.smartresize=function(e){return e?this.bind("smartresize",e):this.trigger("smartresize",["execAsap"])},t.Mason=function(e,n){this.element=t(n),this._create(e),this._init()},t.Mason.settings={isResizable:!0,isAnimated:!1,animationOptions:{queue:!1,duration:500},gutterWidth:0,isRTL:!1,isFitWidth:!1,containerStyle:{position:"relative"}},t.Mason.prototype={_filterFindBricks:function(e){var t=this.options.itemSelector;return t?e.filter(t).add(e.find(t)):e},_getBricks:function(e){var t=this._filterFindBricks(e).css({position:"absolute"}).addClass("masonry-brick");return t},_create:function(n){this.options=t.extend(!0,{},t.Mason.settings,n),this.styleQueue=[];var r=this.element[0].style;this.originalStyle={height:r.height||""};var i=this.options.containerStyle;for(var s in i)this.originalStyle[s]=r[s]||"";this.element.css(i),this.horizontalDirection=this.options.isRTL?"right":"left";var a=this.element.css("padding-"+this.horizontalDirection),o=this.element.css("padding-top");this.offset={x:a?parseInt(a,10):0,y:o?parseInt(o,10):0},this.isFluid=this.options.columnWidth&&"function"==typeof this.options.columnWidth;var l=this;setTimeout(function(){l.element.addClass("masonry")},0),this.options.isResizable&&t(e).bind("smartresize.masonry",function(){l.resize()}),this.reloadItems()},_init:function(e){this._getColumns(),this._reLayout(e)},option:function(e){t.isPlainObject(e)&&(this.options=t.extend(!0,this.options,e))},layout:function(e,t){for(var n=0,r=e.length;r>n;n++)this._placeBrick(e[n]);var i={};if(i.height=Math.max.apply(Math,this.colYs),this.options.isFitWidth){var s=0;for(n=this.cols;--n&&0===this.colYs[n];)s++;i.width=(this.cols-s)*this.columnWidth-this.options.gutterWidth}this.styleQueue.push({$el:this.element,style:i});var a,o=this.isLaidOut?this.options.isAnimated?"animate":"css":"css",l=this.options.animationOptions;for(n=0,r=this.styleQueue.length;r>n;n++)a=this.styleQueue[n],a.$el[o](a.style,l);this.styleQueue=[],t&&t.call(e),this.isLaidOut=!0},_getColumns:function(){var e=this.options.isFitWidth?this.element.parent():this.element,t=e.width();this.columnWidth=this.isFluid?this.options.columnWidth(t):this.options.columnWidth||this.$bricks.outerWidth(!0)||t,this.columnWidth+=this.options.gutterWidth,this.cols=Math.floor((t+this.options.gutterWidth)/this.columnWidth),this.cols=Math.max(this.cols,1)},_placeBrick:function(e){var n,r,i,s,a,o=t(e);if(n=Math.ceil(o.outerWidth(!0)/this.columnWidth),n=Math.min(n,this.cols),1===n)i=this.colYs;else for(r=this.cols+1-n,i=[],a=0;r>a;a++)s=this.colYs.slice(a,a+n),i[a]=Math.max.apply(Math,s);for(var l=Math.min.apply(Math,i),u=0,c=0,d=i.length;d>c;c++)if(i[c]===l){u=c;break}var f={top:l+this.offset.y};f[this.horizontalDirection]=this.columnWidth*u+this.offset.x,this.styleQueue.push({$el:o,style:f});var h=l+o.outerHeight(!0),p=this.cols+1-d;for(c=0;p>c;c++)this.colYs[u+c]=h},resize:function(){var e=this.cols;this._getColumns(),(this.isFluid||this.cols!==e)&&this._reLayout()},_reLayout:function(e){var t=this.cols;for(this.colYs=[];t--;)this.colYs.push(0);this.layout(this.$bricks,e)},reloadItems:function(){this.$bricks=this._getBricks(this.element.children())},reload:function(e){this.reloadItems(),this._init(e)},appended:function(e,t,n){if(t){this._filterFindBricks(e).css({top:this.element.height()});var r=this;setTimeout(function(){r._appended(e,n)},1)}else this._appended(e,n)},_appended:function(e,t){var n=this._getBricks(e);this.$bricks=this.$bricks.add(n),this.layout(n,t)},remove:function(e){this.$bricks=this.$bricks.not(e),e.remove()},destroy:function(){this.$bricks.removeClass("masonry-brick").each(function(){this.style.position="",this.style.top="",this.style.left=""});var n=this.element[0].style;for(var r in this.originalStyle)n[r]=this.originalStyle[r];this.element.unbind(".masonry").removeClass("masonry").removeData("masonry"),t(e).unbind(".masonry")}},t.fn.imagesLoaded=function(e){function n(){e.call(i,s)}function r(e){var i=e.target;i.src!==o&&-1===t.inArray(i,l)&&(l.push(i),--a<=0&&(setTimeout(n),s.unbind(".imagesLoaded",r)))}var i=this,s=i.find("img").add(i.filter("img")),a=s.length,o="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",l=[];return a||n(),s.bind("load.imagesLoaded error.imagesLoaded",r).each(function(){var e=this.src;this.src=o,this.src=e}),i};var s=function(t){e.console&&e.console.error(t)};t.fn.masonry=function(e){if("string"==typeof e){var n=Array.prototype.slice.call(arguments,1);this.each(function(){var r=t.data(this,"masonry");return r?t.isFunction(r[e])&&"_"!==e.charAt(0)?(r[e].apply(r,n),void 0):(s("no such method '"+e+"' for masonry instance"),void 0):(s("cannot call methods on masonry prior to initialization; attempted to call method '"+e+"'"),void 0)})}else this.each(function(){var n=t.data(this,"masonry");n?(n.option(e||{}),n._init()):t.data(this,"masonry",new t.Mason(e,this))});return this}}(window,jQuery),function(e){function t(e){return"object"==typeof e?e:{top:e,left:e}}var n=e.scrollTo=function(t,n,r){e(window).scrollTo(t,n,r)};n.defaults={axis:"xy",duration:parseFloat(e.fn.jquery)>=1.3?0:1,limit:!0},n.window=function(){return e(window)._scrollable()},e.fn._scrollable=function(){return this.map(function(){var t=this,n=!t.nodeName||-1!=e.inArray(t.nodeName.toLowerCase(),["iframe","#document","html","body"]);if(!n)return t;var r=(t.contentWindow||t).document||t.ownerDocument||t;return/webkit/i.test(navigator.userAgent)||"BackCompat"==r.compatMode?r.body:r.documentElement})},e.fn.scrollTo=function(r,i,s){return"object"==typeof i&&(s=i,i=0),"function"==typeof s&&(s={onAfter:s}),"max"==r&&(r=9e9),s=e.extend({},n.defaults,s),i=i||s.duration,s.queue=s.queue&&s.axis.length>1,s.queue&&(i/=2),s.offset=t(s.offset),s.over=t(s.over),this._scrollable().each(function(){function a(e){u.animate(d,i,s.easing,e&&function(){e.call(this,r,s)})}if(null!=r){var o,l=this,u=e(l),c=r,d={},f=u.is("html,body");switch(typeof c){case"number":case"string":if(/^([+-]=)?\d+(\.\d+)?(px|%)?$/.test(c)){c=t(c);break}if(c=e(c,this),!c.length)return;case"object":(c.is||c.style)&&(o=(c=e(c)).offset())}e.each(s.axis.split(""),function(e,t){var r="x"==t?"Left":"Top",i=r.toLowerCase(),h="scroll"+r,p=l[h],m=n.max(l,t);if(o)d[h]=o[i]+(f?0:p-u.offset()[i]),s.margin&&(d[h]-=parseInt(c.css("margin"+r))||0,d[h]-=parseInt(c.css("border"+r+"Width"))||0),d[h]+=s.offset[i]||0,s.over[i]&&(d[h]+=c["x"==t?"width":"height"]()*s.over[i]);else{var g=c[i];d[h]=g.slice&&"%"==g.slice(-1)?parseFloat(g)/100*m:g}s.limit&&/^\d+$/.test(d[h])&&(d[h]=d[h]<=0?0:Math.min(d[h],m)),!e&&s.queue&&(p!=d[h]&&a(s.onAfterFirst),delete d[h])}),a(s.onAfter)}}).end()},n.max=function(t,n){var r="x"==n?"Width":"Height",i="scroll"+r;if(!e(t).is("html,body"))return t[i]-e(t)[r.toLowerCase()]();var s="client"+r,a=t.ownerDocument.documentElement,o=t.ownerDocument.body;return Math.max(a[i],o[i])-Math.min(a[s],o[s])}}(jQuery),window.Modernizr=function(e,t,n){function r(e){b.cssText=e}function i(e,t){return r(_.join(e+";")+(t||""))}function s(e,t){return typeof e===t}function a(e,t){return!!~(""+e).indexOf(t)}function o(e,t){for(var r in e){var i=e[r];if(!a(i,"-")&&b[i]!==n)return"pfx"==t?i:!0}return!1}function l(e,t,r){for(var i in e){var a=t[e[i]];if(a!==n)return r===!1?e[i]:s(a,"function")?a.bind(r||t):a}return!1}function u(e,t,n){var r=e.charAt(0).toUpperCase()+e.slice(1),i=(e+" "+C.join(r+" ")+r).split(" ");return s(t,"string")||s(t,"undefined")?o(i,t):(i=(e+" "+S.join(r+" ")+r).split(" "),l(i,t,n))}function c(){p.input=function(n){for(var r=0,i=n.length;i>r;r++)N[n[r]]=n[r]in w;return N.list&&(N.list=!!t.createElement("datalist")&&!!e.HTMLDataListElement),N}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" "))}var d,f,h="2.6.2",p={},m=!0,g=t.documentElement,v="modernizr",y=t.createElement(v),b=y.style,w=t.createElement("input"),x=":)",_=({}.toString," -webkit- -moz- -o- -ms- ".split(" ")),k="Webkit Moz O ms",C=k.split(" "),S=k.toLowerCase().split(" "),T={},N={},E=[],A=E.slice,j=function(e,n,r,i){var s,a,o,l,u=t.createElement("div"),c=t.body,d=c||t.createElement("body");if(parseInt(r,10))for(;r--;)o=t.createElement("div"),o.id=i?i[r]:v+(r+1),u.appendChild(o);return s=["&#173;",'<style id="s',v,'">',e,"</style>"].join(""),u.id=v,(c?u:d).innerHTML+=s,d.appendChild(u),c||(d.style.background="",d.style.overflow="hidden",l=g.style.overflow,g.style.overflow="hidden",g.appendChild(d)),a=n(u,e),c?u.parentNode.removeChild(u):(d.parentNode.removeChild(d),g.style.overflow=l),!!a},D=function(t){var n=e.matchMedia||e.msMatchMedia;if(n)return n(t).matches;var r;return j("@media "+t+" { #"+v+" { position: absolute; } }",function(t){r="absolute"==(e.getComputedStyle?getComputedStyle(t,null):t.currentStyle).position}),r},$={}.hasOwnProperty;f=s($,"undefined")||s($.call,"undefined")?function(e,t){return t in e&&s(e.constructor.prototype[t],"undefined")}:function(e,t){return $.call(e,t)},Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;if("function"!=typeof t)throw new TypeError;var n=A.call(arguments,1),r=function(){if(this instanceof r){var i=function(){};i.prototype=t.prototype;var s=new i,a=t.apply(s,n.concat(A.call(arguments)));return Object(a)===a?a:s}return t.apply(e,n.concat(A.call(arguments)))};return r}),T.flexbox=function(){return u("flexWrap")},T.rgba=function(){return r("background-color:rgba(150,255,150,.5)"),a(b.backgroundColor,"rgba")},T.backgroundsize=function(){return u("backgroundSize")},T.borderradius=function(){return u("borderRadius")},T.opacity=function(){return i("opacity:.55"),/^0.55$/.test(b.opacity)},T.cssgradients=function(){var e="background-image:",t="gradient(linear,left top,right bottom,from(#9f9),to(white));",n="linear-gradient(left top,#9f9, white);";return r((e+"-webkit- ".split(" ").join(t+e)+_.join(n+e)).slice(0,-e.length)),a(b.backgroundImage,"gradient")},T.generatedcontent=function(){var e;return j(["#",v,"{font:0/0 a}#",v,':after{content:"',x,'";visibility:hidden;font:3px/1 a}'].join(""),function(t){e=t.offsetHeight>=3}),e};for(var M in T)f(T,M)&&(d=M.toLowerCase(),p[d]=T[M](),E.push((p[d]?"":"no-")+d));return p.input||c(),p.addTest=function(e,t){if("object"==typeof e)for(var r in e)f(e,r)&&p.addTest(r,e[r]);else{if(e=e.toLowerCase(),p[e]!==n)return p;t="function"==typeof t?t():t,"undefined"!=typeof m&&m&&(g.className+=" "+(t?"":"no-")+e),p[e]=t}return p},r(""),y=w=null,function(e,t){function n(e,t){var n=e.createElement("p"),r=e.getElementsByTagName("head")[0]||e.documentElement;return n.innerHTML="x<style>"+t+"</style>",r.insertBefore(n.lastChild,r.firstChild)}function r(){var e=v.elements;return"string"==typeof e?e.split(" "):e}function i(e){var t=g[e[p]];return t||(t={},m++,e[p]=m,g[m]=t),t}function s(e,n,r){if(n||(n=t),c)return n.createElement(e);r||(r=i(n));var s;return s=r.cache[e]?r.cache[e].cloneNode():h.test(e)?(r.cache[e]=r.createElem(e)).cloneNode():r.createElem(e),s.canHaveChildren&&!f.test(e)?r.frag.appendChild(s):s}function a(e,n){if(e||(e=t),c)return e.createDocumentFragment();n=n||i(e);for(var s=n.frag.cloneNode(),a=0,o=r(),l=o.length;l>a;a++)s.createElement(o[a]);return s}function o(e,t){t.cache||(t.cache={},t.createElem=e.createElement,t.createFrag=e.createDocumentFragment,t.frag=t.createFrag()),e.createElement=function(n){return v.shivMethods?s(n,e,t):t.createElem(n)},e.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+r().join().replace(/\w+/g,function(e){return t.createElem(e),t.frag.createElement(e),'c("'+e+'")'})+");return n}")(v,t.frag)}function l(e){e||(e=t);var r=i(e);return v.shivCSS&&!u&&!r.hasCSS&&(r.hasCSS=!!n(e,"article,aside,figcaption,figure,footer,header,hgroup,nav,section{display:block}mark{background:#FF0;color:#000}")),c||o(e,r),e}var u,c,d=e.html5||{},f=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,h=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,p="_html5shiv",m=0,g={};!function(){try{var e=t.createElement("a");e.innerHTML="<xyz></xyz>",u="hidden"in e,c=1==e.childNodes.length||function(){t.createElement("a");var e=t.createDocumentFragment();return"undefined"==typeof e.cloneNode||"undefined"==typeof e.createDocumentFragment||"undefined"==typeof e.createElement}()}catch(n){u=!0,c=!0}}();var v={elements:d.elements||"abbr article aside audio bdi canvas data datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video",shivCSS:d.shivCSS!==!1,supportsUnknownElements:c,shivMethods:d.shivMethods!==!1,type:"default",shivDocument:l,createElement:s,createDocumentFragment:a};e.html5=v,l(t)}(this,t),p._version=h,p._prefixes=_,p._domPrefixes=S,p._cssomPrefixes=C,p.mq=D,p.testProp=function(e){return o([e])},p.testAllProps=u,p.testStyles=j,g.className=g.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(m?" js "+E.join(" "):""),p}(this,this.document),function(e,t,n){function r(e){return"[object Function]"==g.call(e)}function i(e){return"string"==typeof e}function s(){}function a(e){return!e||"loaded"==e||"complete"==e||"uninitialized"==e}function o(){var e=v.shift();y=1,e?e.t?p(function(){("c"==e.t?f.injectCss:f.injectJs)(e.s,0,e.a,e.x,e.e,1)},0):(e(),o()):y=0}function l(e,n,r,i,s,l,u){function c(t){if(!h&&a(d.readyState)&&(b.r=h=1,!y&&o(),d.onload=d.onreadystatechange=null,t)){"img"!=e&&p(function(){x.removeChild(d)},50);for(var r in T[n])T[n].hasOwnProperty(r)&&T[n][r].onload()}}var u=u||f.errorTimeout,d=t.createElement(e),h=0,g=0,b={t:r,s:n,e:s,a:l,x:u};1===T[n]&&(g=1,T[n]=[]),"object"==e?d.data=n:(d.src=n,d.type=e),d.width=d.height="0",d.onerror=d.onload=d.onreadystatechange=function(){c.call(this,g)},v.splice(i,0,b),"img"!=e&&(g||2===T[n]?(x.insertBefore(d,w?null:m),p(c,u)):T[n].push(d))}function u(e,t,n,r,s){return y=0,t=t||"j",i(e)?l("c"==t?k:_,e,t,this.i++,n,r,s):(v.splice(this.i++,0,e),1==v.length&&o()),this}function c(){var e=f;return e.loader={load:u,i:0},e}var d,f,h=t.documentElement,p=e.setTimeout,m=t.getElementsByTagName("script")[0],g={}.toString,v=[],y=0,b="MozAppearance"in h.style,w=b&&!!t.createRange().compareNode,x=w?h:m.parentNode,h=e.opera&&"[object Opera]"==g.call(e.opera),h=!!t.attachEvent&&!h,_=b?"object":h?"script":"img",k=h?"script":_,C=Array.isArray||function(e){return"[object Array]"==g.call(e)},S=[],T={},N={timeout:function(e,t){return t.length&&(e.timeout=t[0]),e}};f=function(e){function t(e){var t,n,r,e=e.split("!"),i=S.length,s=e.pop(),a=e.length,s={url:s,origUrl:s,prefixes:e};for(n=0;a>n;n++)r=e[n].split("="),(t=N[r.shift()])&&(s=t(s,r));for(n=0;i>n;n++)s=S[n](s);return s}function a(e,i,s,a,o){var l=t(e),u=l.autoCallback;l.url.split(".").pop().split("?").shift(),l.bypass||(i&&(i=r(i)?i:i[e]||i[a]||i[e.split("/").pop().split("?")[0]]),l.instead?l.instead(e,i,s,a,o):(T[l.url]?l.noexec=!0:T[l.url]=1,s.load(l.url,l.forceCSS||!l.forceJS&&"css"==l.url.split(".").pop().split("?").shift()?"c":n,l.noexec,l.attrs,l.timeout),(r(i)||r(u))&&s.load(function(){c(),i&&i(l.origUrl,o,a),u&&u(l.origUrl,o,a),T[l.url]=2})))}function o(e,t){function n(e,n){if(e){if(i(e))n||(d=function(){var e=[].slice.call(arguments);f.apply(this,e),h()}),a(e,d,t,0,u);else if(Object(e)===e)for(l in o=function(){var t,n=0;for(t in e)e.hasOwnProperty(t)&&n++;return n}(),e)e.hasOwnProperty(l)&&(!n&&!--o&&(r(d)?d=function(){var e=[].slice.call(arguments);f.apply(this,e),h()}:d[l]=function(e){return function(){var t=[].slice.call(arguments);e&&e.apply(this,t),h()}}(f[l])),a(e[l],d,t,l,u))}else!n&&h()}var o,l,u=!!e.test,c=e.load||e.both,d=e.callback||s,f=d,h=e.complete||s;n(u?e.yep:e.nope,!!c),c&&n(c)}var l,u,d=this.yepnope.loader;if(i(e))a(e,0,d,0);else if(C(e))for(l=0;l<e.length;l++)u=e[l],i(u)?a(u,0,d,0):C(u)?f(u):Object(u)===u&&o(u,d);else Object(e)===e&&o(e,d)},f.addPrefix=function(e,t){N[e]=t},f.addFilter=function(e){S.push(e)},f.errorTimeout=1e4,null==t.readyState&&t.addEventListener&&(t.readyState="loading",t.addEventListener("DOMContentLoaded",d=function(){t.removeEventListener("DOMContentLoaded",d,0),t.readyState="complete"},0)),e.yepnope=c(),e.yepnope.executeStack=o,e.yepnope.injectJs=function(e,n,r,i,l,u){var c,d,h=t.createElement("script"),i=i||f.errorTimeout;h.src=e;for(d in r)h.setAttribute(d,r[d]);n=u?o:n||s,h.onreadystatechange=h.onload=function(){!c&&a(h.readyState)&&(c=1,n(),h.onload=h.onreadystatechange=null)},p(function(){c||(c=1,n(1))},i),l?h.onload():m.parentNode.insertBefore(h,m)},e.yepnope.injectCss=function(e,n,r,i,a,l){var u,i=t.createElement("link"),n=l?o:n||s;i.href=e,i.rel="stylesheet",i.type="text/css";for(u in r)i.setAttribute(u,r[u]);a||(m.parentNode.insertBefore(i,m),p(n,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))},s.Button=s.Class.extend({initialize:function(e,t){return this.options={toggle:!1,activeClass:"active"},this.setOptions(t),this.button=$(e),this.options.title&&this.button.attr("title",this.options.title),this.button.bind("mousedown.button",_.bind(this.mousedown,this)),this.button.bind("click.button",_.bind(this.click,this)),this},mousedown:function(e){return this.options.mousedown&&this.options.mousedown(e),this},click:function(e){return e.preventDefault(),this.disabled?!1:(this.options.click&&this.options.click(e),this.options.toggle&&this.toggle(e),this)},activate:function(e){return this.options.activate&&!this.options.activate(e)?!1:(this.button.addClass(this.options.activeClass),this)},deactivate:function(e){return this.options.deactivate&&!this.options.deactivate(e)?!1:(this.button.removeClass(this.options.activeClass),this)},enable:function(){return this.disabled=!1,this.button.removeAttr("disabled"),this},disable:function(){return this.disabled=!0,this.button.attr("disabled","disabled"),this},hide:function(){return this.button.hide(),this},show:function(){return this.button.show(),this},toggle:function(e){return this.active()?this.deactivate(e):this.activate(e),this},active:function(){return this.button.hasClass(this.options.activeClass)}}),s.Dropdown=s.Button.extend({initialize:function(e,t,n){n=n||{},n.toggle=!0,this.supr(e,n),this.menu=$(t),this._menu=t},setPosition:function(){var e=this.options.gap?this.options.gap:0;return this.menu.css({top:this.button.position().top+this.button.outerHeight()+e,minWidth:this.button.innerWidth()+"px"}),this.options.right&&this.menu.css({right:this.options.right}),this},activate:function(e){var t=this;return e&&e.stopPropagation(),this.supr(e)?(this.menu.addClass(this.options.activeClass).show(),$(this.button).trigger("click.dropdown"),_.defer(function(){$(window).bind("click.dropdown keyup.dropdown",_.bind(t.deactivate,t))}),this):!1},deactivate:function(e){if(e){if(this.options.exceptionId&&$(e.target).attr("id")===this.options.exceptionId)return;if(!(e.currentTarget==this.button[0]||e.keyCode&&27==e.keyCode||0==this.menu.find(e.target).length||this.options.isList&&this.menu.find($(e.target).parent()).length>0))return;$(window).unbind(e)}else $(window).unbind();return this.supr(e)?(this.menu.removeClass(this.options.activeClass).hide(),this):!1},hide:function(){return this.menu.hide(),this.button.hide(),this},show:function(){return this.button.show(),this.setPosition(),this}}),s.Modal=s.Class.extend({overlayId:"#page-overlay",initialize:function(e,t){this.options={closeable:!0},this.setOptions(t),this.modal=$(e),this.overlay=$(this.overlayId),this.overlay.length||(this.overlay=$("<div>").attr("id",this.overlayId),$("body").append(this.overlay)),$("body").append(this.modal),_.bindAll(this,"hide"),this.options.closeable&&(this.closeBtn=this.modal.find(".close-x, .close, .skip"),this.closeBtn.live("click touchend",this.hide))},hide:function(e){if(e){if("keydown"==e.type){if(27!=e.keyCode)return;$(window).unbind("keydown.modal")}e.preventDefault()}return this.overlay.hide(),this.modal.hide(),this.options.hide&&this.options.hide(),this},show:function(){return this.overlay.show(),this.modal.show(),this.options.closeable&&(this.overlay.one("click",this.hide),$(window).bind("keydown.modal",this.hide)),this.options.show&&this.options.show(),this},visible:function(){return"none"!=this.modal.css("display")}}),s.Tabs=s.Class.extend({initialize:function(e,t){this.container=$(e),this.options={activeClass:"active",tabsSelector:".tabs",tabSelector:".tab",typesSelector:".types",typeSelector:".type input",viewsSelector:".views"},this.setOptions(t),this.lists=this.options.lists,this.el={tabs:this.container.find(this.options.tabSelector),types:this.container.find(this.options.typeSelector),views:this.container.find(this.options.viewsSelector).children()},_.bindAll(this,"clickTab","checkType"),this.el.tabs.click(this.clickTab),this.el.types.change(this.checkType),_.isNumber(this.options.active)&&this.options.active>=0&&this.activate(this.options.active,this.options.suppressInit)},checkType:function(e){var t,n=[],r=$(e.target),i=this.el.types.filter(":visible");return i.each(function(){t=$(this),t.prop("checked")&&n.push(t.attr("name"))}),n.length||(n=[r.attr("name")],r.prop("checked",!0)),this.lists&&this.lists[this.activeTab].applyFilter&&this.lists[this.activeTab].applyFilter(n),n},clickTab:function(e){var t=this;this.el.tabs.each(function(n,r){return e.currentTarget==r?t.activate(n):void 0})},hide:function(e){return $(this.el.tabs[e]).hide(),$(this.el.views[e]).hide(),this},show:function(e){return $(this.el.tabs[e]).show(),$(this.el.views[e]).show(),this},activate:function(e,t){this.activeTab=e;var n=$(this.el.tabs[e]);return $(this.options.typesSelector).removeClass("visible"),$(this.options.typesSelector+"."+n.attr("data-tab")).addClass("visible"),this.container.find("."+this.options.activeClass).removeClass(this.options.activeClass),$(this.el.tabs[e]).addClass(this.options.activeClass),$(this.el.views[e]).addClass(this.options.activeClass),_.isFunction(this.options.activate)&&!t&&this.options.activate(e),this}}),s.Store=s.Class.extend({initialize:function(){this.valid=this.check()},check:function(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}},get:function(e){if(!this.valid)return void 0;var t=localStorage[e];try{return JSON.parse(t)}catch(n){return t}},set:function(e,t){return this.valid?(localStorage[e]=JSON.stringify(t),!0):!1},remove:function(e){this.valid&&delete localStorage[e]}}),window.s=window.s||{},s.store=new s.Store,s.Notify=s.Class.extend({initialize:function(){},clear:function(e){("string"==typeof e||"element"==typeof e)&&(e=$(e)),e.find(".flash").remove()},create:function(e,t){if(t.element){("string"==typeof t.element||"element"==typeof t.element)&&(t.element=$(t.element)),this.clear(t.element);var n=$(s.templates.render("layout/_flash",{message:e,type:t.type}));t.element.prepend(n),t.width&&n.width(t.width).addClass("borders"),t.slideSpeed=t.slideSpeed||200,_.defer(function(){n.slideDown(t.slideSpeed),t.duration&&_.delay(function(){n.slideUp(t.slideSpeed)},t.duration)})}},error:function(e,t){this.create(e,_.extend(t||{},{type:"error"}))},success:function(e,t){this.create(e,_.extend(t||{},{type:"success"}))},warning:function(e,t){this.create(e,_.extend(t||{},{type:"warning"}))},form:{removeError:function(e){$(e.currentTarget).removeClass("error").next(".error").remove()},clearValidationError:function(e){e.find("input").removeClass("error"),e.parent().find(".error, .success").remove()},validationError:function(e,t){var n=this;n.clearValidationError(t),_.isUndefined(e.fields)||(_.each(e.fields,function(e,r){t.find("input[name="+r+"]").unbind("keypress").one("keypress",_.bind(n.removeError,n)).addClass("error").after('<div class="error under">'+e+"</div>")}),t.find("input.error:first").select(),e.message="Fix any errors with the fields below."),s.notify.error(e.message,{element:t.parent()})}}}),$(function(){s.notify=new s.Notify}),s.Auth=s.Class.extend({initialize:function(e){this.setOptions(e),$(".login-main").show(),this.el={login:$("#login form"),loginButtons:$("#login .buttons"),loginUsername:$("#login-username"),loginPassword:$("#login-password"),loginStay:$("#login-stay"),loginSubmit:$("#login-submit"),signup:$("#signup form"),follow_storify:$("#follow-storify-container"),signupUsername:$("#signup-username"),signupEmail:$("#signup-email"),signupPassword:$("#signup-password"),signupSubmit:$("#signup-submit"),forgot:$("#recover form"),forgotEmail:$("#forgot-password-email"),forgotSubmit:$("#forgot-password-submit"),reset:$("#reset form"),usersList:$("#friends #users"),header:$("#friends .header"),filterLink:$("#friends .filter a"),follow:$("#friends #users .user button"),followAll:$("#subscribe-to-all"),showLogin:$("#login .showForm"),logout:$("#logout"),captchaSubmit:$("#captcha-submit")},this.next=s.utils.getUrlParams("next")||"/",this.popup="true"==s.utils.getUrlParams("popup"),/^(?:\/(?:[^\/]|$)|https?:\/\/.*\.?storify\.com(?:\/|$))/i.test(this.next)||(this.next="/"),this.cookieName="user","production"!==s.env&&(this.cookieName=s.env+"-"+this.cookieName);var t=s.store.get("user"),n=s.cookie.get(this.cookieName);if(null!=n)if(t&&t.username===n.username)this.setUser(t);else if(n._id)this.setUser(n),this.setUserCookie();else if(""==n)s.cookie.remove(this.cookieName),s.cookie.remove(this.cookieName,".storify.com");else{var r=this;$.getJSON("/currentUser",function(e){!e||e.error?(s.cookie.remove(r.cookieName),s.cookie.remove(r.cookieName,".storify.com")):(s.store.set("user",e),window.location.reload())})}else t&&s.store.remove("user");if(this.el.signup.length&&(s.everyauth.twitter||s.everyauth.facebook)&&this.showSignup(this.loginCallback),$("input").length>0&&$("input").first().focus(),$("#friends").length>0){var i=s.utils.getUrlParams("service")||"facebook";$("a.tab[rel="+i+"]").addClass("active"),$(".skip").attr("href",decodeURIComponent(this.next)),this.displayFriends(i)}this.addNextParam(),this.bind()},bind:function(){var e=this;_.bindAll(this,"login","logout","signupSubmit","signup","forgotPassword","resetPassword","getIdentity","displayFriends","filterLinkClicked","followHoverIn","followHoverOut","followClick","followAll","showLoginForm","submitCaptcha"),this.captchaModal=s.Modal?new s.Modal("#recaptcha",{closeable:!1}):{},this.el.login.bind("submit",this.login),this.el.signup.bind("submit",this.signupSubmit),this.el.forgot.bind("submit",this.forgotPassword),this.el.reset.bind("submit",this.resetPassword),$("#storify-auth .button.twitter").bind("click",function(t){t.preventDefault(),e.serviceAuth("twitter",{height:635})}),$("#storify-auth .button.facebook").bind("click",function(t){t.preventDefault(),e.serviceAuth("facebook")}),this.el.filterLink.bind("click",this.filterLinkClicked),this.el.follow.live("mouseenter",this.followHoverIn),this.el.follow.live("mouseleave",this.followHoverOut),this.el.follow.live("click",this.followClick),this.el.followAll.live("click",this.followAll),this.el.showLogin.click(this.showLoginForm),this.el.logout.click(this.logout),this.el.captchaSubmit.click(this.submitCaptcha)},showLoginForm:function(e){e.preventDefault(),this.el.showLogin.hide(),this.el.login.slideDown()},follow:function(e,t,n){var r=this,i="undefined"==typeof n?"add":n?"remove":"add";if(!r.user)return t(new Error("Not authenticated"));var a="/users/"+r.user.username+"/subscriptions/"+i;s.api.request("POST",a,{user:e,username:r.user.username,_token:r.user._token},{},function(e,n){return e?t(e.error.message):(t(null,n),void 0)})},unfollow:function(e,t){this.follow(e,t,!0)},getIdentity:function(e,n){if(!this.user||!e)return n(null);if(this.user.identities){var r=this.user.identities[e];if(n&&r)return n(r)}var i=this,a="/users/"+i.user.username+"/identities";s.api.request("GET",a,{username:i.user.username,_token:i.user._token},{},function(r,a){if(r)return s.notify.error(t(r.error.message),{element:"#content",slideSpeed:200,duration:15e3});var o=a.content;i.user.identities=i.user.identities||{};for(var l in o){var u=o[l];i.user.identities[u.service]=u}n(i.user.identities[e])})},serviceSignup:function(e){this.el.signupUsername.val(this.serviceData(e).username),this.showSignup(this.loginCallback)},serviceAuth:function(e,n){var r=this;n=$.extend({login:!0,popup:!0,width:800,height:400},n);var i=screen.width/2-n.width/2,a=screen.height/2-n.height/2,o="/auth/"+e+"?"+$.param(n);$.oauthpopup({path:o,windowOptions:"location=0,status=0,width="+n.width+",height="+n.height+",left="+i+",top="+a,callback:function(){s.everyauth=s.ea&&s.utils.parseJSON(s.ea)||{},s.everyauth[e]&&s.everyauth[e].accessToken?r.serviceLogin(e):r.validationError({message:t("Log in to __service__ denied",{service:e})},r.el.login)}})},showCaptcha:function(e){"function"==typeof e&&(this.captchaSubmitCallback=e),Recaptcha.reload(),this.el.captchaSubmit.removeAttr("disabled"),this.captchaModal.show(),$("#recaptcha input[name=recaptcha_response_field]").focus()},submitCaptcha:function(e){e.preventDefault();var n=$("#recaptcha input[name=recaptcha_challenge_field]"),r=$("#recaptcha input[name=recaptcha_response_field]");return r.val()?"function"!=typeof this.captchaSubmitCallback?(s.notify.error(t("Something weird happened. Please reload and try again."),{element:$("#recaptcha"),duration:4e3}),void 0):(this.el.captchaSubmit.attr("disabled",!0),this.captchaSubmitCallback({challenge:n.val(),response:r.val()}),void 0):(s.notify.error(t("Please fill in the captcha"),{element:$("#recaptcha"),duration:4e3}),void 0)},serviceData:function(e,t){var n=s.everyauth[e];return n&&"undefined"!=typeof n||(s.raven&&s.raven.started&&s.raven.Raven.captureMessage("auth.js:263. auth not defined? Service: "+JSON.stringify(e)+". s.everyauth: "+JSON.stringify(s.everyauth)+". s.ea : "+JSON.stringify(s.ea)),s.everyauth=s.ea&&s.utils.parseJSON(s.ea)||{},n=s.everyauth[e],n&&"undefined"!=typeof n)?{token:n.accessToken,secret:n.accessTokenSecret,service:e,service_userid:n.user.id,username:n.user.screen_name||n.user.username||n.user.id||n.user.email||(n.user.firstName?n.user.firstName+" "+n.user.lastName:void 0),name:n.user.name||n.user.full_name||(n.user.firstName?n.user.firstName+" "+n.user.lastName:void 0),email:n.user.email,avatar:n.user.profile_picture||n.user.photo,bio:n.user.description||n.user.bio,location:"object"==typeof n.user.location?n.user.location.name:n.user.location,website:n.user.url||(n.user.website?n.user.website.split("\n")[0]:void 0),captcha:t&&JSON.stringify(t)}:(s.raven&&s.raven.started&&s.raven.Raven.captureMessage("auth.js:269. auth still not defined? Service: "+JSON.stringify(e)+". s.everyauth: "+JSON.stringify(s.everyauth)),{})
},serviceLogin:function(e,t,n){var r=this,i=this.el.loginStay.attr("checked"),n=n||function(){};if(s.everyauth[e]&&s.everyauth[e].accessToken){var a="/auth/"+e;s.api.request("POST",a,r.serviceData(e,t),{},function(t,a){if(t)t.error&&"no_identity"==t.error.type?r.el.signup.length>0?r.serviceSignup(e):window.location.href=s.base_url+"/signup?next="+r.next:(r.validationError(t.error,r.el.login),r.logout()),n(t.error);else{r.clearValidationError(r.el.login);var o=a.content;r.setUser(o),r.setUserCookie(i),r.el.loginUsername.val(""),r.el.loginPassword.val(""),r.el.loginSubmit.removeAttr("disabled"),r.popup&&window.opener?r.close():window.location.href=decodeURIComponent(r.next),n()}})}else this.serviceAuth(e)},serviceConnect:function(e,t){var n=this;analytics.track("registration",{event:"auth-serviceConnect",service:e}),$.oauthpopup({path:"/auth/"+e,callback:function(){return s.everyauth=s.utils.parseJSON(s.ea),n.addIdentity(e,t)}})},serviceReconnect:function(e,t){var n=this;$.oauthpopup({path:"/auth/"+e,callback:function(){s.everyauth=s.utils.parseJSON(s.ea),s.everyauth[e]&&s.everyauth[e].accessToken?t(s.everyauth[e]):n.validationError({message:"Log in to "+e+" denied."},n.el.login)}})},serviceDisconnect:function(e,t){this.removeIdentity(e,t)},addIdentity:function(e,n,r){var i=this;"function"!=typeof n||r||(r=n,n=null);var a=this.serviceData(e);n&&(a.options=JSON.stringify(n)),a._token=this.user._token;var o="/users/"+s.auth.user.username+"/identities/add?username="+encodeURIComponent(this.user.username);s.api.request("POST",o,a,{},function(n,a){if(n){var o=n.error;if("duplicate_identity"==o.type&&o.message){msg=o.message;var l=s.utils.lastWord(msg);if("user"!==l){var u='<a href="'+s.base_url+"/"+l+' " target="_blank"> '+l+" </a>";msg=msg.replace(l,u)}}else msg="Failed to connect "+e+" account.";return s.notify.error(t(msg),{element:"#content",slideSpeed:200,duration:15e3})}i.user.identities=i.user.identities||{},i.user.identities[e]=a.content.identity,r&&r(a)})},removeIdentity:function(e,n){var r="/users/"+s.auth.user.username+"/identities/remove";s.api.request("POST",r,{identity:JSON.stringify({service:e}),username:this.user.username,_token:this.user._token},{},function(r,i){r?n(r):(s.notify.success(t("Successfully unlinked __service__ account",{service:e}),{element:"#content",slideSpeed:200,duration:3e3}),n(i))})},showSignup:function(){var e=this;e.el.signup.parent().find(".buttons, .or").show(),s.everyauth.twitter&&s.everyauth.twitter.user?(e.el.signup.parent().find(".buttons, .or").hide(),e.el.signup.find(".twitter-user").remove(),e.el.signup.prepend(s.templates.render("everyauth/_twitter_user",{user:s.everyauth.twitter.user})),e.el.signupUsername.val(s.everyauth.twitter.user.screen_name),e.el.follow_storify.removeClass("hidden"),e.el.signupEmail.focus()):s.everyauth.facebook&&s.everyauth.facebook.user&&(e.el.signup.parent().find(".buttons, .or").hide(),e.el.signup.find(".facebook-user").remove(),e.el.signup.prepend(s.templates.render("everyauth/_facebook_user",{user:s.everyauth.facebook.user})),e.el.signupUsername.val(s.everyauth.facebook.user.username),e.el.signupEmail.val(s.everyauth.facebook.user.email),s.everyauth.facebook.user.username?e.el.signupPassword.focus():e.el.signupUsername.focus()),setTimeout(function(){s.notify.success(t("Your Storify account is almost ready!"),{element:e.el.signup.parent(),duration:4e3})},1e3)},showLogin:function(e){this.loginCallback=e},loginPopup:function(e){var t=this,n=400,r=480,i=screen.width/2-n/2,a=screen.height/2-r/2;$.oauthpopup({windowName:"Login",windowOptions:"location=0,status=0,width="+n+",height="+r+",top="+a+",left="+i,path:"/login?popup=true",callback:function(n){return n?e(n):($.getJSON("/currentUser",function(r){return r.error?e(r.error):(t.setUser(r),s.nav&&s.nav.updateUser(),e(n,r),void 0)}),void 0)}})},signupSubmit:function(e){e.preventDefault();for(var n=$("#signup form:first").find("input"),r=0;r<n.length;r++){var i=$(n[r]);if(!i.val()&&"checkbox"!==i.attr("type"))return i.focus(),this.validationError({message:t("Please enter the")+" "+i.attr("name")+" "+t("field")},this.el.signup),void 0}var s=this.el.signup.find("input[name=agree]");return s.attr("checked")?(this.showCaptcha(this.signup),void 0):(s.focus(),this.validationError({message:t("Please agree to the terms of service")},this.el.signup),void 0)},signup:function(e){var t,n=this,r=(this.el.signup.find("input[name=agree]").attr("checked"),this.el.signup.find("input[name=username]").val()),i=this.el.signup.find("input[name=email]").val(),a=this.el.signup.find("input[name=password]").val(),o={username:r,email:i,password:a};if(s.everyauth.twitter&&s.everyauth.twitter.user)t="twitter",o=_.extend(o,{bio:s.everyauth.twitter.user.description,avatar:s.everyauth.twitter.user.profile_image_url.replace("_normal","_reasonably_small"),website:s.everyauth.twitter.user.url,name:s.everyauth.twitter.user.name,location:s.everyauth.twitter.user.location,service:"twitter"});else if(s.everyauth.facebook&&s.everyauth.facebook.user){t="facebook",o=_.extend(o,{bio:s.everyauth.facebook.user.bio,avatar:"http://graph.facebook.com/"+(s.everyauth.facebook.user.username||s.everyauth.facebook.user.id)+"/picture",name:s.everyauth.facebook.user.name,service:"facebook"});var l=s.everyauth.facebook.user.location,u=s.everyauth.facebook.user.website;l&&(o.location=l.name),u&&(o.website=u.split("\n")[0])}this.setRaven(),n.el.signupSubmit.attr("disabled",!0);var c="/users/create";s.api.request("POST",c,{user:JSON.stringify(o),captcha:JSON.stringify(e)},{retryLimit:3},function(e,r){function i(){window.location.href=s.base_url+"/friends?service="+t+"&next="+decodeURIComponent(n.next)}if(e)n.validationError(e.error,n.el.signup),n.el.signupSubmit.removeAttr("disabled"),n.el.captchaSubmit.removeAttr("disabled"),e.error&&"captcha_failed"!=e.error.type?n.captchaModal.hide():n.showCaptcha();else{n.clearValidationError(n.el.signup);var a=r.content;n.setUser(a),n.setUserCookie(!0),n.el.signupSubmit.removeAttr("disabled"),t?"twitter"==t?n.addIdentity("twitter",{follow_storify:"checked"==n.el.follow_storify.find("#follow-storify").attr("checked")},i):"facebook"==t&&n.addIdentity("facebook",i):window.location.href=decodeURIComponent(n.next)}})},forgotPassword:function(e){e.preventDefault();var n=this,r=this.el.forgot.find("#forgot-password-email").val();this.el.forgot.find("input, button").attr("disabled",!0);var i="/auth/forgot_password",a={email:r};s.api.request("POST",i,a,{},function(e){e?(n.validationError(e.error,n.el.forgot.find("form")),n.el.forgot.find("input, button").removeAttr("disabled")):(n.clearValidationError(n.el.forgot),n.el.forgotEmail.val(""),n.el.forgotSubmit.removeAttr("disabled"),s.notify.success(t("You should receive an email shortly"),{element:$("body")}))})},resetPassword:function(e){e.preventDefault();var n=this,r=this.el.reset.find("#reset-password-password").val(),i=s.utils.getQueryString(window.location.search.substr(1).split("&"));this.el.reset.find("input, button").attr("disabled",!0);var a="/auth/reset_password",o={password:r,email:i.email,reset_token:i.reset_token};s.api.request("POST",a,o,{},function(e){e?(n.validationError(e.error,n.el.reset),n.el.reset.find("input, button").removeAttr("disabled")):(n.clearValidationError(n.el.reset),s.notify.success(t("Your password has been reset")+".",{element:$("body")}),setTimeout(function(){window.location.href=s.base_url+"/"},1e3))})},login:function(e){e.preventDefault();var t=this,n=this.el.loginUsername.val(),r=this.el.loginPassword.val(),i=this.el.loginStay.attr("checked");this.setRaven(),this.el.loginSubmit.attr("disabled",!0);var a="/auth",o={username:n,password:r};s.api.request("POST",a,o,{retryLimit:3},function(e,n){if(e)t.validationError(e.error,t.el.login),t.el.loginSubmit.removeAttr("disabled");else{t.clearValidationError(t.el.login);var r=n.content;t.setUser(r),t.setUserCookie(i),t.el.loginUsername.val(""),t.el.loginPassword.val(""),t.el.loginSubmit.removeAttr("disabled"),t.popup&&window.opener?t.close():window.location.href=decodeURIComponent(t.next)}})},close:function(){window.opener.s||(window.opener.s={}),window.opener.s.ea=JSON.stringify(s.everyauth),window.opener.s.embedUser=JSON.stringify(this.user),window.close()},setUser:function(e){this.user=e;var t={username:e.username,email:e.email,created:e.date?e.date.created:null,bio:e.bio,lang:e.lang,location:e.location,firstname:e.name,plan:e.paid_plan};e._stripe&&(e._stripe.next_recurring_charge&&(t.next_billing=e._stripe.next_recurring_charge.date,t.amount=e._stripe.next_recurring_charge.amount),t.canceled=e._stripe.dates.cancelled_at,t.plan_id=e._stripe.plan.id,t.period=e._stripe.plan.interval),this.setRaven(e),analytics.identify(e._id,t)},setRaven:function(e){s.raven?s.raven.start&&s.raven.start():s.raven={},s.raven&&s.raven.started&&e&&s.raven.Raven.setUser({username:e.username,id:e._id,plan:e.paid_plan,email:e.email})},setIntercom:function(){return!1},setUserCookie:function(e){var t={username:this.user.username,_token:this.user._token,reloadSession:!0},n={domain:".storify.com",secure:"development"!==s.env};if("development"!=s.env&&(n.secure=!0),e){var r=new Date;r.setTime(r.getTime()+2592e6),n.expires=r}s.cookie.set(this.cookieName,t,n),s.store.set("user",this.user),$.i18n&&$.i18n.setLng(this.user.lang),this.loginCallback&&this.loginCallback(),this.loginCallback=null},logout:function(){this.user=null,s.everyauth={},s.cookie.remove(this.cookieName),s.cookie.remove(this.cookieName,".storify.com"),s.store.remove("user"),s.raven.stop()},removeError:function(e){$(e.currentTarget).removeClass("error").next(".error").remove()},clearValidationError:function(e){e.find("input").removeClass("error"),e.parent().find(".error, .success").remove()},validationError:function(e,n){var r=this;return this.clearValidationError(n),e?(_.isUndefined(e.fields)||(_.each(e.fields,function(e,t){n.find("input[name="+t+"]").unbind("keypress").one("keypress",_.bind(r.removeError,r)).addClass("error").after('<div class="error under">'+e+"</div>")}),n.find("input.error:first").select(),e.message="Fix any errors with the fields below"),s.notify.error(t(e.message),{element:$("body"),duration:4e3}),void 0):s.notify.error(t("Something wrong happened, please try again."),{element:$("body"),duration:4e3})},addNextParam:function(){var e=this;$("a.next").each(function(t,n){var r=$(n).attr("href");$(n).attr("href",r+"?next="+e.next)})},displayFriends:function(e){var n={},r=this;if(!e||"undefined"==typeof e)return s.raven&&s.raven.started&&s.raven.Raven.captureMessage("auth.js:819. No service? : "+JSON.stringify(e)),void 0;r.el.usersList.empty(),r.el.usersList.append('<div class="loading"></div>'),r.el.header.hide(),r.user&&(n.username=r.user.username,n._token=r.user._token);var i="/users/"+n.username+"/friends/"+e;s.api.request("GET",i,n,{},function(n,i){if(n){var a=e.charAt(0).toUpperCase()+e.slice(1);r.el.usersList.find(".loading").remove(),r.el.usersList.append('<p class="empty">'+t("Your account is not connected to ")+a+".</p>")}else{r.el.usersList.find(".loading").remove();var o=i.content.friends;if(o&&o.length>0)for(var l=0;l<o.length;l++){var u=s.templates.render("user/_user",{s_user:o[l],s_auth_user:r.user});r.el.usersList.append(u),r.el.header.show()}else r.el.usersList.append('<p class="empty">'+t("Couldn't find any of your friends on Storify.")+"</p>")}})},filterLinkClicked:function(e){e.preventDefault();var t=$(e.target),n=t.attr("rel");this.el.filterLink.removeClass("active"),t.addClass("active"),this.displayFriends(n)},followHoverIn:function(e){var n=$(e.target).parents(".user").find("button");n.hasClass("cancel")&&n.removeClass("cancel").addClass("decline").html("<span>✖ "+t("Unsubscribe")+"</span>")},followHoverOut:function(e){var n=$(e.target).parents(".user").find("button");n.hasClass("decline")&&n.removeClass("decline").addClass("cancel").html("<span>✔ "+t("Subscribed")+"</span>")},followClick:function(e){var n=$(e.target).parents(".user").find("button"),r=n.parents(".user").attr("data-username");n.attr("disabled",!0),n.hasClass("accept")?(n.html("<span>"+t("Subscribing")+"</span>"),s.auth.follow(r,function(e){return n.removeAttr("disabled").html("<span>✚ "+t("Subscribe")+"</span>"),e?(s.notify.error(t("Unable to subscribe to __name__ at this time, please try again later",{name:r}),{element:"body",duration:4e3}),void 0):(n.removeClass("accept").addClass("cancel").html("<span>✔ "+t("Subscribed")+"</span>"),void 0)})):(n.html("<span>"+t("Unsubscribing")+"</span>"),s.auth.unfollow(r,function(e){return n.removeAttr("disabled").html("<span>✔ "+t("Subscribed")+"</span>"),e?(s.notify.error(t("Unable to unsubscribe from __name__ at this time, please try again later",{name:r}),{element:"body",duration:4e3}),void 0):(n.removeClass("cancel decline").addClass("accept").html("<span>✚ "+t("Subscribe")+"</span>"),void 0)}))},followAll:function(){this.el.usersList.find("button.accept").each(function(e,t){t.click()})}}),$(function(){s.auth=new s.Auth}),s.StoryControl=s.Class.extend({initialize:function(e){var t=this;this.storyView=e,this.el={deleteLink:$(".story-toolbar-delete"),deleteStoryButton:$("#delete-story-button"),deleteCancelButton:$("#delete-story-cancel"),storyTitle:$(".story-title"),storyTitleInput:$(".story-title-input"),flagLink:$(".story-toolbar-flag"),unflagLink:$(".story-toolbar-unflag"),flagStoryButton:$("#flag-story-button"),flagCancelButton:$("#flag-story-cancel"),featureLink:$(".story-toolbar-feature"),featureMenu:$(".story-toolbar-feature + .category-menu li"),unfeatureLink:$(".story-toolbar-unfeature"),storyStatus:$(".story-toolbar-status"),storyPost:$(".story-toolbar-post"),storyNotify:$(".story-toolbar-notify"),statsStories:$(".user-stats .stories"),storyBody:$(".story-tile-body"),like:$(".story-tile .like"),share:$(".story-tile .share"),shareViaService:$(".story-tile .sb-share-dropdown a"),comment:$(".story-tile .comment"),bigLike:$("#big-like"),embedCode:$(".embed-code input"),embedHeaderControl:$('input[name="embed-header-control"]'),embedBorderControl:$(".embed-border input"),embedSEOControl:$(".embed-seo input"),embedTemplateControl:$(".embed-template select"),embedHeaderTitle:$("#embed-header-label"),embedHeaderOptionNone:$("#embed-header-option-none"),embedHeaderOptionMinimal:$("#embed-header-option-minimal"),embedHeaderOptionFull:$("#embed-header-option-full"),embedHeaderOptionBorder:$("#embed-option-border"),embedHeaderOptionHtml:$("#embed-option-html"),embedHeaderOptionTemplate:$("#embed-option-template")},_.bindAll(this,"clickDelete","deleteStory","clickFlag","flagStory","unflagStory","clickFeature","featureStory","clickUnfeature","unfeatureStory","likeClicked","commentClicked","shareViaServiceClicked","share","shareByEmail","embedCodeClicked","embedControlChanged","embedTemplateControlChanged","inputTitle"),this.workingModal=new s.Modal("#working",{}),this.deleteModal=new s.Modal("#delete-story-modal"),this.flagModal=new s.Modal("#flag-story-modal",{show:function(){t.el.flagStoryButton.focus()}}),this.el.deleteLink.live("click",this.clickDelete),this.el.storyTitleInput.bind("input",this.inputTitle),this.deleteStoryButton=new s.Button(this.el.deleteStoryButton,{click:this.deleteStory}),this.deleteStoryButton.disable(),this.el.deleteCancelButton.click(function(e){e.preventDefault(),t.deleteModal.hide()}),this.el.flagLink.live("click",this.clickFlag),this.el.unflagLink.live("click",this.unflagStory),this.el.flagStoryButton.click(function(e){e.preventDefault(),t.flagStory(),t.el.flagStoryButton.blur()}),this.el.flagCancelButton.click(function(e){e.preventDefault(),t.flagModal.hide()}),this.el.featureLink.live("click",this.clickFeature),this.el.featureMenu.live("click",this.featureStory),this.el.unfeatureLink.live("click",this.clickUnfeature),$(document).ready(function(){$.fn.tipsy&&(t.el.storyStatus.tipsy({delayIn:500,live:!0,gravity:"w"}),t.el.embedHeaderTitle.tipsy({delayIn:10,live:!0,gravity:"s"}),t.el.embedHeaderOptionNone.tipsy({delayIn:10,live:!0,gravity:"s"}),t.el.embedHeaderOptionMinimal.tipsy({delayIn:10,live:!0,gravity:"s"}),t.el.embedHeaderOptionFull.tipsy({delayIn:10,live:!0,gravity:"s"}),t.el.embedHeaderOptionBorder.tipsy({delayIn:10,live:!0,gravity:"s"}),t.el.embedHeaderOptionHtml.tipsy({delayIn:10,live:!0,gravity:"s"}),t.el.embedHeaderOptionTemplate.tipsy({delayIn:10,live:!0,gravity:"s"}))}),this.el.storyBody.live("click",this.storyBodyClicked),this.el.like.live("click",this.likeClicked),this.el.share.live("click",this.shareClicked),this.el.comment.live("click",this.commentClicked),this.el.embedCode.click(this.embedCodeClicked),this.el.embedHeaderControl.change(this.embedControlChanged),this.el.embedBorderControl.change(this.embedControlChanged),this.el.embedSEOControl.change(this.embedControlChanged),this.el.embedTemplateControl.change(this.embedTemplateControlChanged),this.el.shareViaService.live("click",this.shareViaServiceClicked),e&&!s.story.date.published&&($(".export-story").hide(),t.el.storyNotify.hide())},clickDelete:function(e){return e.preventDefault(),this.selectedStory=$(e.currentTarget).parents(".story-tile"),this.el.storyTitle.text(this.selectedStory.find(".story-tile-title").text()),this.deleteModal.show(),this.el.storyTitleInput.val("").focus(),!1},inputTitle:function(e){var t=$(e.target).val().trim().toLowerCase(),n=this.el.storyTitle.text().trim().toLowerCase();t===n?this.deleteStoryButton.enable():this.deleteStoryButton.disable()},clickFlag:function(e){return e.preventDefault(),this.selectedStory=$(e.currentTarget).parents(".story-tile"),this.flagModal.show(),!1},clickFeature:function(e){return e.preventDefault(),this.selectedStory=this.storyView?$(e.currentTarget).parents(".story-toolbar-full"):$(e.currentTarget).parents(".story-tile"),$(e.currentTarget).next(".category-menu").toggleClass("visible"),!1},clickUnfeature:function(e){return e.preventDefault(),this.selectedStory=this.storyView?$(e.currentTarget).parents(".story-toolbar-full"):$(e.currentTarget).parents(".story-tile"),this.unfeatureStory(),!1},featureStory:function(e){var n=this,r=this.storyView?s.story.path:this.selectedStory.attr("data-original-path"),i=$(e.currentTarget).find("span").text();$(".category-menu").removeClass("visible");var a="/stories/"+r+"/feature",o={username:s.auth.user.username,_token:s.auth.user._token,category:i};s.api.request("POST",a,o,{},function(e){e?s.notify.error(t("Error while featuring story")+".",{element:$("#content"),duration:4e3}):(s.notify.success(t("This story has been featured")+".",{element:$("#content"),duration:4e3}),n.selectedStory.find(".story-toolbar-feature").removeClass("story-toolbar-feature").addClass("story-toolbar-unfeature").find("span").text("Unfeature"))})},unfeatureStory:function(){var e=this,n=this.storyView?s.story.path:this.selectedStory.attr("data-original-path"),r="/stories/"+n+"/unfeature",i={username:s.auth.user.username,_token:s.auth.user._token};s.api.request("POST",r,i,{},function(n){n?s.notify.error(t("Error while unfeaturing story")+".",{element:$("#content"),duration:4e3}):(s.notify.success(t("This story has been unfeatured")+".",{element:$("#content"),duration:4e3}),e.selectedStory.find(".story-toolbar-unfeature").removeClass("story-toolbar-unfeature").addClass("story-toolbar-feature").find("span").text("Feature"))})},deleteStory:function(){var e=this,n=this.storyView?s.story.path:this.selectedStory.attr("data-original-path"),r="/stories/"+n+"/delete",i={username:s.auth.user.username,_token:s.auth.user._token};s.api.request("POST",r,i,{},function(n){if(n){var r=t("Error while deleting story");r+=n.error&&n.error.message?" : "+t(n.error.message)+".":".",s.notify.error(r,{element:$("#content"),duration:4e3}),e.deleteModal.hide()}else if(e.storyView)window.location="/"+s.user.username;else if(s.notify.success(t("Your story has been deleted"),{element:$("#content"),duration:4e3}),e.deleteModal.hide(),e.selectedStory.fadeOut(),e.el.statsStories.length>0){var i=parseInt(e.el.statsStories.find("strong").text())-1,a=1===i?t("story"):t("stories");e.el.statsStories.find("strong").text(i),e.el.statsStories.find("span").text(a)}})},distribute:function(){},flagStory:function(){var e=this,n=this.storyView?s.story.path:this.selectedStory.attr("data-original-path"),r="/stories/"+n+"/flag",i={username:s.auth.user.username,_token:s.auth.user._token};s.api.request("POST",r,i,{},function(n){if(n)s.notify.error(t("Error while flagging story")+".",{element:$("#content"),duration:4e3}),e.flagModal.hide();else if(e.storyView)window.location="/"+s.user.username;else if(s.notify.success(t("Your story has been flagged")+".",{element:$("#content"),duration:4e3}),e.flagModal.hide(),e.selectedStory.fadeOut(),e.el.statsStories.length>0){var r=parseInt(e.el.statsStories.find("strong").text())-1,i=1===r?t("story"):t("stories");e.el.statsStories.find("strong").text(r),e.el.statsStories.find("span").text(i)}})},unflagStory:function(e){e.preventDefault();var n=this,r=this.storyView?$(e.currentTarget).parents(".story-toolbar-full"):$(e.currentTarget).parents(".story-tile"),i=this.storyView?s.story.path:r.attr("data-original-path"),a="/stories/"+i+"/not_spam",o={username:s.auth.user.username,_token:s.auth.user._token};s.api.request("POST",a,o,{},function(e){e?s.notify.error(t("Error while unmarking story as spam")+".",{element:$("#content"),duration:4e3}):n.storyView?window.location="/"+s.user.username:(s.notify.success(t("The story has been unmarked as spam")+".",{element:$("#content"),duration:4e3}),n.el.unflagLink.removeClass("story-toolbar-unflag").addClass("story-toolbar-flag").find("span").text(t("Spam")))})},storyBodyClicked:function(e){var t=$(e.target),n=t.hasClass("story-tile")?t:t.parents(".story-tile"),r=n.find(".story-tile-title").attr("href");t.is("a")||0!==t.parents(".like").length||0!==t.parents(".comment").length||0!==t.parents(".share").length||(window.location=r)},likeClicked:function(e){e.preventDefault();var t=this;s.auth.user?t.toggleLike(e):(analytics.track("engagement",{event:"story-like"}),s.auth.loginPopup(function(n,r){!n&&r&&t.toggleLike(e)}))},commentClicked:function(e){e.preventDefault();var t=$(e.target).parents(".story-tile"),n=t.find(".story-tile-title").attr("href");window.location=n+"#comments"},shareClicked:function(e){e.preventDefault();var t=$(e.target),n=t.parents(".story-tile");$(this).toggleClass("active"),n.toggleClass("share")},shareViaServiceClicked:function(e){e.preventDefault();var t=$(e.target),n=t.parents(".story-tile"),r=window.location.protocol+s.base_url+"/"+n.data("original-path"),i="story",a=t.attr("rel");switch(t.data("media"),t.data("video"),a){case"email":this.shareByEmail(r);break;case"storify":var o={type:i,permalink:r,via:window.location.href},l={utm_content:i,utm_medium:"storyPage"};sfy.showModal(o,l);break;default:this.share(r,i,a)}},share:function(e,t,n){var r;switch(analytics.track("engagement-share",{event:"story-shared-from-list"}),n){case"facebook":r="http://www.facebook.com/sharer.php?u="+encodeURIComponent(e);break;case"twitter":r="http://twitter.com/intent/tweet?via=storify&text="+encodeURIComponent("Check out this great "+t+" on Storify!")+"&url="+encodeURIComponent(e);break;case"googleplus":r="http://plus.google.com/share?url="+encodeURIComponent(e);break;case"linkedin":r="http://www.linkedin.com/shareArticle?url="+encodeURIComponent(e)}window.open(r,"sharer","toolbar=0,status=0,resizable=1,width=626,height=436")},shareByEmail:function(e){window.location.href="mailto:?body="+e},toggleLike:function(e){var t=$(e.currentTarget);t.hasClass("pending")||(t.addClass("pending"),t.hasClass("active")?this.unlike(t):(this.animateBigLike(),this.like(t)))},like:function(e){var t=this,n=e.parents(".story-tile"),r=n.attr("data-original-path"),i="/stories/"+r+"/like",a={username:s.auth.user.username,_token:s.auth.user._token};s.api.request("POST",i,a,{},function(r){r?e.removeClass("pending"):(e.removeClass("pending").addClass("active"),t.incrementStat(n.find("a.like + em")))})},unlike:function(e){var t=this,n=e.parents(".story-tile"),r=n.attr("data-original-path"),i="/stories/"+r+"/unlike",a={username:s.auth.user.username,_token:s.auth.user._token};s.api.request("POST",i,a,{},function(r){r?e.removeClass("pending"):(e.removeClass("pending").removeClass("active"),t.decrementStat(n.find("a.like + em")))})},incrementStat:function(e,t){var t=1*e.html()+(t||1);e.html(t)},decrementStat:function(e,t){var t=t||1;this.incrementStat(e,-t)},animateBigLike:function(){var e=460,t=412,n=this;n.el.bigLike.show().animate({opacity:.8,width:e,height:t,marginLeft:e/-2,marginTop:t/-2},250,function(){setTimeout(function(){n.el.bigLike.animate({opacity:0,width:2*e,height:2*t,marginLeft:-e,marginTop:-t},250,function(){n.el.bigLike.hide().css({opacity:.8,width:e/2,height:t/2,marginLeft:e/-4,marginTop:t/-4})})},500)})},embedCodeClicked:function(){this.el.embedCode.select()},updateEmbedCode:function(e){this.el.embedCode.val();var t='<div class="storify"><iframe src="{{base}}/{{username}}/{{slug}}/embed{{options}}" width="100%" height="750" frameborder="no" allowtransparency="true"></iframe><script src="{{base}}/{{username}}/{{slug}}.js{{options}}"></script><noscript>[<a href="{{base}}/{{username}}/{{slug}}" target="_blank">View the story "{{title}}" on Storify</a>]',n={base:s.base_url,username:s.user.username,slug:s.story.slug,title:s.story.title,options:e&&e.length>0?"?"+e.join("&"):"",seo:this.el.embedSEOControl.is(":checked")?this.seo||"":""},r=s.utils.template(t,n);this.el.embedSEOControl.attr("checked")&&this.seo&&(r+=this.seo),r+="</noscript></div>",this.el.embedCode.val(r)},embedControlChanged:function(){var e=[],t=this,n="",r=$('input[name="embed-header-control"]:checked').attr("id");switch(r.split("-")[2]){case"none":n="header=none",e.push(n);break;case"minimal":n="header=false",e.push(n);break;case"full":default:n=""}var i=$(".embed-border input").is(":checked");i||e.push("border=false");var a="",o=$(".embed-template option:selected").val();switch(o){case"slideshow":case"grid":a="template="+o,e.push(a);break;default:a=""}this.el.embedSEOControl.is(":checked")&&!t.seo?(t.workingModal.show(),$.get(s.base_url+"/"+s.user.username+"/"+s.story.slug+"/text",function(n){t.seo=n,t.updateEmbedCode(e),t.workingModal.hide()})):t.seo=void 0,this.updateEmbedCode(e)},embedTemplateControlChanged:function(){var e=$(".embed-template option:selected").val();s.base_url+"/"+s.user.username+"/"+s.story.slug;var t="//templates.storify.com";switch("development"==s.env&&(t="http://localhost.storify.com:8080"),e){case"slideshow":$(".embed-header").find(".icon-header, #embed-header-label, .header, .embed-hint").hide();break;case"grid":default:$(".embed-border, .embed-seo").show(),$(".embed-header").find(".icon-header, #embed-header-label, .header, .embed-hint").show()}this.embedControlChanged()}}),s.ElementControl=s.Class.extend({initialize:function(e){var t=this;_.bindAll(this,"flipClicked","buttonLikeClicked","buttonCommentClicked","buttonShareClicked","statsCommentsClicked","tabClicked","topStoryMoreClicked","commentMoreClicked","flipAndShowStoriesView","flipAndShowCommentsView","showView","showVideoModal","hideModal","shareButtonClicked","share","shareOnPinterest","shareByEmail","commentSubmit","buttonRepostClicked","resizeImageModal","resizeVideoModal","gotoElementPage","openElementModal"),this.options={storyTemplate:"_tile_simple",dataType:"json"},this.setOptions(e),this.el={flip:$(".box.element .flip"),shareElementModal:$("#element-modal"),buttons:$(".box.element .actions a"),buttonRepost:$(".box.element .repost"),buttonLike:$(".box.element .actions .like"),buttonComment:$(".box.element .actions .comment"),buttonShare:$(".box.element .actions .share"),statsLikes:$(".box.element .stats .stats-likes"),statsComments:$(".box.element .stats .stats-comments"),tab:$(".box.element .tabs .tab"),topStoryMore:$(".box.element .top-story-comment .top-story a.more"),commentMore:$(".box.element .top-story-comment .comment a.more"),imageContent:$(".box.image .content"),videoContent:$(".box.video .content"),quoteContent:$('.box.quote[data-minimal="false"] .content'),modal:$("#modal"),shareButton:$(".box.element .share_box a"),commentInput:$(".box.element .comment-input"),bigLike:$("#big-like"),pageOverlay:$("#page-overlay")},$(document).ready(function(){$.fn.tipsy&&(t.el.buttons.tipsy({delayIn:500,live:!0,gravity:"s"}),t.el.buttonRepost.tipsy({delayIn:500,live:!0}))}),this.el.flip.live("click",this.flipClicked),this.el.tab.live("click",this.tabClicked),this.el.buttonRepost.live("click",this.buttonRepostClicked),this.el.buttonLike.live("click",this.buttonLikeClicked),this.el.buttonComment.live("click",this.buttonCommentClicked),this.el.buttonShare.live("click",this.buttonShareClicked),this.el.statsComments.live("click",this.statsCommentsClicked),this.el.topStoryMore.live("click",this.topStoryMoreClicked),this.el.commentMore.live("click",this.commentMoreClicked),this.el.imageContent.live("click",this.openElementModal),this.el.videoContent.live("click",this.openElementModal),this.el.quoteContent.live("click",this.openElementModal),this.el.pageOverlay.live("click",this.hideModal),this.el.shareButton.live("click",this.shareButtonClicked),this.el.commentInput.live("keypress",this.commentSubmit)},openElementModal:function(e){var t=this,n=$(e.target);if(!n.is("a")&&!n.is("img"))var r=n.parents(".box").data("eid");if(r){history.replaceState&&history.replaceState({eid:r},document.title,""),this.shareElementModal=new s.Modal("#element-modal"),this.el.shareElementModal.empty(),this.el.shareElementModal.attr("data-eid",r),this.el.shareElementModal.attr("data-permalink",$("#"+r).data("permalink")),this.shareElementModal.overlay.one("click",function(){history.pushState?s.story&&history.pushState({eid:null},document.title,"/"+s.story.author.username+"/"+s.story.slug):window.location.hash=""});var i=s.auth.user?{username:s.auth.user.username,_token:s.auth.user._token}:{};s.story&&(i.sid=s.story.sid);var a="/elements/"+r;s.api.request("GET",a,i,{},function(e,r){if(e);else{var i=r.content,a=n.parents(".box").data("type"),o=n.parents(".box").data("source");if(t.el.shareElementModal.append(s.templates.render("element/_modal",{element:i,context:s.base_url,modal:!0})),s.element=new s.pages.Element("modal","#element-modal"),t.shareElementModal.show(),"video"==a&&("youtube"===o||"vine"===o)){var l=$("#element-modal").find("iframe");l.parent().css("text-align","center"),"youtube"===o?(l.attr("src",l.attr("src")+"&autoplay=0"),l.attr("width","630").attr("height","354")):l.attr("width","350").attr("height","350")}}})}},showVideoModal:function(e){var t=$(e.target).hasClass("content")?$(e.target):$(e.target).parents(".content"),n=this,r=t.find(".html").html(),i=$(r).attr("width"),a=$(r).attr("height"),o=t.parents(".box").data("source");if($("body").append(s.templates.render("element/_video_modal",{w:i,h:a,html:r})),n.el.modal=$("#modal"),"youtube"===o){var l=n.el.modal.find("iframe");l.attr("src",l.attr("src")+"&autoplay=1")}n.resizeVideoModal(),$(window).resize(n.resizeVideoModal)},gotoElementPage:function(e){var t=$(e.target);if(!t.is("a")&&!t.is("img")){var n=t.parents(".box").data("eid");window.location=/elements/+n}},resizeImageModal:function(){var e=this;if(0!==e.el.modal.length){var t,n,r=e.el.modal.data("width"),i=e.el.modal.data("height"),s=r/i,a=$(window).width(),o=$(window).height(),l=a/o,u=$("#modal").find("img").width(),c=$("#modal").find("img").height();a>r&&o>i?e.el.modal.find("img").css({marginLeft:-u/2,marginTop:-c/2}):(l>s?(t=o/c*u,n=o):(t=a,n=a/u*c),e.el.modal.find("img").css({width:t,height:n,marginLeft:-t/2,marginTop:-n/2}))}},resizeVideoModal:function(){var e=this;if(0!==e.el.modal.length){var t,n,r=e.el.modal.data("width"),i=e.el.modal.data("height"),s=r/i,a=$(window).width(),o=$(window).height(),l=a/o;a>r&&o>i?e.el.modal.find(".html").css({marginLeft:-r/2,marginTop:-i/2}):(l>s?(t=o/i*r,n=o):(t=a,n=a/r*i),e.el.modal.find(".html").css({marginLeft:-t/2,marginTop:-n/2}),e.el.modal.find(".html >:first-child").attr("width",t),e.el.modal.find(".html >:first-child").attr("height",n))
}},hideModal:function(){this.el.modal.remove(),$(".s-video-shim iframe").remove()},flipClicked:function(e){e.preventDefault();var t=$(e.target),n=t.parents(".box");n.hasClass("flipped")?n.removeClass("flipped"):this.flipAndShowStoriesView(e)},buttonRepostClicked:function(e){e.preventDefault();var t=$(e.target),n=t.parents(".box"),r=n.attr("data-type"),i=n.attr("data-permalink"),a={permalink:i},o={utm_medium:"element",utm_content:r};window.location.href.match(/^https?:\/\/storify\.com\/([^\/ \?]{1,15})(\?.*|\/)?$/)?(a.via=window.location.href,o.utm_medium="profilePage"):window.location.href.match(/^https?:\/\/storify\.com\/search\/?q=/)?o.utm_medium="searchPage":window.location.href.match(/^https?:\/\/storify\.com(\/?.*|\/)?$/)&&(o.utm_medium="homepage"),s.auth.user?sfy.showModal(a,o):s.auth.loginPopup(function(e,t){!e&&t&&sfy.showModal(a,o)})},buttonLikeClicked:function(e){e.preventDefault();var t=this;s.auth.user?t.toggleLike(e):(analytics.track("enagagement",{event:"story-like"}),s.auth.loginPopup(function(n,r){!n&&r&&t.toggleLike(e)}))},toggleLike:function(e){var t=$(e.currentTarget);t.hasClass("pending")||(t.addClass("pending"),t.hasClass("active")?this.unlike(t):(this.animateBigLike(),this.like(t)))},like:function(e){var t=this,n=e.parents(".element"),r=n.attr("data-eid"),i="/elements/"+r+"/like";s.api.request("POST",i,{username:s.auth.user.username,_token:s.auth.user._token},{},function(r){r?e.removeClass("pending"):(e.removeClass("pending").addClass("active"),t.incrementStat(n.find(".stats-likes")),analytics.track("engagement",{event:"element-like",type:n.attr("data-type"),source:n.attr("data-source")}))})},unlike:function(e){var t=this,n=e.parents(".element"),r=n.attr("data-eid"),i="/elements/"+r+"/unlike";s.api.request("POST",i,{username:s.auth.user.username,_token:s.auth.user._token},{},function(r){r?e.removeClass("pending"):(e.removeClass("pending").removeClass("active"),t.decrementStat(n.find(".stats-likes")))})},incrementStat:function(e,t){var t=1*e.html()+(t||1);e.html(t)},decrementStat:function(e,t){var t=t||1;this.incrementStat(e,-t)},buttonCommentClicked:function(e){this.flipAndShowCommentsView(e)},buttonShareClicked:function(e){e.preventDefault();var t=$(e.target),n=t.parents(".box");n.toggleClass("share")},tabClicked:function(e){e.preventDefault();var t=$(e.target),n=t.hasClass("tab")?t:t.parents(".tab"),r=t.parents(".box"),i=n.attr("rel");this.showView(r,i)},topStoryMoreClicked:function(e){this.flipAndShowStoriesView(e)},commentMoreClicked:function(e){this.flipAndShowCommentsView(e)},flipAndShowStoriesView:function(e){e.preventDefault();var t=$(e.target),n=t.parents(".box");n.removeClass("share"),n.toggleClass("flipped"),this.showView(n,"stories")},flipAndShowCommentsView:function(e){e.preventDefault();var t=$(e.target),n=t.parents(".box");n.removeClass("share"),n.toggleClass("flipped"),this.showView(n,"comments")},showView:function(e,t){e.find(".tab.active").removeClass("active"),e.find(".tab[rel="+t+"]").addClass("active"),e.find(".view.active").removeClass("active");var n=e.find(".view."+t);return n.addClass("active"),"stories"==t?this.loadStories(e,n):"comments"==t&&(this.loadComments(e,n),e.find(".comment-form input").focus()),n},loadStories:function(e,t){var n=e.attr("data-eid"),r=t.find(".view-inner"),i=t.find(".empty"),a={},o=this;if(!t.hasClass("pending")&&t.hasClass("loading")){t.addClass("pending"),s.auth.user&&(a.username=s.auth.user.username,a._token=s.auth.user._token);var l="/stories/list/"+n;s.api.request("GET",l,a,{},function(n,a){if(n)i.show(),t.removeClass("loading");else{var l,u=a.content.stories;_.each(u,function(e,t){e.date.published||u.splice(t,1)}),u.length>0?_.each(u,function(e){l=s.templates.render("story/"+o.options.storyTemplate,{story:e}),r.append(l)}):i.show(),t.removeClass("loading"),analytics.track("browse",{event:"element-stories-loaded-global",type:e.attr("data-type"),source:e.attr("data-source")})}})}},loadComments:function(e,t){var n=e.attr("data-eid"),r=t.find(".view-inner"),i=t.find(".empty"),a={};if(!t.hasClass("pending")&&t.hasClass("loading")){t.addClass("pending"),s.auth.user&&(a.username=s.auth.user.username,a._token=s.auth.user._token);var o="/elements/"+n+"/comments";s.api.request("GET",o,a,{},function(n,a){if(n)i.show(),t.removeClass("loading");else{var o,l=a.content.comments;l.length>0?_.each(l,function(e){o=s.templates.render("element/_comment",{comment:e}),r.prepend(o)}):i.show(),t.removeClass("loading"),t.removeClass("pending"),analytics.track("browse",{event:"element-flip-comments",type:e.attr("data-type"),source:e.attr("data-source")})}})}},commentSubmit:function(e){if(13==e.keyCode){e.preventDefault();var t=this;s.auth.user?t.comment(e):(analytics.track("engagement",{event:"element-comment"}),s.auth.loginPopup(function(n,r){!n&&r&&t.comment(e)}))}},comment:function(e){var t=this,n=$(e.target),r=n.parents(".element"),i=r.find(".comments .view-inner"),a=r.find(".comments .empty"),o=r.attr("data-eid"),l=n.val();n.prop("disabled",!0);var u="/elements/"+o+"/comments/add";s.api.request("POST",u,{username:s.auth.user.username,_token:s.auth.user._token,comment:_.trim(l)},{},function(e,o){if(e)n.val("").prop("disabled",!1);else{var l=o.content;a.hide(),i.append(s.templates.render("element/_comment",{comment:l})),n.val("").prop("disabled",!1),t.incrementStat(r.find(".stats-comments")),i.scrollTo("max",250),analytics.track("engagement",{event:"element-comment",type:r.attr("data-type"),source:r.attr("data-source")})}})},statsCommentsClicked:function(e){this.flipAndShowCommentsView(e)},shareButtonClicked:function(e){e.preventDefault();var t=$(e.target),n=t.parents(".box"),r=n.data("url"),i=n.data("type"),s=t.attr("class"),a=t.data("media"),o=t.data("video");switch(s){case"email":this.shareByEmail(r);break;case"pinterest":this.shareOnPinterest(r,a,o);break;default:this.share(r,i,s)}},share:function(e,t,n){var r;switch(n){case"facebook":r="http://www.facebook.com/sharer.php?u="+encodeURIComponent(e);break;case"twitter":r="http://twitter.com/intent/tweet?via=storify&text="+encodeURIComponent("Check out this great "+t+" on Storify!")+"&url="+encodeURIComponent(e);break;case"googleplus":r="http://plus.google.com/share?url="+encodeURIComponent(e);break;case"linkedin":r="http://www.linkedin.com/shareArticle?url="+encodeURIComponent(e)}window.open(r,"sharer","toolbar=0,status=0,resizable=1,width=626,height=436")},shareByEmail:function(e){window.location.href="mailto:?body="+e},shareOnPinterest:function(e,t,n){window.open("http://pinterest.com/pin/create/bookmarklet/?media="+encodeURIComponent(t)+"&url="+encodeURIComponent(e)+"&is_video="+encodeURIComponent(n),"sharer","toolbar=0,status=0,resizable=1,width=632,height=270")},animateBigLike:function(){var e=460,t=412,n=this;n.el.bigLike.show().animate({opacity:.8,width:e,height:t,marginLeft:e/-2,marginTop:t/-2},250,function(){setTimeout(function(){n.el.bigLike.animate({opacity:0,width:2*e,height:2*t,marginLeft:-e,marginTop:-t},250,function(){n.el.bigLike.hide().css({opacity:.8,width:e/2,height:t/2,marginLeft:e/-4,marginTop:t/-4})})},500)})}}),s.StoryList=s.Class.extend({blockedContent:new RegExp("^playboy|playboydotcom|playboy_nl|210tuesday|penthouse$","i"),initialize:function(e,t){this.container=$(e),this.options={path:"",page:1,per_page:24,isOwner:!1,loadMore:!0,loadedOnce:!1,autoLoads:2,autoThreshold:20,loadText:"Show more",emptyText:"",onlyWithThumb:!1,featured:!1,params:{},editable:!0,template:"tile",filter:["draft","published"],dataType:"json"},this.setOptions(t),this.filter=this.options.filter,this.active=!0,this.loadedOnce=this.options.loadedOnce,this.page=this.options.page,this.autoLoads=this.options.autoLoads,this.loadButton=$('<button class="list-load story-list-load load-more"><span>'+this.options.loadText+"</span></button>"),this.emptyMessage=$('<div class="list-empty story-list-empty">'+this.options.emptyText+"</div>"),this.container.append(this.emptyMessage),this.container.append(this.loadButton),this.options.loadMore||(this.loadButton.hide(),this.container.append($("<div>").addClass("clear"))),_.bindAll(this,"scroll","clickLoad"),this.autoLoads&&$(window).scroll(this.scroll),this.loadedOnce&&this.container.find(".story-tile").length<this.options.per_page?this.loadButton.hide():this.loadButton.click(this.clickLoad)},clickLoad:function(){this.update()},scroll:function(e){if(!this.active||this.container.is(":hidden"))return!0;this.scrollEvent=e;var t=$(window),n=this.loadButton.offset().top-t.scrollTop()-t.height()-this.options.autoThreshold;0>n&&(this.autoLoads--?this.update():$(window).unbind(this.scrollEvent))},activate:function(){this.active=!0},deactivate:function(){this.active=!1},applyFilter:function(e){this.filter=e,this.reset()},reset:function(e,t){_.isFunction(e)&&(t=e,e=1),this.container.find(".story-tile").remove(),this.page=e||1,this.active=!0,this.loadedOnce=this.options.loadedOnce,this.autoLoads=this.options.autoLoads,this.options.loadMore&&this.loadButton.show(),$(window).unbind(this.scrollEvent),this.autoLoads&&$(window).scroll(this.scroll),this.update(t)},update:function(e){var t=this;return t.active?(t.active=!1,t.loadButton.attr("disabled",!0).addClass("loading").find("span").text(""),t.getStories(function(n,r){if(400==r.status||!n||!n.length||1==n.length&&"storypad"==n[0].slug)return t.loadButton.hide(),t.loadedOnce||t.emptyMessage.show(),_.isFunction(e)&&e(null),void 0;if(t.emptyMessage&&t.emptyMessage.hide?t.emptyMessage.hide():s.raven&&s.raven.started&&s.raven.Raven.captureMessage("story.list.js:141 : Issue with emptyMessage."),t.options.featured){var i=$(s.templates.render("story/_featured",{stories:n}));_.each(i.find(".story-title"),function(e){var t=$(e),n=t.text();t.text(_(n).prune(50,"..."))}),t.container.append(i)}else t.loadedOnce||t.container.find(".story-tile").remove(),_.each(n,function(e){if("storypad"!=e.slug&&!(t.options.blockAdultContent&&e.author.username.match(t.blockedContent)||t.options.onlyWithThumb&&!e.thumbnail)){var n=$(s.templates.render("story/_"+t.options.template,{story:e}));n.data("json",e),e.canEdit&&t.options.editable&&n.addClass("story-tile-editable"),(!s.auth.user||s.auth.user._access<1)&&n.find(".story-toolbar-feature, .story-toolbar-unfeature").hide();var r=n.find(".story-tile-title-text"),i=r.text();r.text(_(i).prune(50,"..."));var a=n.find(".story-tile-description"),o=a.text();a.text(_(o).prune(150,"...")),t.loadButton.before(n)}});_.each(t.container.find(".timestamp"),function(e){var t=$(e),n=t.attr("data-timestamp");t.text(s.utils.date(n).fromNow())}),n.length<t.options.per_page?t.loadButton.hide():(t.loadButton.removeAttr("disabled").removeClass("loading").find("span").text(t.options.loadText),t.active=!0),t.loadedOnce=!0,t.container.show(),_.isFunction(e)&&e(n),s.utils.emojify()}),void 0):!1},getStories:function(e){var t=this,n={page:this.page++,per_page:this.options.per_page};_.each(Object.keys(this.options.params),function(e){n[e]=t.options.params[e]}),n.filter=this.filter.join(","),s.auth.user&&(n.username=s.auth.user.username,n._token=s.auth.user._token),$.ajax({url:s.api_url+"/"+this.options.path,data:n,dataType:this.options.dataType,success:function(t){t=s.utils.parseRes(t),_.isFunction(e)&&e(t.content.stories,t)},error:function(t){_.isFunction(e)&&e(null,t)}})}}),s.ElementList=s.Class.extend({initialize:function(e,t){var n=this;this.container=$(e),this.options={path:"elements",page:1,per_page:24,isOwner:!1,loadMore:!0,loadedOnce:!1,autoLoads:2,autoThreshold:20,loadText:"Show more",emptyText:"",filter:["quote","image","video","link"],elementTemplate:"_tile",params:{},dataType:"json"},this.setOptions(t),this.active=!0,this.loadedOnce=this.options.loadedOnce,this.page=this.options.page,this.autoLoads=this.options.autoLoads,this.loadButton=$('<button class="list-load element-list-load load-more box col3"><span>'+this.options.loadText+"</span></button>"),this.emptyMessage=$('<div class="list-empty element-list-empty">'+this.options.emptyText+"</div>"),this.filter=this.options.filter,this.container.append(this.emptyMessage),this.container.append(this.loadButton),this.options.loadMore||(this.loadButton.hide(),this.container.append($("<div>").addClass("clear"))),_.bindAll(this,"scroll","clickLoad","addToGrid"),this.autoLoads&&$(window).scroll(this.scroll),this.loadButton.click(this.clickLoad),$(document).ready(function(){n.container.masonry&&n.container.masonry({itemSelector:".box",columnWidth:300,gutterWidth:30})})},clickLoad:function(){this.update()},scroll:function(e){if(!this.active||this.container.is(":hidden"))return!0;this.scrollEvent=e;var t=$(window),n=this.loadButton.offset().top-t.scrollTop()-t.height()-this.options.autoThreshold;0>n&&(this.autoLoads--?this.update():$(window).unbind(this.scrollEvent))},activate:function(){this.active=!0},deactivate:function(){this.active=!1},applyFilter:function(e){this.filter=e,this.reset()},reset:function(e){this.container.find(".element").remove(),this.page=e||1,this.active=!0,this.loadedOnce=this.options.loadedOnce,this.autoLoads=this.options.autoLoads,this.loadButton.show(),$(window).unbind(this.scrollEvent),this.autoLoads&&$(window).scroll(this.scroll),this.update()},update:function(e){var t=this;return $(document).ready(function(){t.container.masonry&&t.container.masonry("reload")}),t.active?(t.active=!1,t.loadButton.attr("disabled",!0).addClass("loading").find("span").text("").show(),t.emptyMessage&&t.emptyMessage.hide?t.emptyMessage.hide():s.raven&&s.raven.started&&s.raven.Raven.captureMessage("element.list.js:134 : Issue with emptyMessage."),t.getElements(function(n,r){if(400==r.status||!n||!n.length)return t.loadButton.hide(),t.loadedOnce||t.emptyMessage.show(),void 0;t.loadedOnce||t.container.find(".box.element").remove();var i,a=[];_.each(n,function(e){e&&(i=s.templates.render("element/"+t.options.elementTemplate,{element:e,context:s.base_url}),$(i).data("json",e),a.push(i))}),t.addToGrid(a),_.each(t.container.find(".timestamp"),function(e){var t=$(e),n=t.attr("data-timestamp");t.text(s.utils.date(n).fromNow())}),_.isFunction(e)&&e(n),n.length<t.options.per_page?t.loadButton.hide():(t.loadButton.removeAttr("disabled").removeClass("loading").find("span").text(t.options.loadText),t.active=!0),t.loadedOnce=!0,t.container.show()}),void 0):!1},getElements:function(e){var t=this,n={page:this.page++,per_page:this.options.per_page},r=r?r:window.location.search,i={};if(r.length>0)for(var a,o=r.slice(1).split("&"),l=0;l<o.length;l++)a=o[l].split("="),i[a[0]]=a[1];_.each(i,function(e,t){n[t]=i[t]}),_.each(Object.keys(this.options.params),function(e){n[e]=t.options.params[e]}),s.auth&&s.auth.user&&(n.username=s.auth.user.username,n._token=s.auth.user._token),n.filter=this.filter.join(",");var u="/"+this.options.path;s.api.request("GET",u,n,{},function(t,n){t?_.isFunction(e)&&e(null,t):_.isFunction(e)&&e(n.content.elements,n)})},addToGrid:function(e){var t=this,n=$(e.join(""));this.loadButton.before(n),this.container.find(".box").each(function(e,t){var n=$(t).find(".front").height();$(t).css("height",n),$(t).find(".face").css("height",n),$(t).find(".view-inner").css("height",n-27)}),$(document).ready(function(){t.container.masonry&&t.container.masonry("appended",n).masonry("reload")})}}),!function(e,t,n){function r(e){if(n.getComputedStyle){var t=function(e){if(e){try{var r=n.getComputedStyle(e)}catch(i){return}if(r&&"string"==typeof r.backgroundColor){if("transparent"==r.backgroundColor)return t(e.parentNode);var s=r.backgroundColor.match(/\((.*)\)/);if(s&&!(s.length<2)){var a=s[1].split(", ");return 4==a.length&&"0"==a[3]?t(e.parentNode):a}}}},r=t(e);if(!r||"transparent"==r)return"white";if(4==r.length&&"0"==r[3])return"white";if(!(r.length<3)){var i=.299*r[0]+.587*r[1]+.114*r[2]>186?"white":"black";return i}}}function i(e,t){var n=document.createElement("script");n.type="text/javascript",n.readyState?n.onreadystatechange=function(){("loaded"==n.readyState||"complete"==n.readyState)&&(n.onreadystatechange=null,t())}:n.onload=function(){t()},n.src=e,document.body.appendChild(n)}function s(e,t){var n,r,i,s=[];try{if(document.querySelectorAll)s=document.querySelectorAll(e+"."+t);else if(document.getElementsByClassName)for(n=document.getElementsByClassName(t),r=0;i=n[r];r++)i.tagName.toLowerCase()==e&&s.push(i);else{n=document.getElementsByTagName(e);var o=RegExp("\\b"+t+"\\b");a(n,function(e){var t=e.className||e.getAttribute("class");t&&t.match(o)&&s.push(e)})}}catch(l){}return s}function a(e,t,n){for(var r=0;r<e.length;r++)t.call(n,e[r],r)}function o(e,t){n.addEventListener?n.addEventListener(e,t,!1):("message"==e&&(e="onmessage"),n.attachEvent(e,t))}function l(){var e=-1;if("Microsoft Internet Explorer"==navigator.appName){var t=navigator.userAgent,n=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=n.exec(t)&&(e=parseFloat(RegExp.$1))}return e}function u(e){this.options=e.options,this.more=!0,this.name=e.name,this.permalink=e.url.replace("https://storify.com/",p),this.src=this.permalink+(e.url.match(/.*\/$/)?"":"/")+"embed"+e.query,this.container=e.el,this.theme=r(this.container),v&&v[1]===this.name&&(this.src+="#"+v[2]),this.render(e)}var c=e.sfy;if(!c||"function"!=typeof c.loadAll){!function(e,t){function n(e){for(f=1;e=s.shift();)e()}var r,i,s=[],a=!1,o=t.documentElement,l=o.doScroll,u="DOMContentLoaded",c="addEventListener",d="onreadystatechange",f=/^loade|c/.test(t.readyState);t[c]&&t[c](u,i=function(){t.removeEventListener(u,i,a),n()},a),l&&t.attachEvent(d,r=function(){/^c/.test(t.readyState)&&(t.detachEvent(d,r),n())}),e.domReady=l?function(t){self!=top?f?t():s.push(t):function(){try{o.doScroll("left")}catch(n){return setTimeout(function(){e.domReady(t)},50)}t()}()}:function(e){f?e():s.push(e)}}(e,t);var c={};e.sfy=c;var d=l(),f=!!n.postMessage&&(-1==d||d>=8),h=e.s||{},p=(h.base_url||"<%= base_url %>")+"/",m={},g=100,v=window.location.hash.match(/#sfy-(.+?-.+)-([0-9a-z]{6})/);u.prototype={render:function(){var e=this;this.options.template&&(this.src=p+"public/templates/"+this.options.template+"/index.html?src="+encodeURIComponent(this.permalink)+"&theme="+this.theme,this.options.header&&(this.src+="&header="+this.options.header),this.options.title&&(this.src+="&title="+this.options.title),this.options.canonical&&(this.src+="&canonical="+this.options.canonical));for(var n=document.getElementsByTagName("iframe"),r=0;r<n.length;r++){var i=n[r];if(i&&i.src&&i.src.match(new RegExp("^(https?:)?"+this.permalink))){this.iframe=i;break}}if(this.iframe?this.container=this.iframe.parentElement:this.iframe=t.createElement("iframe"),this.iframe.setAttribute("src",this.src),this.iframe.setAttribute("name",name),this.iframe.setAttribute("scrolling","no"),this.iframe.setAttribute("frameBorder","no"),this.iframe.setAttribute("allowTransparency","true"),this.iframe.style.display="block",this.iframe.style.backgroundColor="transparent",this.iframe.style.border="none",this.iframe.style.overflowX="hidden",this.iframe.style.overflowY="hidden",this.iframe.style.width=Math.min(this.container.clientWidth,900)+"px",this.iframe.style.maxWidth="900px",this.iframe.style.height=this.options.canonical?"40px":"700px",o("resize",function(){var t=Math.min(e.container.clientWidth,900)+"px";e.iframe.style.width=t,e.headerIframe&&(e.headerIframe.style.width=t)}),f||(this.iframe.style.overflowY="auto",this.iframe.setAttribute("scrolling","auto"),this.iframe.style.border="1px solid #ddd"),this.container.style.display="block",this.container.style.clear="left","slideshow"==this.options.template){var s=t.createElement("img");s.src=p+"public/img/ratio-5-8.png",s.style.width="100%",s.width="100%",this.iframe.style.position="absolute",this.iframe.style.top=0,this.iframe.style.left=0,this.iframe.style.height="100%",this.container.style.position="relative",this.container.appendChild(s)}else this.iframe.addEventListener?this.iframe.addEventListener("load",function(){},!1):this.iframe.attachEvent&&this.iframe.attachEvent("onload",function(){e.iframe.style.height=this.screen.height});this.iframe.parentElement||this.container.appendChild(this.iframe)},resize:function(e){e!=this.height&&(this.loading=!1,this.height=e,this.iframe.style.height=this.iframe.style.minHeight=e+"px")},storify:function(e){try{var e=JSON.parse(e),t={utm_medium:"embed",utm_source:window.location.hostname}}catch(n){return console&&console.error("STORIFY EMBED ERROR 1 : (storify-action) ",n),void 0}if(e.via=e.via||window.location.href,sfy&&sfy.showModal)sfy.showModal(e,t);else{sfy={},SFY_DISABLE_MODAL_ONLOAD=!0;var r=0;i(p+"public/js/bookmarklet.js",function(){var n=setInterval(function(){r++,"function"==typeof sfy.showModal&&(clearInterval(n),sfy.showModal(e,t)),r>20&&(clearInterval(n),console&&console.error("Storify> Could not load the sfy.showModal script"))},500)})}},noMoreElements:function(){this.more=!1},loadExternalNavIframe:function(e){var t=document.createElement("iframe"),n="header-"+e.storyId;document.getElementById(n)||(t.setAttribute("class","s-header-ext s-header-iframe_"+this.name),t.width="100%",t.frameBorder="no",t.allowtransparency="true",t.scrolling="no",t.setAttribute("style","border: none; display: none; height: 40px; overflow: hidden; position: fixed; top: 0; width:"+this.iframe.offsetWidth+"px"),t.setAttribute("id",n),this.headerIframe=this.iframe.parentElement.insertBefore(t,this.iframe),this.headerIframe.contentWindow.document.write(e.html),this.headerIframe.contentWindow.document.close())},toggleExternalNav:function(){if(this.headerIframe){var e=this.iframe.getBoundingClientRect().top+20,t="number"==typeof window.pageYOffset?window.pageYOffset:document.documentElement.scrollTop,n=t>e,r=t<e+this.iframe.offsetHeight-50;this.headerIframe.style.display=n&&r?"block":"none"}},login:function(e){"object"==typeof h&&h.auth&&(h.auth.setUser(e),h.auth.setUserCookie(null),h.nav&&h.nav.updateUser())},scroll:function(e){var t=this.container;do e+=t.offsetTop;while(t=t.offsetParent);var n="number"==typeof window.pageYOffset?window.pageYOffset:document.documentElement.scrollTop;y(250,y.easeOut,function(t){window.scroll(0,n+(e-n)*t)})},setHash:function(e){window.location.hash="#sfy-"+this.name+"-"+e.slice(1)}};var y=function(){function e(e,t,n,a){var o=r();i(function l(u){s&&(u=r());var c=u-o;if(c>e)n(1),"function"==typeof a&&a();else{var d=n(t(c/e));d!==!1&&i(l)}})}var t=window.performance,n=t&&(t.now||t.webkitNow||t.msNow||t.mozNow),r=n?n.bind(t):function(){return Date.now?Date.now():(new Date).getTime()},i=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return window.setTimeout(function(){return e(r())},1e3/60)},s=!1;return i(function(e){s=e>1e12!=r()>1e12}),e.linear=function(e){return e},e.easeOut=function(e){return Math.sin(e*Math.PI/2)},e}();c.load=function(e){var t={el:e},n=[],r={};a(["url","username","slug","preview","canonical"],function(n){t[n]=e.getAttribute(n)}),a(["template","header","border","css","canonical","title"],function(t){var i=e.getAttribute(t);i&&(n.push(t+"="+i),r[t]=i)}),"object"==typeof h&&h.auth&&h.auth.user&&n.push("timestamp="+(new Date).valueOf()),t.options=r,t.url&&t.url.indexOf(p)>-1||!t.username||!t.slug||(t.url=p+t.username+"/"+t.slug,t.preview&&(t.url+="/preview"));var i=t.url.replace(new RegExp(".{0,10}"+p,"i"),"").replace("/","-").replace("/preview","");r.template&&(i+="_"+r.template),t.query="?"+n.join("&"),t.name=i,m[i]=m[i]||new u(t)},c.convertScripts=function(e){var n=t.getElementsByTagName("script"),r=n.length;a(n,function(n){var i=n.getAttribute("src");if(i&&i.indexOf(p)>-1&&!i.match(/public\/js\/(embed|support)/)&&!i.match(/placeholder\.js/)){var s=t.createElement("div"),o=i.substring(0,i.indexOf(".js")),l=o.replace(p,"").replace("/","-"),u=i.indexOf("?"),c=i.indexOf("=",u),d=u>0&&u<i.length&&c>u?i.substring(u+1).split("&"):[];m[l]||(s.setAttribute("class","sfy-story"),s.setAttribute("url",o),a(d,function(e){var e=e.split("=");s.setAttribute(e[0],e[1])}),n.parentNode.insertBefore(s,n))}return--r<=0?e():void 0})},c.loadAll=function(){c.convertScripts(function(){var e=s("div","sfy-story");a(e,c.load)})},e.domReady(function(){o("message",function(e){if(e.origin.match(/\.?storify\.com/)&&"tic!"!==e.data&&"string"==typeof e.data)try{var t=JSON.parse(e.data),n=m[t.sourceName],r=t.method;n&&n[r]&&n[r].apply(n,[t.value])}catch(e){return console&&console.error("STORIFY EMBED ERROR 2 : ",e),void 0}}),o("scroll",function(){for(var e in m){var t=m[e];if(t.toggleExternalNav(),t.loading)break;var n=t.container,r=0;do r+=n.offsetTop;while(n=n.offsetParent);if(t.more){var i=r+t.container.offsetHeight-window.scrollY-window.innerHeight-g;0>i&&(t.loading=!0,t.iframe.contentWindow&&t.iframe.contentWindow.postMessage("loadMore","*"))}var s=r+200-window.scrollY,a=s>0;a!=t.autoReload&&(t.autoReload=a,t.iframe.contentWindow&&t.iframe.contentWindow.postMessage(t.autoReload?"enableAutoReload":"disableAutoReload","*"))}}),o("hashchange",function(){var e=window.location.hash.match(/#sfy-(.+?-.+)-([0-9a-z]{6})/),t=e&&m[e[1]];t&&t.iframe.contentWindow.postMessage("hashchange:"+e[2],"*")}),c.loadAll()})}}(this,document,window),s.Header=s.Class.extend({initialize:function(){_.bindAll(this,"submitForm","toggleDropdown","closeDropdown","showSearchBar","hideSearchBar","openMobileMenu","closeMobileMenu","handleResize"),this.el={window:$(window),container:$("#container"),form:$("#header form"),searchBar:$("#header form input"),searchIcon:$("#header form .storifycon-search"),remoteUser:$("#header .full .remote-user"),dropdown:$("#header .full .options"),mobileSearchButton:$("#header .mobile .storifycon-search"),mobileMenuButton:$("#header .mobile .storifycon-hamburger"),mobileCloseButton:$("#header .mobile .storifycon-x"),mobileMenu:$("#mobile-menu"),mobileMenuOverlay:$("#mobile-menu-overlay")};for(var e=["-webkit-transform","-moz-transform","-o-transform","-ms-transform","transform"],t=0;t<e.length;t++)this.el.container.css(e[t])&&(this.transformProperty=e[t]);this.el.searchIcon.click(this.submitForm),this.el.remoteUser.click(this.toggleDropdown),$("html").click(this.closeDropdown),this.el.mobileSearchButton.click(this.showSearchBar),this.el.mobileCloseButton.click(this.hideSearchBar),this.mobileMenuOpen=!1,this.el.mobileMenuButton.click(this.openMobileMenu),this.el.mobileMenuOverlay.click(this.closeMobileMenu),this.el.window.resize(this.handleResize)},submitForm:function(){this.el.form.submit()},toggleDropdown:function(){this.el.dropdown.toggleClass("visible")},closeDropdown:function(e){var t=$(e.target),n=t[0]===this.el.remoteUser[0]||-1!==t.parents().index(this.el.remoteUser);!n&&this.el.dropdown.removeClass("visible")},showSearchBar:function(){this.el.form.addClass("visible"),this.el.mobileMenuButton.addClass("hidden"),this.el.mobileCloseButton.addClass("visible"),this.el.searchBar.focus()},hideSearchBar:function(){this.el.form.removeClass("visible"),this.el.mobileMenuButton.removeClass("hidden"),this.el.mobileCloseButton.removeClass("visible")},openMobileMenu:function(){this.el.mobileMenuOverlay.removeClass("hidden");var e=window.innerWidth-56;this.el.mobileMenu.removeClass("hidden").width(e);var t=Math.max(window.innerHeight,this.el.mobileMenu.height());this.el.mobileMenu.height(t),this.el.container.css({height:t,overflow:"hidden"}).css(this.transformProperty,"translateX(-"+e+"px)"),this.mobileMenuOpen=!0},closeMobileMenu:function(){this.el.mobileMenu.addClass("hidden"),this.el.container.css({height:"",overflow:""}).css(this.transformProperty,""),this.el.mobileMenuOverlay.addClass("hidden"),this.mobileMenuOpen=!1},handleResize:function(){if(this.mobileMenuOpen){var e=window.innerWidth-56;this.el.mobileMenu.width(e);var t=Math.max(window.innerHeight,this.el.mobileMenu.height());this.el.mobileMenu.height(t),this.el.container.css("height",t).css(this.transformProperty,"translateX(-"+e+"px)")}}}),s.Website=s.Class.extend({initialize:function(){this.el={subscribersCount:$(".user-stats .subscribers"),subscriptionsCount:$(".user-stats .subscriptions"),subscribersModal:$("#subscribers"),subscriptionsModal:$("#subscriptions"),loginButton:$("#login-button"),signupButton:$("#signup-button"),contactLink:$("#contact-link"),contactModal:$("#contact")},_.bindAll(this,"addNextParam","showContactModal","hideContactModal");var e=s.auth&&s.auth.user?s.auth.user.paid_plan:"prospect",t="free"!==e&&"prospect"!==e?"pro":"";$("body").addClass(e).addClass(t),$("#head").length>0&&(s.nav=new s.Nav),s.search=new s.Search("#search"),setInterval(function(){_.each($(".timestamp"),function(e){var t=$(e),n=t.attr("data-timestamp");s.utils&&t.text(s.utils.date(n).fromNow())})},6e4),this.el.contactLink.click(this.showContactModal),this.el.contactModal.click(this.hideContactModal),this.addNextParam()},addNextParam:function(){var e=encodeURIComponent(window.location.pathname);this.el.loginButton.attr("href","/login?next="+e),this.el.signupButton.attr("href","/signup?next="+e)},showContactModal:function(e){e.preventDefault(),this.el.contactModal.show()},hideContactModal:function(e){"contact"===$(e.target).attr("id")&&this.el.contactModal.hide()}}),s.Search=s.Class.extend({initialize:function(e){var t=this;this.el={form:$(e),input:$(e).find("input"),button:$(e).find("button"),logo:$("h1#logo a"),buttonGroup:$("ul.button-group"),nav:$("#head .nav"),close:$("#landing-message .close")},_.bindAll(this,"resizeInput","showFocus","hideFocus","expand","collapse","submit","track","close"),this.el.input.bind("focus",this.showFocus),this.el.input.bind("blur",this.hideFocus),this.el.form.bind("submit",this.submit),this.el.close.bind("click",this.close),this.el.button.bind("click",function(){return $(window).width()<660&&!t.el.input.is(":visible")?(t.expand(),!1):void 0}),this.el.input.bind("blur",function(){$(window).width()<660&&t.collapse()}),this.resizeInput(),$(window).bind("resize",this.resizeInput),this.track(),s.store&&s.store.get("user")||s.cookie.get("welcome")&&1==s.cookie.get("welcome")||$("#landing-message").show()},resizeInput:function(){this.el.input.is(":focus")&&this.el.input.blur(),$(window).width()<660?this.el.input.hide():this.el.input.show()},showFocus:function(){this.el.form.addClass("focus")},hideFocus:function(){this.el.form.removeClass("focus")},expand:function(){this.el.input.show().focus(),this.el.buttonGroup.hide(),this.el.nav.hide()},collapse:function(){this.el.input.addClass("default").hide(),this.el.buttonGroup.show(),this.el.nav.show()},submit:function(){return""==this.el.input.val()?!1:void 0},track:function(){""!=this.el.input.val()&&(analytics.track("search",{context:"results",query:this.el.input.val()}),$("body").attr("data-query",this.el.input.val()))},close:function(){$("#landing-message").hide(),s.cookie.get("welcome")+1,s.cookie.set("welcome",!0)}}),!function(e){var t,n,r={base:window.storifyBase||"//storify.com",protocol:"http"==window.location.protocol.substr(0,4)?window.location.protocol:"http:",scripts:["support/jquery.pm.js","support/jquery.spin.js"],url:window.location.href,services:{flickr:/https?:\/\/(.*)\.?flickr\.com/,gplus:/https?:\/\/plus\.google\.com/,instagram:/https?:\/\/(.*)\.?(instagr\.am|instagram.com)\/p/,reddit:/https?:\/\/(.*)\.?reddit\.com/,twitter:/https?:\/\/(.*)\.?twitter\.com/,twitterArchive:/file.*Tweets.*/,pinterest:/https?:\/\/(.*)\.?pinterest\.com/,youtube:/https?:\/\/(.*)\.?youtube\.com\/watch/,topsy:/https?:\/\/(.*)\.?topsy\.com/}},i=function(e,n){"object"!=typeof e&&(e=[e]);var i=e.length,s=function(){--i||n&&n()};t.each(e,function(e,n){t.ajax({url:r.protocol+r.base+"/public/shared/js/"+n,dataType:"script",success:s,async:!0})})},s=function(e){var t;for(var n in r.services)if(t=r.services[n],e.match(t))return n},a=function(){!function(e){var t,n,r,i,s=1,a=this,o=!1,l="postMessage",u="addEventListener",c=a[l]&&!e.browser.opera;e[l]=function(t,n,r){n&&(t="string"==typeof t?t:e.param(t),r=r||parent,c?r[l](t,n.replace(/([^:]+:\/\/[^\/]+).*/,"$1")):n&&(r.location=n.replace(/#.*$/,"")+"#"+ +new Date+s++ +"&"+t))},e.receiveMessage=i=function(s,l,d){c?(s&&(r&&i(),r=function(t){return"string"==typeof l&&t.origin!==l||e.isFunction(l)&&l(t.origin)===o?o:(s(t),void 0)
}),a[u]?a[s?u:"removeEventListener"]("message",r,o):a[s?"attachEvent":"detachEvent"]("onmessage",r)):(t&&clearInterval(t),t=null,s&&(d="number"==typeof l?l:"number"==typeof d?d:100,t=setInterval(function(){var e=document.location.hash,t=/^#?\d+&/;e!==n&&t.test(e)&&(n=e,s({data:e.replace(t,"")}))},d)))}}(n),function(e,t,n){function r(e,n){var r,i=t.createElement(e||"div");for(r in n)i[r]=n[r];return i}function i(e){for(var t=1,n=arguments.length;n>t;t++)e.appendChild(arguments[t]);return e}function s(e,t,n,r){var i=["opacity",t,~~(100*e),n,r].join("-"),s=.01+100*(n/r),a=Math.max(1-(1-e)/t*(100-s),e),o=c.substring(0,c.indexOf("Animation")).toLowerCase(),l=o&&"-"+o+"-"||"";return f[i]||(h.insertRule("@"+l+"keyframes "+i+"{"+"0%{opacity:"+a+"}"+s+"%{opacity:"+e+"}"+(s+.01)+"%{opacity:1}"+(s+t)%100+"%{opacity:"+e+"}"+"100%{opacity:"+a+"}"+"}",0),f[i]=1),i}function a(e,t){var r,i,s=e.style;if(s[t]!==n)return t;for(t=t.charAt(0).toUpperCase()+t.slice(1),i=0;i<d.length;i++)if(r=d[i]+t,s[r]!==n)return r}function o(e,t){for(var n in t)e.style[a(e,n)||n]=t[n];return e}function l(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)e[i]===n&&(e[i]=r[i])}return e}function u(e){for(var t={x:e.offsetLeft,y:e.offsetTop};e=e.offsetParent;)t.x+=e.offsetLeft,t.y+=e.offsetTop;return t}var c,d=["webkit","Moz","ms","O"],f={},h=function(){var e=r("style");return i(t.getElementsByTagName("head")[0],e),e.sheet||e.styleSheet}(),p={lines:12,length:7,width:5,radius:10,rotate:0,color:"#000",speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto"},m=function g(e){return this.spin?(this.opts=l(e||{},g.defaults,p),void 0):new g(e)};m.defaults={},l(m.prototype,{spin:function(e){this.stop();var t,n,i=this,s=i.opts,a=i.el=o(r(0,{className:s.className}),{position:"relative",zIndex:s.zIndex}),l=s.radius+s.length+s.width;if(e&&(e.insertBefore(a,e.firstChild||null),n=u(e),t=u(a),o(a,{left:("auto"==s.left?n.x-t.x+(e.offsetWidth>>1):s.left+l)+"px",top:("auto"==s.top?n.y-t.y+(e.offsetHeight>>1):s.top+l)+"px"})),a.setAttribute("aria-role","progressbar"),i.lines(a,i.opts),!c){var d=0,f=s.fps,h=f/s.speed,p=(1-s.opacity)/(h*s.trail/100),m=h/s.lines;!function g(){d++;for(var e=s.lines;e;e--){var t=Math.max(1-(d+e*m)%h*p,s.opacity);i.opacity(a,s.lines-e,t,s)}i.timeout=i.el&&setTimeout(g,~~(1e3/f))}()}return i},stop:function(){var e=this.el;return e&&(clearTimeout(this.timeout),e.parentNode&&e.parentNode.removeChild(e),this.el=n),this},lines:function(e,t){function n(e,n){return o(r(),{position:"absolute",width:t.length+t.width+"px",height:t.width+"px",background:e,boxShadow:n,transformOrigin:"left",transform:"rotate("+~~(360/t.lines*l+t.rotate)+"deg) translate("+t.radius+"px"+",0)",borderRadius:(t.width>>1)+"px"})}for(var a,l=0;l<t.lines;l++)a=o(r(),{position:"absolute",top:1+~(t.width/2)+"px",transform:t.hwaccel?"translate3d(0,0,0)":"",opacity:t.opacity,animation:c&&s(t.opacity,t.trail,l,t.lines)+" "+1/t.speed+"s linear infinite"}),t.shadow&&i(a,o(n("#000","0 0 4px #000"),{top:"2px"})),i(e,i(a,n(t.color,"0 0 1px rgba(0,0,0,.1)")));return e},opacity:function(e,t,n){t<e.childNodes.length&&(e.childNodes[t].style.opacity=n)}}),!function(){function e(e,t){return r("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',t)}var t=o(r("group"),{behavior:"url(#default#VML)"});!a(t,"transform")&&t.adj?(h.addRule(".spin-vml","behavior:url(#default#VML)"),m.prototype.lines=function(t,n){function r(){return o(e("group",{coordsize:u+" "+u,coordorigin:-l+" "+-l}),{width:u,height:u})}function s(t,s,a){i(d,i(o(r(),{rotation:360/n.lines*t+"deg",left:~~s}),i(o(e("roundrect",{arcsize:1}),{width:l,height:n.width,left:n.radius,top:-n.width>>1,filter:a}),e("fill",{color:n.color,opacity:n.opacity}),e("stroke",{opacity:0}))))}var a,l=n.length+n.width,u=2*l,c=2*-(n.width+n.length)+"px",d=o(r(),{position:"absolute",top:c,left:c});if(n.shadow)for(a=1;a<=n.lines;a++)s(a,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(a=1;a<=n.lines;a++)s(a);return i(t,d)},m.prototype.opacity=function(e,t,n,r){var i=e.firstChild;r=r.shadow&&r.lines||0,i&&t+r<i.childNodes.length&&(i=i.childNodes[t+r],i=i&&i.firstChild,i=i&&i.firstChild,i&&(i.opacity=n))}):c=a(t,"animation")}(),e.Spinner=m}(window,document),t.fn.spin=function(e){return this.each(function(){var n=t(this),r=n.data();r.spinner&&(r.spinner.stop(),delete r.spinner),e!==!1&&(r.spinner=new Spinner(t.extend({color:n.css("color")},e)).spin(this))}),this}},o=function(){a(),i("storify-common.js",function(){sfy.storifyUrl=r.protocol+r.base,sfy.getURL=function(e){return sfy.storifyUrl+"/public/shared/"+e},sfy.loadCSS("css/storify-common.css");var e=s(window.location.href),n="true"==t("body").attr("storify-loaded")||"storifychrome"==t("html").attr("STORIFY_APPNAME"),a=window.location.hostname.match(/storify\.com/);if(e&&t("head").length)i("storify-"+e+".js",function(){if(!n&&!a){var e=t('<div id="storify-notification">');e.text("Storify buttons have been added to the page."),t("html").append(e),setTimeout(function(){e.fadeOut()},3e3)}});else{if(n||a||"boolean"==typeof SFY_DISABLE_MODAL_ONLOAD)return;sfy.showModal({permalink:window.location.href})}})};if(void 0===e.jQuery||1.7!==parseFloat(e.jQuery.fn.jquery)){var l=document.head||document.getElementsByTagName("head")[0]||document.documentElement,u=document.createElement("script");u.async="async",u.type="text/javascript",u.src=r.protocol+"//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js",u.onload=u.onreadystatechange=function(){(!u.readyState||/loaded|complete/.test(u.readyState))&&(u.onload=u.onreadystatechange=null,l&&u.parentNode&&l.removeChild(u),u=void 0,t=n=e.jQuery.noConflict(!0),sfy$=t,o())},l.insertBefore(u,l.firstChild)}else t=n=e.jQuery,sfy$=t,o()}(window),s.ProfileBox=s.Class.extend({initialize:function(){_.bindAll(this,"loadMore","removeUser","followHoverIn","followHoverOut","followClick","followOtherHoverIn","followOtherHoverOut","followOtherClick"),this.options={page:1,per_page:15,total:0},this.el={follow:$("#user-follow"),remove:$("#user-remove"),followersCount:$(".user-stats .subscribers strong"),followersText:$(".user-stats .subscribers span"),followingCount:$(".user-stats .subscriptions strong"),followingText:$(".user-stats .subscriptions span"),followOther:$("#users-list .user button"),usersList:$("#users-list #users"),loadMore:$("#users-list .load-more"),userFollowContainer:$(".user-follow-container")},this.el.follow.live("mouseenter",this.followHoverIn),this.el.follow.live("mouseleave",this.followHoverOut),this.el.follow.live("click",this.followClick),this.el.followOther.live("mouseenter",this.followOtherHoverIn),this.el.followOther.live("mouseleave",this.followOtherHoverOut),this.el.followOther.live("click",this.followOtherClick),this.el.remove.click(this.removeUser),this.el.loadMore.click(this.loadMore)},removeUser:function(){if(confirm("Are you sure?")){var e="/users/"+s.user.username+"/remove",t={username:s.auth.user.username,_token:s.auth.user._token};s.api.request("POST",e,t,{},function(e){e?s.notify.error("Error removing",{element:"#content",slideSpeed:200,duration:3e3}):s.notify.success("Successfully removed",{element:"#content",slideSpeed:200,duration:3e3})})}},followHoverIn:function(){this.el.follow.hasClass("cancel")&&this.el.follow.removeClass("cancel").addClass("decline").html("<span>✖ "+t("Unfollow")+"</span>")},followHoverOut:function(){this.el.follow.hasClass("decline")&&this.el.follow.removeClass("decline").addClass("cancel").html("<span>✔ "+t("Following")+"</span>")},followClick:function(e){var n=this;return s.auth.user?(s.nav&&s.nav.updateUser(),n.el.follow.attr("disabled",!0),n.el.follow.hasClass("accept")?(n.el.follow.html("<span>"+t("Following")+"</span>"),s.auth.follow(s.user.username,function(e){if(n.el.follow.removeAttr("disabled").html("<span>✚ "+t("Follow")+"</span>"),e)return s.notify.error(t("Unable to follow __name__ at this time, please try again later",{name:s.user.name||s.user.username}),{element:"#content",duration:4e3}),void 0;n.el.follow.removeClass("accept").addClass("cancel").html("<span>✔ "+t("Following")+"</span>");var r=1*n.el.followersCount.text()+1;n.el.followersCount.text(r);var i=1===r?t("follower"):t("followers");n.el.followersText.text(i)})):(n.el.follow.html("<span>"+t("Unfollowing")+"</span>"),s.auth.unfollow(s.user.username,function(e){if(n.el.follow.removeAttr("disabled").html("<span>✔ "+t("Following")+"</span>"),e)return s.notify.error(t("Unable to unfollow __name__ at this time, please try again later",{name:s.user.name||s.user.username}),{element:"#content",duration:4e3}),void 0;n.el.follow.removeClass("cancel decline").addClass("accept").html("<span>✚ "+t("Follow")+"</span>");var r=1*n.el.followersCount.text()-1;n.el.followersCount.text(r);var i=1===r?t("follower"):t("followers");n.el.followersText.text(i)})),void 0):(s.auth.loginPopup(function(t,r){!t&&r&&n.followClick(e)}),void 0)},followOtherHoverIn:function(e){var n=$(e.target).parents(".user").find("button");n.hasClass("cancel")&&n.removeClass("cancel").addClass("decline").html("<span>✖ "+t("Unfollow")+"</span>")},followOtherHoverOut:function(e){var n=$(e.target).parents(".user").find("button");n.hasClass("decline")&&n.removeClass("decline").addClass("cancel").html("<span>✔ "+t("Following")+"</span>")},followOtherClick:function(e){var n=this,r=$(e.target).parents(".user").find("button"),i=r.parents(".user").data("username");return s.auth.user?(s.nav&&s.nav.updateUser(),r.attr("disabled",!0),r.hasClass("accept")?(r.html("<span>"+t("Following")+"</span>"),s.auth.follow(i,function(e){if(r.removeAttr("disabled").html("<span>✚ "+t("Follow")+"</span>"),e)return s.notify.error(t("Unable to follow __name__ at this time, please try again later",{name:i}),{element:"#content",duration:4e3}),void 0;if(r.removeClass("accept").addClass("cancel").html("<span>✔ "+t("Following")+"</span>"),s.auth.user.username===s.user.username){var a=1*n.el.followingCount.text()+1;n.el.followingCount.text(a);var o=t("following");n.el.followingText.text(o)}})):(r.html("<span>"+t("Unfollowing")+"</span>"),s.auth.unfollow(i,function(e){if(r.removeAttr("disabled").html("<span>✔ "+t("Following")+"</span>"),e)return s.notify.error(t("Unable to unfollow __name__ at this time, please try again later",{name:i}),{element:"#content",duration:4e3}),void 0;if(r.removeClass("cancel decline").addClass("accept").html("<span>✚ "+t("Follow")+"</span>"),s.auth.user.username===s.user.username){var a=1*n.el.followingCount.text()-1;n.el.followingCount.text(a);var o=t("following");n.el.followingText.text(o)}})),void 0):(s.auth.showLogin(_.bind(this.followClick,this)),void 0)},loadMore:function(e){var n=$(e.currentTarget).data("type"),r=this;r.el.loadMore.attr("disabled",!0).addClass("loading").find("span").text("");var i={page:++r.options.page,per_page:r.options.per_page};s.auth.user&&(i.username=s.auth.user.username,i._token=s.auth.user._token);var a="/users/"+s.user.username+"/"+n;s.api.request("GET",a,i,{},function(e,i){if(e)r.el.loadMore.attr("disabled",!1).removeClass("loading").find("span").text(t("Show more")),s.notify.error("An error occured",{element:"#content",duration:4e3});else{for(var a=i.content[n],o=a.length,l=0;o>l;l++){var u=s.templates.render("user/_user",{s_user:a[l],s_auth_user:s.auth.user});r.el.usersList.append(u)}r.el.loadMore.attr("disabled",!1).removeClass("loading").find("span").text(t("Show more")),r.options.total+=o,(0==o||s.user.stats&&r.options.total>=s.user.stats[n])&&r.el.loadMore.hide()}})}}),s.pages.Profile=s.Class.extend({initialize:function(){var e=this;_.bindAll(this,"click","edit","cancel","save","followHoverIn","followHoverOut","followClick","activateTab","removeUser","showStories","resizeCoverPhoto","saveFeaturedStories","reloadFeaturedStories","showFeatureMenu","feature","unfeature"),this.isAuthor=s.auth&&s.auth.user&&s.auth.user.username==s.user.username,this.canEdit=this.isAuthor||s.user.canEdit,this.el={edit:$("#user-edit"),editing:$(".editing"),editCancel:$("#user-edit-cancel"),editSave:$("#user-edit-save"),follow:$("#user-follow"),remove:$("#user-remove"),followUsers:$(".user-follow-user"),followers:$("#subscribers"),following:$("#subscriptions"),followersCount:$(".user-stats .subscribers strong"),followersText:$(".user-stats .subscribers span"),followingCount:$(".user-stats .subscriptions strong"),followingText:$(".user-stats .subscriptions span"),userFollowContainer:$(".user-follow-container"),coverPhoto:$("#user-cover-photo"),storiesTab:$(".filter .tab.stories"),topStories:$("#top-stories"),allStories:$("#top-stories>button"),featureButton:$("#user-admin a.feature"),featureMenu:$("#user-admin .category-menu li"),unfeatureButton:$("#user-admin a.unfeature"),flagLink:$("#user-admin a.flag"),unflagLink:$("#user-admin a.unflag")},$(document).ready(function(){e.options={page:1,per_page:15},e.options.total=e.options.per_page,e.list=[new s.StoryList("#profile-stories",{path:"stories/"+s.user.username,params:{sort:"date.created"},emptyText:t("self user doesn't have any published stories yet")})],e.tabs=new s.Tabs("#browse-content",{activate:e.activateTab,lists:e.list}),e.storyControl=new s.StoryControl,e.elementControl=new s.ElementControl,e.canEdit&&(e.list[0].container.find(".story-toolbar").show(),$("#user #top-stories .story-toolbar").show()),_.each($(".timestamp"),function(e){var t=$(e),n=t.attr("data-timestamp");t.text(s.utils.date(n).fromNow())}),e.el.edit.click(e.edit),e.el.editing.click(e.click),e.el.editCancel.click(e.cancel),e.el.editSave.click(e.save),e.el.follow.live("mouseenter",e.followHoverIn),e.el.follow.live("mouseleave",e.followHoverOut),e.el.follow.live("click",e.followClick),e.el.remove.click(e.removeUser),s.auth&&s.auth.user&&"#subscribe"==window.location.hash&&e.el.follow.hasClass("accept")&&(e.el.follow.click(),s.notify.success(t("You are now following __name__",{name:s.user.name||s.user.username})+".",{element:"#content",slideSpeed:200,duration:3e3})),e.el.allStories.click(e.showStories),e.el.featureButton.live("click",e.showFeatureMenu),e.el.featureMenu.live("click",e.feature),e.el.unfeatureButton.live("click",e.unfeature),e.el.flagLink.live("click",e.flag),e.el.unflagLink.live("click",e.unflag),e.el.topStories.show(),e.resizeCoverPhoto(),$(window).resize(e.resizeCoverPhoto)})},removeUser:function(){if(confirm("Are you sure?")){var e="/users/"+s.user.username+"/remove",t={username:s.auth.user.username,_token:s.auth.user._token};s.api.request("POST",e,t,{},function(e){e?s.notify.error("Error removing",{element:"#content",slideSpeed:200,duration:3e3}):s.notify.success("Successfully removed",{element:"#content",slideSpeed:200,duration:3e3})})}},activateTab:function(e){this.list[e].update()},followHoverIn:function(){this.el.follow.hasClass("cancel")&&this.el.follow.removeClass("cancel").addClass("decline").html("<span>✖ "+t("Unfollow")+"</span>")},followHoverOut:function(){this.el.follow.hasClass("decline")&&this.el.follow.removeClass("decline").addClass("cancel").html("<span>✔ "+t("Following")+"</span>")},followClick:function(e){var n=this;return s.auth.user?(s.nav&&s.nav.updateUser(),n.el.follow.attr("disabled",!0),n.el.follow.hasClass("accept")?(n.el.follow.html("<span>"+t("Following")+"</span>"),s.auth.follow(s.user.username,function(e){if(n.el.follow.removeAttr("disabled").html("<span>✚ "+t("Follow")+"</span>"),e)return s.notify.error(t("Unable to follow __name__ at this time, please try again later",{name:s.user.name||s.user.username}),{element:"#content",duration:4e3}),void 0;n.el.follow.removeClass("accept").addClass("cancel").html("<span>✔ "+t("Following")+"</span>");var r=1*n.el.followersCount.text()+1;if(r){n.el.followersCount.text(r);var i=1===r?t("follower"):t("followers");n.el.followersText.text(i)}})):(n.el.follow.html("<span>"+t("Unfollowing")+"</span>"),s.auth.unfollow(s.user.username,function(e){if(n.el.follow.removeAttr("disabled").html("<span>✔ "+t("Following")+"</span>"),e)return s.notify.error(t("Unable to unfollow __name__ at this time, please try again later",{name:s.user.name||s.user.username}),{element:"#content",duration:4e3}),void 0;n.el.follow.removeClass("cancel decline").addClass("accept").html("<span>✚ "+t("Follow")+"</span>");var r=1*n.el.followersCount.text()-1;if(r){n.el.followersCount.text(r);var i=1===r?t("follower"):t("followers");n.el.followersText.text(i)}})),void 0):(s.auth.loginPopup(function(t,r){!t&&r&&n.followClick(e)}),void 0)},click:function(e){$(e.currentTarget).attr("readonly")&&this.edit()},edit:function(){return $(".editing").each(function(){var e=$(this);e.data("last",e.val()).removeAttr("readonly")}),$("#user-edit").hide(),$(".user-editing").fadeIn(),!1},cancel:function(){$(".editing").each(function(){var e=$(this);e.val(e.data("last")).attr("readonly",!0)}),$(".user-editing").hide(),$("#user-edit").fadeIn()},save:function(){var e={bio:$(".user-bio").val()||"",location:$(".user-location").val()||"",website:$(".user-website").val()||""},t="/users/"+s.user.username+"/update",n={username:s.auth.user.username,_token:s.auth.user._token,user:JSON.stringify(e)};s.api.request("POST",t,n,{},function(e,t){e?($(".editing").attr("readonly",!0),$(".user-editing").hide(),$("#user-edit").fadeIn()):(s.auth.setUser(t.content),s.auth.setUserCookie(),$(".editing").attr("readonly",!0),$(".user-editing").hide(),$("#user-edit").fadeIn())})},resizeCoverPhoto:function(){var e,t,n,r,i=this,s=i.el.coverPhoto.data("width"),a=i.el.coverPhoto.data("height"),o=s/a,l=i.el.coverPhoto.width(),u=i.el.coverPhoto.height();4.8>o?420>l?(console.log(l),t=Math.floor(a*(l/s)+40),n=0,r=Math.floor((t-u)/2),r=0):(e=l,t=Math.floor(a*(l/s)),n=0,r=Math.floor((t-u)/2),r=0):(e=Math.floor(s*(u/a)),t=u+40,n=Math.floor((e-l)/2),r=0),i.el.coverPhoto.find("img").css({width:e,height:t,marginLeft:-n,marginTop:-r})},saveFeaturedStories:function(){var e=[],t=this,n={featuredStories:e},r="/users/"+s.user.username+"/update",i={username:s.auth.user.username,_token:s.auth.user._token,user:JSON.stringify(n)};s.api.request("POST",r,i,{},function(n,r){n||(s.auth.setUser(r.content),s.auth.setUserCookie(),t.reloadFeaturedStories(e))})},reloadFeaturedStories:function(e){var t,n=this,r=n.el.topStories.find(".inner"),i="/stories/"+s.user.username+"/featured",a={username:s.auth.user.username,_token:s.auth.user._token};s.api.request("GET",i,a,{},function(n,i){n||(r.empty(),e.forEach(function(e){i.content.stories.forEach(function(n){e===n.sid&&(t=s.templates.render("story/_tile",{story:n}),r.append(t))})}))})},showStories:function(e){e.preventDefault(),this.el.storiesTab.click(),this.el.topStories.hide()},showFeatureMenu:function(e){e.preventDefault(),$(e.currentTarget).next(".category-menu").toggleClass("visible")},feature:function(e){var n=$(e.currentTarget).find("span").text();$(".category-menu").removeClass("visible");var r="/users/"+s.user.username+"/feature/"+n,i={username:s.auth.user.username,_token:s.auth.user._token};s.api.request("POST",r,i,{},function(e){e?s.notify.error(t("Error while featuring user")+".",{element:$("#content"),duration:4e3}):(s.notify.success(t("This user has been featured")+".",{element:$("#content"),duration:4e3}),$("#user-admin a.feature").removeClass("feature").addClass("unfeature").find("span").text("Unfeature"))})},unfeature:function(e){e.preventDefault();var n="/users/"+s.user.username+"/unfeature",r={username:s.auth.user.username,_token:s.auth.user._token};s.api.request("POST",n,r,{},function(e){e?s.notify.error(t("Error while unfeaturing user")+".",{element:$("#content"),duration:4e3}):(s.notify.success(t("This user has been unfeatured")+".",{element:$("#content"),duration:4e3}),$("#user-admin a.unfeature").removeClass("unfeature").addClass("feature").find("span").text("Feature"))})},flag:function(e){if(e.preventDefault(),window.confirm("Are you sure you want to mark this user and all associated existing and future stories as spam?")){var n="/users/"+s.user.username+"/flag",r={username:s.auth.user.username,_token:s.auth.user._token};s.api.request("POST",n,r,{},function(e){e?s.notify.error(t("Error while marking user as spam")+".",{element:$("#content"),duration:4e3}):(s.notify.success(t("This user has been marked as spam")+".",{element:$("#content"),duration:4e3}),$("#user-admin a.flag").removeClass("flag").addClass("unflag").find("span").text(t("Not Spam")))})}},unflag:function(e){e.preventDefault();var n="/users/"+s.user.username+"/unflag",r={username:s.auth.user.username,_token:s.auth.user._token};s.api.request("POST",n,r,{},function(e){e?s.notify.error(t("Error while unmarking user as spam")+".",{element:$("#content"),duration:4e3}):(s.notify.success(t("This user has been marked as spam")+".",{element:$("#content"),duration:4e3}),$("#user-admin a.flag").removeClass("flag").addClass("unflag").find("span").text(t("Not Spam")))})}}),s.pages.Settings=s.Class.extend({initialize:function(){var e=this;this.planCoupon1Dropdown=new s.Dropdown(".standard .coupon",".standard .coupon-entry"),this.planCoupon2Dropdown=new s.Dropdown(".plus5 .coupon",".plus5 .coupon-entry"),this.planCoupon3Dropdown=new s.Dropdown(".plus10 .coupon",".plus10 .coupon-entry"),this.planMonthlyCouponDropdown=new s.Dropdown("#monthly-coupon","#monthly-coupon-entry"),this.el={main:$("#settings-main"),editors:$("#editors-container"),editorsTab:$("#settings-main .tab-editors"),editorsNav:$("#editors-nav"),editorsForm:$("#add-editor-form"),embedstyleTab:$("#settings-main .tab-embedstyle"),embedstyleNav:$("#embedstyle-nav"),optionsTab:$("#settings-main .tab-options"),optionsNav:$("#options-nav"),embedStyleForm:$("#embed-style-form"),typekitConnect:$("#connect-typekit-acct"),typekitDisconnect:$("#disconnect-typekit-acct"),planTab:$("#settings-main .tab-plan"),planNav:$("#plan-nav"),planForm:$("#plan-form"),embedstyleHeadlineTypeDropdown:$("#headline-typeface-control"),embedstyleBodyTypeDropdown:$("#body-typeface-control"),embedstyleBodyColorDropdown:$("#body-color-control"),embedstyleLinkColorDropdown:$("#link-color-control"),avatarSelect:$("#settings-main .tab-profile .avatars"),avatar:$(".tab-profile .avatar"),connections:$("#connections-container"),connectionsTab:$("#settings-main .tab-connections"),connectionsNav:$("#connections-nav"),accountTab:$("#settings-main .tab-account"),accountNav:$("#account-nav"),accountForm:$("#account-form"),usernameForm:$("#change-username"),usernameLink:$("#change-username button"),usernameButton:$("#change-username-button"),usernameCancel:$("#change-username-cancel"),profileTab:$("#settings-main .tab-profile"),profileNav:$("#profile-nav"),profileForm:$("#profile-form"),notificationsTab:$("#settings-main .tab-notifications"),notificationsNav:$("#notifications-nav"),notificationsForm:$("#notifications-form"),optionsForm:$("#options-form"),commentsTab:$("#settings-main .tab-comments"),commentsNav:$("#comments-nav"),developersTab:$("#settings-main .tab-developers"),developersNav:$("#developers-nav"),enableComments:$("#enable-comments"),deleteLink:$("#delete-account button"),deleteButton:$("#delete-user-button"),cancelButton:$("#delete-user-cancel"),facebookAutoshare:$("#facebook-autoshare"),facebookQuoteImg:$("#facebook-quoteimg"),resendConfirmEmail:$("#resendConfirmEmail a"),updateCoverPhotoInput:$(".tab-profile .url input"),updateCoverPhotoButton:$(".tab-profile .url .button"),updateCoverPhotoLoading:$(".tab-profile .url .loading"),coverPhoto:$(".tab-profile .cover-photo"),coupon_buttons:$(".coupon-entry .button"),monthlyCoupon_button:$("#monthly-coupon-entry .button"),ga_tracker:$("#settings-ga_tacker"),fb_page_select:$(".settings-fb_page-select")},this.previousCoverPhotoURL=s.auth.user.coverPhoto&&s.auth.user.coverPhoto.url?s.auth.user.coverPhoto.url:"/public/img/profile.png",_.bindAll(this,"deleteUser","tab","addEditor","removeEditor","updateAccount","refreshAccount","updateNotifications","clickAvatar","toggleComments","toggleFacebookSettings","updateProfile","updateUsername","resendConfirmEmail","updateCoverPhotoButtonClicked","resizeCoverPhoto","saveCoverPhoto","updateEmbedStyle","upgradePlan","downgradePlan","updatePlan","connectTypekit","disconnectTypekit","updateUserFromForm","updateOptions","checkCoupon","togglePlans"),this.el.monthlyCoupon_button.bind("click",e.checkCoupon),this.el.coupon_buttons.bind("click",e.checkCoupon),$("#plan_toggle a").bind("click",e.togglePlans),this.connectTypekit(!1),$("#custom-body-text-color").bind("change",function(){e.el.embedStyleForm.find("span.main-swatch.body-text-color").css("background-color",this.value),$("#body-color-select").css("display","none"),e.updateStylePreview()}),$("#custom-link-color").bind("change",function(){e.el.embedStyleForm.find("span.main-swatch.link-text-color").css("background-color",this.value),$("#link-color-select").css("display","none"),e.updateStylePreview()}),$("#custom-background-color").bind("change",function(){e.el.embedStyleForm.find("span.background-color-swatch").css("background-color",this.value),$("#background-color-select").hide(),e.updateStylePreview()}),this.disableEmbedStyle="free"==s.user.paid_plan&&s.user.settings.keep_style,this.disableEmbedStyle?$("#body-color-control, #link-color-control, #background-color-control, #headline-typeface-control, #body-typeface-control").removeAttr("href"):(this.embedstyleHeadlineTypeDropdown=new s.Dropdown("#headline-typeface-control","#headline-typeface-select",{isList:!0}),this.embedstyleBodyTypeDropdown=new s.Dropdown("#body-typeface-control","#body-typeface-select",{isList:!0}),this.embedstyleBodyColorDropdown=new s.Dropdown("#body-color-control","#body-color-select",{isList:!0,exceptionId:"custom-body-text-color"}),this.embedstyleLinkColorDropdown=new s.Dropdown("#link-color-control","#link-color-select",{isList:!0,exceptionId:"custom-link-color"}),this.embedstyleLinkColorDropdown=new s.Dropdown("#background-color-control","#background-color-select",{isList:!0,exceptionId:"custom-background-color"}),this.embedstyleTypeKitDropdown=new s.Dropdown("#reveal-typekit-connect","#typekit-credentials",{activate:function(){$(".typekit .connect > .icon, .typekit .prompt, #reveal-typekit-connect").hide(),$("#typekit-credentials").show()}}),$("#body-color-select .swatch").bind("click",function(t){t.preventDefault();var n=e.rgb2hexa($(this).css("background-color"));$("#custom-body-text-color").val(n).trigger("change")}),$("#link-color-select .swatch").bind("click",function(t){t.preventDefault();var n=e.rgb2hexa($(this).css("background-color"));$("#custom-link-color").val(n).trigger("change")}),$("#background-color-select .swatch").bind("click",function(t){t.preventDefault();var n=e.rgb2hexa($(this).css("background-color"));$("#custom-background-color").val(n).trigger("change")}),$("#headline-typeface-select").delegate(".specimen","click",function(){e.fontChange($(this).text(),$("#headline-typeface-control"),$("#headline-typeface-select"))}),$("#body-typeface-select").delegate(".specimen","click",function(){e.fontChange($(this).text(),$("#body-typeface-control"),$("#body-typeface-select"))}),this.el.typekitConnect.click(this.connectTypekit),this.el.typekitDisconnect.click(this.disconnectTypekit)),this.deleteModal=new s.Modal("#delete-user-modal",{show:function(){e.el.deleteButton.focus()}}),this.workingModal=new s.Modal("#working"),this.usernameModal=new s.Modal("#change-username-modal",{show:function(){e.el.deleteButton.focus()}}),this.el.deleteLink.live("click",function(t){t.preventDefault(),e.deleteModal.show()}),this.el.deleteButton.click(function(n){n.preventDefault(),confirm(t("Are you really sure you want to do that?"))&&(e.deleteUser(),e.el.deleteButton.blur())}),this.el.cancelButton.click(function(t){t.preventDefault(),e.deleteModal.hide()}),this.el.usernameLink.live("click",function(t){t.preventDefault(),e.usernameModal.show()}),this.el.usernameButton.click(function(t){t.preventDefault(),e.usernameModal.hide(),e.updateUsername(),e.el.usernameButton.blur()}),this.el.usernameCancel.click(function(t){t.preventDefault(),e.usernameModal.hide()}),$(document).ready(function(){}),this.el.editorsForm.submit(this.addEditor),this.el.accountForm.submit(this.updateAccount),this.el.usernameForm.submit(this.updateUsername),this.el.profileForm.submit(this.updateProfile),this.el.notificationsForm.submit(this.updateNotifications),this.el.optionsForm.submit(this.updateOptions),this.el.embedStyleForm.submit(this.updateEmbedStyle),this.el.editors.find("button.revoke").live("click",this.removeEditor),this.el.avatar.live("click",this.clickAvatar),this.refreshAccount(),this.getEditors(),$("#settings-nav li").click(function(){e.tab(this)}),this.el[window.location.hash.substr(1)+"Nav"]?this.tab(this.el[window.location.hash.substr(1)+"Nav"]):this.tab($("#settings-nav li:first-child")),s.user.settings.comments?this.el.enableComments.find('input[value="'+s.user.settings.comments+'"]').prop("checked",!0):this.el.enableComments.find('input[value="null"]').prop("checked",!0),this.el.enableComments.find('input[name="enable-comments"]').change(this.toggleComments),$("#facebook-autoshare").live("change",function(t){e.toggleFacebookSettings(t,"autoshare")}),this.el.updateCoverPhotoButton.click(this.updateCoverPhotoButtonClicked),this.el.updateCoverPhotoInput.keypress(function(t){13===t.keyCode&&e.updateCoverPhotoButtonClicked(t)}),this.downgradeModal=new s.Modal("#downgrade"),$("#plan-form .button.submit, .plan-downgraded .upgrade").click(this.upgradePlan),$(".plan-update .button").click(this.updatePlan),$(".plan-downgrade a").click(this.downgradePlan)},updateStylePreview:function(){$(".embed-preview .headline").attr("style",$("#headline-typeface-control span").attr("style")),$(".embed-preview .description, .embed-preview .body").attr("style",$("#body-typeface-control span").attr("style")),$(".embed-preview .body").css("color",$("#custom-body-text-color").val()),$(".embed-preview .prussian").css("color",$("#custom-link-color").val()),$(".embed-preview").css("background-color",$("#custom-background-color").val())},getClassBut:function(e,t){var n=_.difference(e.split(" "),t);return n.join(" ")},updateUser:function(e,t,n){var r="/users/"+s.auth.user.username+"/update",i={user:JSON.stringify(e),username:s.auth.user.username,_token:s.auth.user._token};s.api.request("POST",r,i,{},function(e,r){e?n(e):t(r)})},updateUserStyle:function(e,t,n){var r="/users/"+s.auth.user.username+"/updateStyle",i={style:JSON.stringify(e),username:s.auth.user.username,_token:s.auth.user._token};s.api.request("POST",r,i,{},function(e,r){e?n(e):t(r)})},resetUserStyle:function(){if(window.confirm("Are you sure you want to reset your embed style? You will not be able to change it in the future.")){var e=this;e.el.embedStyleForm.find("input, button").attr("disabled",!0);var n="/users/"+s.auth.user.username+"/resetStyle",r={username:s.auth.user.username,_token:s.auth.user._token};s.api.request("POST",n,r,{},function(n,r){if(n){e.el.embedStyleForm.find("input, button").removeAttr("disabled");var i=n.error&&n.error.message||"An error occurred while trying to reset embed style";e.refreshAccount(),s.notify.error(t(i),{element:"#content",slideSpeed:200,duration:3e3})}else e.el.embedStyleForm.find("input, button").removeAttr("disabled"),s.auth.user.settings.style=r.content.settings.style,s.notify.success(t("Successfully reset embed style."),{element:"#content",slideSpeed:200,duration:3e3}),e.refreshAccount()})}},connectTypekit:function(e){var n=this,r=s.user.settings.style||{};if($(".typekit .disconnect").hide(),r&&r.typekit&&r.typekit.kitId||(r.typekit={kitId:$("#typekit-kit-id").val()}),r.typekit&&r.typekit.kitId){e&&$("#working").show();var i="/users/"+s.auth.user.username+"/updateStyle",a={username:s.auth.user.username,_token:s.auth.user._token,style:JSON.stringify(r)};s.api.request("POST",i,a,{},function(i,a){if(i){e&&$("#working").hide(),r.typekit={kitId:null};var o=i.error&&i.error.message||"There was an error connecting Typekit to your account";s.notify.error(t(o),{element:"#content",slideSpeed:200,duration:3e3})}else{s.auth.setUser(a.content),s.auth.setUserCookie(),s.user.settings.style.typekit=a.content.settings.style.typekit;
var l=a.content.settings.style.typekit.fonts[0].families;$.getScript("//use.typekit.net/"+r.typekit.kitId+".js",function(){try{Typekit.load(),_.each(l,function(e){var t="font-family:"+e.css_stack.replace(/\"/g,"'")+";",n='<li><a href="#" class="specimen typekit-font" style="'+t+'">'+e.name+"</a></li>";$("#headline-typeface-select, #body-typeface-select").append(n)}),e&&$("#working").hide(),n.embedstyleTypeKitDropdown.deactivate(),$(".typekit .connect").hide(),$(".typekit .disconnect").show(),$(".typekit .typekit-username").text("Kit ID: "+r.typekit.kitId),e&&s.notify.success(t("Successfully connected Typekit"),{element:"#content",slideSpeed:200,duration:3e3})}catch(i){}})}})}},disconnectTypekit:function(){var e=this,n={fonts:{title:"Georgia, Times",body:"Helvetica, Arial"},typekit:{kitId:null}},r="/users/"+s.user.username+"/updateStyle",i={username:s.auth.user.username,_token:s.auth.user._token,style:JSON.stringify(n)};s.api.request("POST",r,i,{},function(r,i){r?(console&&console.log("error: ",r),s.notify.error(t("There was an error disconnecting Typekit"),{element:"#content",slideSpeed:200,duration:3e3})):(s.auth.setUser(i.content),s.auth.setUserCookie(),$(".typekit .disconnect").hide(),$(".typekit .connect").show(),$(".typekit .connect > .icon, .typekit .prompt, #reveal-typekit-connect").show(),$("#body-typeface-select, #headline-typeface-select").find("li .typekit-font").remove(),e.fontChange(n.fonts.body,$("#body-typeface-control"),$("#body-typeface-select")),e.fontChange(n.fonts.title,$("#headline-typeface-control"),$("#headline-typeface-select")),s.notify.success(t("Successfully disconnected Typekit"),{element:"#content",slideSpeed:200,duration:3e3}))})},toggleFacebookSettings:function(e,n){e.preventDefault();var r;switch(n){case"autoshare":r={facebook_autoshare:$("#facebook-autoshare").prop("checked")};break;case"quoteimg":r={facebook_quoteimg:$("#facebook-quoteimg").prop("checked")}}r&&this.updateUser({settings:r},function(e){s.auth.setUser(e.content),s.auth.setUserCookie(),s.notify.success(t("Successfully updated settings"),{element:"#content",slideSpeed:200,duration:3e3})},function(){s.notify.error(t("Error updating settings"),{element:"#content",slideSpeed:200,duration:3e3}),$("#facebook-"+n).prop("checked",!1)})},toggleComments:function(e){e.preventDefault();var n="null"==$(e.target).attr("value")?null:$(e.target).attr("value");this.updateUser({settings:{comments:n}},function(e){s.auth.setUser(e.content),s.auth.setUserCookie(),s.notify.success(t("Successfully updated comments settings"),{element:"#content",slideSpeed:200,duration:3e3})},function(){s.notify.error(t("Error updating comments settings"),{element:"#content",slideSpeed:200,duration:3e3}),this.el.enableComments.find('input[value="null"]').prop("checked",!0)})},clickAvatar:function(e){var n=$(e.currentTarget),r=n.find("img").attr("src"),i=n.attr("data-service"),a=this;if(!n.hasClass("active"))return n.is(".inactive")?(s.auth.serviceConnect(i,function(){a.refreshAccount(!1,function(){a.el.avatarSelect.find(".connected div."+i).click()})}),!1):(this.updateAvatar(r,function(){n.siblings(".active").removeClass("active"),n.addClass("active"),s.notify.success(t("Successfully updated avatar"),{element:"#content",slideSpeed:200,duration:3e3})}),void 0)},updateAvatar:function(e,t,n){e.match("i.embed.ly")&&(e=decodeURIComponent(e.substring(e.indexOf("url=")+4))),this.updateUser({avatar:e},function(e){var n=e.content;s.auth.setUser(n),s.auth.setUserCookie(),s.nav&&s.nav.updateUser(),_.isFunction(t)&&t(n)},n)},getEditors:function(){var e=this,t="/users/"+s.user.username+"/editors?username="+s.auth.user.username+"&_token="+s.auth.user._token;s.api.request("GET",t,{},{},function(t,n){t?e.el.editors.prepend("An error occurred while trying to find editors."):_.each(n.content.editors,function(t){e.el.editors.prepend($(s.templates.render("user/_editor",{editor:t})))})})},removeEditor:function(e){e.preventDefault();var n=$(e.currentTarget).parents(".user-summary");n.find("input, button").attr("disabled",!0);var r="/users/"+s.user.username+"/editors/remove",i={user:n.attr("name"),username:s.auth.user.username,_token:s.auth.user._token};s.api.request("POST",r,i,{},function(e,r){if(e){var i=e.error&&e.error.message||"An error occurred while trying to remove this editor";s.notify.error(t(i),{element:"#content",slideSpeed:200,duration:3e3}),n.find("input, button").removeAttr("disabled")}else s.notify.success(t(r.content),{element:"#content",slideSpeed:200,duration:3e3}),n.remove()})},addEditor:function(e){e.preventDefault();var n=this,r=this.el.editorsForm.find("#add-editor").val();this.el.editorsForm.find("input, button").attr("disabled",!0);var i="/users/"+s.user.username+"/editors/add",a={user:r,username:s.auth.user.username,_token:s.auth.user._token};s.api.request("POST",i,a,{},function(e,r){if(e){var i=e.error&&e.error.message||"An error occurred while trying to add this editor";s.notify.error(t(i),{element:"#content",slideSpeed:200,duration:3e3}),n.el.editorsForm.find("input, button").removeAttr("disabled")}else s.notify.success(t(r.message),{element:"#content",slideSpeed:200,duration:3e3}),n.el.editors.prepend($(s.templates.render("user/_editor",{editor:r.content.editor}))),n.el.editorsForm.find("input, button").removeAttr("disabled")})},refreshAccount:function(e,n){var r=this,i="/users/"+s.auth.user.username+"?username="+s.auth.user.username+"&_token="+s.auth.user._token;s.api.request("GET",i,{},{},function(i,a){if(i);else{s.auth.setUser(a.content),s.auth.setUserCookie(),s.nav&&s.nav.updateUser(),r.el.usernameForm.find(".username").val(s.auth.user.username),s.auth.user.email.match("@noemail.com")||r.el.accountForm.find(".email").val(s.auth.user.email),r.el.profileForm.find(".name").val(s.auth.user.name),r.el.profileForm.find(".bio").val(s.auth.user.bio),r.el.profileForm.find(".location").val(s.auth.user.location),r.el.profileForm.find(".website").val(s.auth.user.website),r.el.profileForm.find("select#profile-lang option[value="+s.auth.user.lang+"]").attr("selected","selected");var o=function(e,t){for(var n in t){var r=t[n];s.auth.user.settings[e]&&s.auth.user.settings[e][r]&&$("#"+e+"-form").find("#"+e+"-"+r).prop("checked",s.auth.user.settings[e][r])}};o("notifications",["newsletter","digest","story_comment","story_like","element_comment","element_like","follower","quoted","friend_quoted"]),o("options",["infinite_scroll","allow_embedding","comments","hide_stats","related_stories","ga","fb_page"]),r.el.ga_tracker.val(s.auth.user.settings.ga_tracker),r.el.profileTab.find(".avatar-email").text(s.auth.user.email);var l={fonts:{title:"Georgia, Times",body:"Helvetica, Arial"},colors:{text:"#666",link:"#3676c4",background:"#fff"}};s.auth.user.settings.style||(s.auth.user.settings.style=l),r.el.embedStyleForm.find("#custom-body-text-color").val(s.auth.user.settings.style.colors.text||l.colors.text).trigger("change"),r.el.embedStyleForm.find("#custom-link-color").val(s.auth.user.settings.style.colors.link||l.colors.link).trigger("change"),r.el.embedStyleForm.find("#custom-background-color").val(s.auth.user.settings.style.colors.background||l.colors.background).trigger("change"),r.fontChange(s.auth.user.settings.style.fonts.body||l.fonts.body,$("#body-typeface-control"),$("#body-typeface-select")),r.fontChange(s.auth.user.settings.style.fonts.title||l.fonts.title,$("#headline-typeface-control"),$("#headline-typeface-select"));var u=s.auth.user.coverPhoto&&s.auth.user.coverPhoto.url?s.auth.user.coverPhoto.url:"/public/img/profile.png";r.el.updateCoverPhotoInput.val(u),r.el.coverPhoto.find("img").attr("src",u),r.resizeCoverPhoto(),$(window).resize(r.resizeCoverPhoto),r.el.avatarSelect.find(".connected").empty();var c,d=a.content.identities,f=["twitter","facebook","google","instagram"];r.el.connections.html(""),_.each(d,function(t){"google"!=t.service&&($avatar=$(s.templates.render("user/_avatar_selection",{identity:t})),r.el.avatarSelect.find(".connect-"+t.service).hide(),e&&"gravatar"==t.service&&s.auth.user.avatar.match(/gravatar/)?(r.updateAvatar(t.avatar),$avatar.addClass("active")):t.avatar==s.auth.user.avatar&&$avatar.addClass("active"),r.el.avatarSelect.find(".connected").append($avatar))}),_.each(f,function(e){var n=!1;if(_.each(d,function(t){t.service==e&&(n=t)}),n){var i=[];if(Object.keys(s.user.facebookPages).length>0)for(var a in s.user.facebookPages)i.push(s.user.facebookPages[a]);c=$(s.templates.render("user/_connection",{identity:n,facebookPages:i})),c.find(".settings-fb_page-select").bind("change",function(e){var n,i,a,o=$(e.target).find(":selected");"me"===o.val()?(n="me",i=void 0,a=void 0):(n=o.val(),i=o.attr("data-link"),a=o.attr("data-name")),r.updateUser({fb_page_id:n,fb_page_link:i,fb_page_name:a},function(e){s.auth.setUser(e.content),s.auth.setUserCookie(),s.notify.success(t("Successfully updated user"),{element:"#content",slideSpeed:200,duration:3e3})},function(e){var n="";try{n=JSON.parse(e.responseText).error.message}catch(i){n="An error occurred while trying to update this user"}r.refreshAccount(),s.notify.error(t(n),{element:"#content",slideSpeed:200,duration:3e3})})}),c.find("a.unlink").bind("click",function(){if(confirm(t("Are you sure you want to unlink this account?"))){var e=$(this).attr("data-service");s.auth.serviceDisconnect(e,function(){r.refreshAccount(!1,function(){s.auth.user.avatar==n.avatar&&r.el.avatarSelect.find(".connected").children(":first").click()})})}}),r.el.connections.append(c),"facebook"==n.service&&((s.user.settings.facebook_autoshare||_.isUndefined(s.user.settings.facebook_autoshare))&&$("#facebook-autoshare").prop("checked",!0),(s.user.settings.facebook_quoteimg||_.isUndefined(s.user.settings.facebook_quoteimg))&&$("#facebook-quoteimg").prop("checked",!0))}else r.el.avatarSelect.find(".connect-"+e).show(),c=$(s.templates.render("user/_connection",{identity:{service:e}})),c.find("a.button").bind("click",function(){var e=$(this).attr("data-service");s.auth.serviceConnect(e,r.refreshAccount)}),r.el.connections.append(c)}),_.isFunction(n)&&n()}})},updateAccount:function(e){e.preventDefault();var n=this,r=this.el.accountForm.find(".email").val(),i=this.el.accountForm.find(".password").val(),a=this.el.accountForm.find(".passwordConfirm").val();return i!=a?(s.notify.error(t("Confirm password must match password"),{element:"#content",slideSpeed:200,duration:3e3}),void 0):(this.el.accountForm.find("input, button").attr("disabled",!0),this.updateUser({email:r,password:i},function(e){n.el.accountForm.find("input, button").removeAttr("disabled");var r=e.content;s.auth.setUser(r),s.auth.setUserCookie(),n.refreshAccount(!0),s.notify.success(t("Successfully updated user"),{element:"#content",slideSpeed:200,duration:3e3})},function(e){n.el.accountForm.find("input, button").removeAttr("disabled");var r=e.error.message;n.refreshAccount(),s.notify.error(t(r),{element:"#content",slideSpeed:200,duration:3e3})}),void 0)},updateUsername:function(){var e=this,n=this.el.usernameForm.find(".username").val();this.el.usernameForm.find("input, button").attr("disabled",!0),this.updateUser({username:n},function(n){e.el.usernameForm.find("input, button").removeAttr("disabled");var r=n.content;s.auth.setUser(r),s.auth.setUserCookie(),e.refreshAccount(!0),s.notify.success(t("Successfully updated your username"),{element:"#content",slideSpeed:200,duration:3e3})},function(n){e.el.usernameForm.find("input, button").removeAttr("disabled");var r=n.error.fields&&n.error.fields.username?n.error.fields.username:n.error.message;e.refreshAccount(),s.notify.error(t(r),{element:"#content",slideSpeed:200,duration:3e3})})},updateProfile:function(e){e.preventDefault();var n=this,r=this.el.profileForm.find(".name").val(),i=this.el.profileForm.find(".bio").val(),a=this.el.profileForm.find(".location").val(),o=this.el.profileForm.find(".website").val(),l=this.el.profileForm.find(".lang").val(),u=!(l===s.auth.user.lang.substr(0,2)),c=this.el.profileForm.find("#profile-category").val();this.el.profileForm.find("input, button").attr("disabled",!0),this.updateUser({name:r,bio:i,location:a,website:o,lang:l,category:"none"==c?void 0:c},function(e){$.i18n.setLng(l,function(){n.el.profileForm.find("input, button").removeAttr("disabled");var r=e.content;s.auth.setUser(r),s.auth.setUserCookie(),n.refreshAccount(!0),s.notify.success(t("Successfully updated user"),{element:"#content",slideSpeed:200,duration:3e3}),setTimeout(function(){u&&window.location.reload()},1e3)})},function(e){n.el.profileForm.find("input, button").removeAttr("disabled");var r=e.error.message;n.refreshAccount(),s.notify.error(t(r),{element:"#content",slideSpeed:200,duration:3e3})})},updateUserFromForm:function(e,n,r,i){e.preventDefault();var a=this,o={},l=$("#"+n+"-form");o[n]={};for(var u in r){var c=r[u];o[n][c]=l.find("#"+n+"-"+c).prop("checked")}if(i)for(var u in i)o[u]=i[u];l.find("input, button").attr("disabled",!0),this.updateUser({settings:o},function(e){l.find("input, button").removeAttr("disabled");var n=e.content;s.auth.setUser(n),s.auth.setUserCookie(),a.refreshAccount(!0),s.notify.success(t("Successfully updated user"),{element:"#content",slideSpeed:200,duration:3e3})},function(e){l.find("input, button").removeAttr("disabled");var n=e.error.message;a.refreshAccount(),s.notify.error(t(n),{element:"#content",slideSpeed:200,duration:3e3})})},updateNotifications:function(e){this.updateUserFromForm(e,"notifications",["story_comment","story_like","element_comment","element_like","follower","quoted","friend_quoted","digest","newsletter"])},updateOptions:function(e){this.updateUserFromForm(e,"options",["infinite_scroll","allow_embedding","comments","hide_stats","related_stories","ga","fb_page"],{ga_tracker:this.el.ga_tracker.val(),fb_page_id:this.el.fb_page_select.val(),fb_page_link:this.el.fb_page_select.find(":selected").attr("data-link"),fb_page_name:this.el.fb_page_select.find(":selected").attr("data-name")})},updateEmbedStyle:function(e){if(e.preventDefault(),this.disableEmbedStyle)return this.resetUserStyle();var n=this,r=$("#headline-typeface-control").text(),i=$("#body-typeface-control").text(),a=$("#custom-body-text-color").val(),o=$("#custom-link-color").val(),l=$("#custom-background-color").val(),u={fonts:{title:r,body:i},colors:{text:a,link:o,background:l}};this.el.embedStyleForm.find("input, button").attr("disabled",!0),this.updateUserStyle(u,function(e){n.el.embedStyleForm.find("input, button").removeAttr("disabled"),s.auth.user.settings.style=e.content.settings.style,n.refreshAccount(),s.notify.success(t("Successfully updated embed style"),{element:"#content",slideSpeed:200,duration:3e3})},function(e){n.el.embedStyleForm.find("input, button").removeAttr("disabled");var r=e.error.message;n.refreshAccount(),s.notify.error(t(r),{element:"#content",slideSpeed:200,duration:3e3})})},tab:function(e){var t=$(e).attr("id").split("-nav")[0],n=this.el[t+"Tab"],r=this.el[t+"Nav"];if(!n.hasClass("selected")||!n.hasClass("selected"))return r.addClass("selected").siblings().removeClass("selected"),n.addClass("selected").siblings().removeClass("selected"),window.location.hash="#"+t,analytics.track("view_"+t+"_settings"),!1},deleteUser:function(){var e="/users/"+s.user.username+"/remove",n={username:s.auth.user.username,_token:s.auth.user._token};s.api.request("POST",e,n,{},function(e){if(e){var n=t("An error occurred while trying to delete your account, please email info@storify.com to have it deleted manually");s.notify.error(n,{element:"#content",slideSpeed:200,duration:3e3})}else s.auth.logout(),window.location="/"})},resendConfirmEmail:function(e){e.preventDefault();var n="/resend_confirm_email",r={email:window.s.user.email};s.api.request("POST",n,r,{},function(e){if(e){var n=e.error&&e.error.message||t("An error occurred while trying to resend the confirmation email.");s.notify.error(n,{element:"#content",slideSpeed:200,duration:3e3})}else{var n=t("Confirmation email has been sent.");s.notify.success(n,{element:"#content",slideSpeed:200,duration:3e3})}})},updateCoverPhotoButtonClicked:function(e){e.preventDefault();var n=this;if(""===n.el.updateCoverPhotoInput.val())s.notify.error(t("Please copy the URL of the image in the field!"),{element:"#content",slideSpeed:200,duration:3e3});else{n.el.updateCoverPhotoLoading.show();var r=setTimeout(function(){n.el.updateCoverPhotoLoading.hide(),n.el.updateCoverPhotoInput.val(n.previousCoverPhotoURL),s.notify.error(t("This image takes too long to load! Please check the URL again and make sure it is a valid image!"),{element:"#content",slideSpeed:200,duration:3e3})},5e3),i=new Image;i.onload=function(){clearTimeout(r),n.previousCoverPhotoURL=this.src,n.el.updateCoverPhotoLoading.hide(),n.el.coverPhoto.find("img").attr("src",this.src),n.resizeCoverPhoto(this.width,this.height),n.saveCoverPhoto(this.src,this.width,this.height)},i.onerror=function(){clearTimeout(r),n.el.updateCoverPhotoLoading.hide(),n.el.updateCoverPhotoInput.val(n.previousCoverPhotoURL);var e=t("Error while loading this image")+". "+t("Make sure there is a correct image extension in the URL (.jpg, .png, ...)");console&&console.log("Error while loading Image() : ",e),s.notify.error(e,{element:"#content",slideSpeed:200,duration:3e3})},i.src=n.el.updateCoverPhotoInput.val()}},resizeCoverPhoto:function(){var e,t,n,r,i=this,a=s.auth.user.coverPhoto&&s.auth.user.coverPhoto.width?s.auth.user.coverPhoto.width:958,o=s.auth.user.coverPhoto&&s.auth.user.coverPhoto.width?s.auth.user.coverPhoto.height:200,l=a/o,u=i.el.coverPhoto.width(),c=i.el.coverPhoto.height();4.8>l?(e=u,t=Math.floor(o*(u/a)),n=0,r=Math.floor((t-c)/2)):(e=Math.floor(a*(c/o)),t=c,n=Math.floor((e-u)/2),r=0),i.el.coverPhoto.find("img").css({width:e,height:t,marginLeft:-n,marginTop:-r})},saveCoverPhoto:function(e,n,r){var i={url:e,width:n,height:r};this.updateUser({coverPhoto:i},function(e){s.auth.setUser(e.content),s.auth.setUserCookie(),s.notify.success(t("Successfully updated cover photo"),{element:"#content",slideSpeed:200,duration:3e3})})},rgb2hexa:function(e){var t=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);delete t[0];for(var n=1;3>=n;++n)t[n]=parseInt(t[n]).toString(16),1==t[n].length&&(t[n]="0"+t[n]);return"#"+t.join("").toUpperCase()},fontChange:function(e,t,n){var r=s.user.settings.style&&s.user.settings.style.typekit?s.user.settings.style.typekit.fonts:null,i=r&&_.where(r[0].families,{name:e}),a=t.find("span");a.text(e),a.css("font-family",_.isEmpty(i)?e:i[0].css_stack),n.css("display","none"),t.removeClass(),n.children().removeClass(),n.find(":contains("+e+")").addClass("selected"),this.updateStylePreview()},togglePlans:function(e){e.preventDefault(),$("#plan_toggle .selected").removeClass("selected"),$(e.currentTarget).addClass("selected");var t=$(e.currentTarget).data("plans");"annual"==t?($(".standard .amount").text("79"),$(".standard .total").text("Billed yearly, or $99 billed monthly"),$(".plus5 .amount").text("149"),$(".plus5 .total").text("Billed yearly, or $199 billed monthly"),$(".plus10 .amount").text("299"),$(".plus10 .total").text("Billed yearly, or $399 billed monthly")):($(".standard .amount").text("99"),$(".standard .total").text("Billed monthly, or $79 billed yearly"),$(".plus5 .amount").text("199"),$(".plus5 .total").text("Billed monthly, or $149 billed yearly"),$(".plus10 .amount").text("399"),$(".plus10 .total").text("Billed monthly, or $299 billed yearly"))},checkCoupon:function(e){var t=this,n=$(e.currentTarget).parent().find("input").val(),r="/stripe/checkCoupon",i={username:s.auth.user.username,_token:s.auth.user._token,coupon:n};s.api.request("GET",r,i,{},function(n,r){if(n){var i=n.error.message;s.notify.error(i,{element:"#content",slideSpeed:200,duration:3e3})}else{var a={currentTarget:$(e.currentTarget).parent().parent().find(".button.submit")};t.upgradePlan(a,r.content.id,r.content.percent_off,r.content.amount_off)}})},upgradePlan:function(e,t,n,r){var i=this,a={bus:{monthly:9900,annual:94800},bus5:{monthly:19900,annual:178800},bus10:{monthly:39900,annual:358800}},o=$(e.currentTarget),l="";try{l=o.data("plan").toLowerCase()}catch(u){s.raven&&s.raven.started&&(l="bus",s.raven.Raven.captureMessage("settings.js:1147 : el.data is undefined : "+o.data+" - err : "+u+" - e : "+e+" - $ : "+$))}var c=o.data("period")||$("#plan_toggle .selected").text();if("business"===l?l="bus":"pro"===l?l="bus":"business5"===l?l="bus5":"business10"===l?l="bus10":s.raven&&s.raven.started&&s.raven.Raven.captureMessage("settings.js:1258 : what is this plan? : "+l),"year"===c||"annuel"===c.toLowerCase()?c="Annual":("month"===c||"mensuel"===c.toLowerCase())&&(c="Monthly"),l&&c){var d=c.toLowerCase(),f=a[l][d],h=null;l=l+"_"+d,t&&(h=t,n?f=f*(100-n)/100:r&&(f-=r)),analytics.track("click_upgrade_stripe",{plan:l,period:c,price:f,coupon:h});var p=s.auth.user._stripe&&s.auth.user._stripe.dates;if("free"!==s.auth.user.paid_plan||p)var m={key:STRIPE_KEY,amount:f,name:"Storify Business Plan",description:c+" Subscription",panelLabel:"Checkout",token:function(e){i.stripeTokenCallback(l,e,h)}};else var m={key:STRIPE_KEY,name:"Try Storify Business Free",description:["Enjoy one week of free access.",c+" rate of $"+(f/100).toFixed(2)+" applies after.","You can cancel at any time."].join(" "),panelLabel:"Start my free trial now",token:function(e){i.stripeTokenCallback(l,e,h)}};return StripeCheckout.open(m),!1}},updatePlan:function(){var e=this,t=s.auth.user._stripe.plan.id,n="Monthly";"year"===s.auth.user._stripe.plan.interval&&(n="Annual");var r={key:STRIPE_KEY,name:"Storify Business Plan",description:n+" Subscription",panelLabel:"Update credit card",token:function(n){e.stripeTokenCallback(t,n)}};return StripeCheckout.open(r),!1},stripeTokenCallback:function(e,n,r){var i=this,a=$("<input type=hidden name=stripeToken />").val(n.id);$(".panel form").append(a).submit();var o=function(n){i.workingModal.hide(),analytics.track("upgrade_error",{plan:e});var r={message:""};n.content&&n.content.error&&n.content.error.response&&n.content.error.response.error&&(r=n.content.error.response.error,$("#error .errorstring").html(r.message)),$("#error").removeClass("hidden"),console&&console.log("An error occured while saving your Stripe Token: ",r,"  -  ",n),s.notify.error(t("Sorry! Card verification failed. Please try again."),{element:"#content",slideSpeed:200,duration:4e3})},l=function(t){return i.workingModal.hide(),analytics.track("upgrade_success",{plan:e}),t.content.error?o(t):(window.location.reload(),void 0)};i.workingModal.show();var u="/users/"+s.auth.user.username+"/upgrade",c={stripeToken:JSON.stringify(n),plan:e,coupon:r,username:s.auth.user.username,_token:s.auth.user._token};s.api.request("POST",u,c,{},function(e,t){e?o(e):l(t)})},getStripePlan:function(e,t){if("free"===e)return"free";var n={pro:{year:"bus_annual",month:"bus_monthly"},business5:{year:"bus5_annual",month:"bus5_monthly"},business10:{year:"bus10_annual",month:"bus10_monthly"}};return n[e][t]},downgradePlan:function(){var e=this;e.downgradeModal.show(),$("#cancel-downgrade-button").click(function(){return e.downgradeModal.hide(),!1}),$("#submit-downgrade-button").click(function(){var n="free";e.downgradeModal.hide(),e.workingModal.show(),analytics.track("click_downgrade_button");var r="/users/"+s.auth.user.username+"/downgrade",i={username:s.auth.user.username,_token:s.auth.user._token,plan:e.getStripePlan(n,s.auth.user._stripe.plan.interval)};s.api.request("POST",r,i,{},function(n){n?(e.workingModal.hide(),analytics.track("downgrade_error"),s.notify.error(t("An error occured while downgrading: "+error),{element:"#content",slideSpeed:200,duration:3e3})):(e.workingModal.hide(),analytics.track("downgrade_success"),window.location.reload())})})}}),s.pages.SearchQuery=s.Class.extend({initialize:function(){_.bindAll(this,"activateTab","linkClicked","backClicked","showOverview","hideOverview"),this.el={browse:$("#browse-content"),overview:$("#overview"),link:$("#overview .link"),title:$("#overview h2 a"),back:$("#browse-content .filter .back")},this.hashes=["#stories","#elements"],this.list=[new s.StoryList("#search-stories",{path:"stories/search",params:{q:s.query,sort:"date.published"},emptyText:"There are no stories matching the search '"+_.clean(s.query)+"'"}),new s.ElementList("#search-elements",{path:"elements/search",params:{q:_.clean(s.query).replace(" "," AND ")},emptyText:"There are no elements matching the search '"+_.clean(s.query)+"'"})],this.tabs=new s.Tabs("#browse-content",{active:this.hashes.indexOf(window.location.hash),activate:this.activateTab,lists:this.list}),-1===this.hashes.indexOf(window.location.hash)&&this.showOverview(),this.storyControl=new s.StoryControl,this.elementControl=new s.ElementControl,this.el.link.click(this.linkClicked),this.el.title.click(this.linkClicked),this.el.back.click(this.backClicked)},showOverview:function(){this.el.overview.hasClass("initialized")||(this.el.overview.addClass("initialized"),this.overview=[new s.StoryList("#overview .stories .inner",{path:"stories/search",per_page:3,loadMore:!1,autoLoads:0,params:{q:s.query,sort:"date.published"},emptyText:"There are no stories matching the search '"+_.clean(s.query)+"'"}),new s.ElementList("#overview .elements .inner",{path:"elements/search",params:{q:_.clean(s.query).replace(" "," AND ")},emptyText:"There are no elements matching the search '"+_.clean(s.query)+"'"})],this.overview[0].update(),this.overview[1].update()),this.el.overview.show()},hideOverview:function(){this.el.overview.hide()},activateTab:function(e){this.el.browse.show(),this.hideOverview(),this.list[e].update()},linkClicked:function(e){var t=this.hashes.indexOf($(e.target).attr("href"));this.tabs.activate(t)},backClicked:function(e){e.preventDefault(),this.el.browse.hide(),this.showOverview(),history.pushState?history.pushState("",document.title,window.location.pathname+window.location.search):window.location=window.location.pathname+window.location.search}}),s.pages.BrowseSubscriptions=s.Class.extend({initialize:function(){_.bindAll(this,"activateTab"),s.user.username+"/newswire",this.list=[new s.ElementList("#browse-elements",{params:{sort:"stats.views"}})],this.tabs=new s.Tabs("#browse-content",{active:"#stories"===window.location.hash?0:1,activate:this.activateTab,lists:this.list}),this.storyControl=new s.StoryControl,this.elementControl=new s.ElementControl},activateTab:function(e){this.list[e].update()}}),s.pages.Element=s.Class.extend({initialize:function(e,t){self=this,_.bindAll(this,"buttonRepostClicked","buttonShareClicked","buttonLikeClicked","shareButtonClicked","share","shareOnPinterest","shareByEmail","toggleLike","like","unlike","incrementStat","decrementStat","animateBigLike"),this.type=e,this.container=t,this.el={container:$(t),buttonRepost:$(t).find(".actions .repost"),buttonShare:$(t).find(".actions .share"),buttonLike:$(t).find(".actions .like"),shareBox:$(t).find(".share_box"),shareButton:$(t).find(".share_box a"),commentsBox:$(t).find(".comments"),commentInput:$(t).find(".comments .comment-input"),storiesBox:$(t).find(".stories"),bigLike:$("#big-like")},this.el.buttonRepost.live("click",this.buttonRepostClicked),this.el.buttonShare.live("click",this.buttonShareClicked),this.el.buttonLike.live("click",this.buttonLikeClicked),this.el.shareButton.live("click",this.shareButtonClicked)},buttonRepostClicked:function(){var e=this.el.container.find(".element"),t=e.attr("data-type"),n=e.attr("data-permalink"),r={permalink:n},i={utm_medium:"elementPage",utm_content:t};s.auth.user?sfy.showModal(r,i):s.auth.loginPopup(function(e,t){!e&&t&&sfy.showModal(r,i)})},buttonShareClicked:function(e){$actions=$(e.target).parents(".actions"),$actions.toggleClass("share"),this.el.shareBox.toggleClass("open")},buttonLikeClicked:function(e){var t=this;s.auth.user?t.toggleLike(e):s.auth.loginPopup(function(n,r){!n&&r&&t.toggleLike(e)})},toggleLike:function(e){var t=$(e.currentTarget);t.hasClass("pending")||(t.addClass("pending"),t.hasClass("active")?this.unlike(t):this.like(t))},like:function(e){var t=this,n=this.el.container.find(".element"),r=n.attr("data-eid"),i={username:s.auth.user.username,_token:s.auth.user._token};s.story&&(i.sid=s.story.sid),t.animateBigLike();var a="/elements/"+r+"/like";s.api.request("POST",a,i,{},function(r){r?e.removeClass("pending"):(e.removeClass("pending").addClass("active"),t.incrementStat(n.find(".stats-likes")),analytics.track("engagement",{event:"element-like"}))})},unlike:function(e){var t=this,n=this.el.container.find(".element"),r=n.attr("data-eid"),i={username:s.auth.user.username,_token:s.auth.user._token};s.story&&(i.sid=s.story.sid);var a="/elements/"+r+"/unlike";s.api.request("POST",a,i,{},function(r){r?e.removeClass("pending"):(e.removeClass("pending").removeClass("active"),t.decrementStat(n.find(".stats-likes")))})},incrementStat:function(e,n){var r=e.find(".num"),i=e.find(".desc"),s=e.hasClass("stats-likes"),a=s?e.parents(".stats").find(".stats-comments"):e.parents().find(".stats-likes"),o=e.parents(".stats").find(".point"),n=1*r.html()+(n||1),l=1*a.find(".num").html();s?i.html(t("like",{count:n})):i.html(t("comment",{count:n})),0===n?e.addClass("hidden"):e.removeClass("hidden"),0===n||0===l?o.addClass("hidden"):o.removeClass("hidden"),r.html(n+" ")},decrementStat:function(e,t){var t=t||1;this.incrementStat(e,-t)},shareButtonClicked:function(e){e.preventDefault();var t=$(e.target),n=this.el.container.find(".element"),r=n.data("url"),i=n.data("type"),s=t.attr("class"),a=t.data("media"),o=t.data("video");switch(s){case"email":this.shareByEmail(r);break;case"pinterest":this.shareOnPinterest(r,a,o);break;default:this.share(r,i,s)}},animateBigLike:function(){var e=460,t=412,n=this;n.el.bigLike.show().animate({opacity:.8,width:e,height:t,marginLeft:e/-2,marginTop:t/-2},250,function(){setTimeout(function(){n.el.bigLike.animate({opacity:0,width:2*e,height:2*t,marginLeft:-e,marginTop:-t},250,function(){n.el.bigLike.hide().css({opacity:.8,width:e/2,height:t/2,marginLeft:e/-4,marginTop:t/-4})})},500)})},share:function(e,t,n){var r;switch(n){case"facebook":r="http://www.facebook.com/sharer.php?u="+encodeURIComponent(e);break;case"twitter":r="http://twitter.com/intent/tweet?via=storify&text="+encodeURIComponent("Check out this great "+t+" on Storify!")+"&url="+encodeURIComponent(e);break;case"googleplus":r="http://plus.google.com/share?url="+encodeURIComponent(e);break;case"linkedin":r="http://www.linkedin.com/shareArticle?url="+encodeURIComponent(e)}window.open(r,"sharer","toolbar=0,status=0,resizable=1,width=626,height=436")},shareByEmail:function(e){window.location.href="mailto:?body="+e},shareOnPinterest:function(e,t,n){window.open("http://pinterest.com/pin/create/bookmarklet/?media="+encodeURIComponent(t)+"&url="+encodeURIComponent(e)+"&is_video="+encodeURIComponent(n),"sharer","toolbar=0,status=0,resizable=1,width=632,height=270")},loadStories:function(){var e=this.el.container.find(".element"),t=this.el.storiesBox,n=e.attr("data-eid"),r=s.auth.user?{username:s.auth.user.username,_token:s.auth.user._token}:{},i="/stories/list/"+n;s.api.request("GET",i,r,{},function(n,r){if(n);else{var i,a=r.content.stories;_.each(a,function(e,t){e.date.published||a.splice(t,1)}),_.each(a,function(e){i=s.templates.render("story/_tile",{story:e}),t.append(i)}),a.length>0&&t.show(),analytics.track("browse",{event:"element-flip-stories",type:e.attr("data-type"),source:e.attr("data-source")})}})}}),$(function(){var e=$("#abuse form");e.find('input[name="url"]').val(document.referrer),e.submit(function(n){n.preventDefault();var r="/report_abuse",i={reporterName:$('input[name="reporter-name"]').val(),email:$('input[name="email"]').val(),abuserName:$('input[name="abuser-name"]').val(),synopsis:$('textarea[name="synopsis"]').val(),type:$("select").val(),tosViolation:$('textarea[name="tos-violation"]').val(),when:$('input[name="when"]').val(),urls:$('textarea[name="urls"]').val(),additional:$('textarea[name="additional"]').val()};s.api.request("POST",r,i,{},function(n){n?s.notify.error(t(n.error.message),{element:$("#content"),duration:4e3}):(s.notify.success(t("Successfully submitted abuse"),{element:"#content",duration:3e3}),e[0].reset())
})})}),s.pages.VIP=s.Class.extend({initialize:function(){_.bindAll(this,"carouselLeft","carouselRight","startTimer","stopTimer","showModal","submitForm"),this.el={carousel:$("#vip .experience .carousel ul"),leftArrow:$("#vip .experience .left-arrow"),rightArrow:$("#vip .experience .right-arrow"),carouselItems:$("#vip .experience .carousel ul li"),wrapper:$("#vip .experience .right"),contact:$("#vip a.contact"),form:$("#vip-modal form")},this.el.inputs=this.el.form.find("input, select, textarea"),this.carouselIndex=0,this.carouselCount=this.el.carouselItems.length,this.carouselWidth=this.el.carouselItems.first().outerWidth(),this.el.leftArrow.click(this.carouselLeft),this.el.rightArrow.click(this.carouselRight),this.el.contact.click(this.showModal),this.el.form.submit(this.submitForm),this.modal=new s.Modal("#vip-modal"),this.el.wrapper.hover(this.stopTimer,this.startTimer),$(window).blur(this.stopTimer).focus(this.startTimer),this.startTimer()},startTimer:function(){clearInterval(this.carouselInterval),this.carouselInterval=setInterval(this.carouselRight,5e3)},stopTimer:function(){clearInterval(this.carouselInterval)},animateCarousel:function(){this.el.carousel.animate({left:-(this.carouselIndex*this.carouselWidth)})},carouselLeft:function(e){e&&e.preventDefault(),this.carouselIndex--,this.carouselIndex<0&&(this.carouselIndex=this.carouselCount-1),this.animateCarousel()},carouselRight:function(e){e&&e.preventDefault(),this.carouselIndex=(this.carouselIndex+1)%this.carouselCount,this.animateCarousel()},showModal:function(e){e.preventDefault(),window.scrollTo(0,0),this.modal.show(),$("#vip-modal input[name=first]").focus()},submitForm:function(e){e.preventDefault(),this.el.inputs.filter(".error").removeClass("error");var t=!1;if(this.el.inputs.each(function(){var e=($(this).val()||"").trim(),n=$(this).attr("name");("uniques"==n&&"--None--"==e||"email"==n&&!/\S+@\S+\.\S+/.test(e)||0==e.length&&"notes"!==n)&&($(this).addClass("error"),t=!0)}),t)this.el.inputs.filter(".error:first").focus().select();else{var n=this;this.el.form.find("button").attr("disabled","disabled"),$.ajax({type:"POST",url:s.api_url+"/users/vip_request",data:this.el.form.serialize(),headers:{"X-CSRF-Token":this.el.inputs.filter("[name=_csrfToken]").val()},success:function(){n.modal.hide(),n.el.inputs.filter(".error").removeClass("error"),n.el.form.find("button").removeAttr("disabled"),n.el.form[0].reset(),window.scrollTo(0,0),s.notify.success("Thanks! We'll get back to you as soon as possible.",{element:$("body"),duration:4e3})},error:function(){window.scrollTo(0,0),s.notify.error("Error submitting form. Please try again.",{element:$("#vip-modal"),duration:4e3})}})}}}),s.pages.MyStories=s.Class.extend({initialize:function(){_.bindAll(this,"resize","changeFilter","loadStories","showDeleteModal","hideDeleteModal","deleteStory","inputTitle"),this.el={window:$(window),filter:$("#my-stories .filters-menu .filter"),filtersDropdown:$("#my-stories .filters-dropdown select"),description:$("#my-stories .description"),stories:$("#my-stories .stories"),loadMoreButton:$("#my-stories button.load-more"),deleteStoryTitle:$("#delete-story-modal .story-title"),deleteStoryButton:$("#delete-story-button"),deleteCancelButton:$("#delete-story-cancel"),storyTitleInput:$("#delete-story-modal .story-title-input")},this.el.window.resize(this.resize),this.resize(),this.deleteModal=new s.Modal("#delete-story-modal"),this.filters={all:{page:1,more:this.el.loadMoreButton.length>0}},this.el.filter.click(this.changeFilter),this.el.filtersDropdown.change(this.changeFilter),this.el.loadMoreButton.click(this.loadStories),this.el.stories.delegate(".overlay .delete","click",this.showDeleteModal),this.el.deleteCancelButton.click(this.hideDeleteModal),this.el.storyTitleInput.bind("input",this.inputTitle),this.deleteStoryButton=new s.Button(this.el.deleteStoryButton,{click:this.deleteStory}),this.deleteStoryButton.disable()},resize:function(){var e=252,t=this.el.stories.not(".hidden"),n=t.width(),r=Math.floor(n/e);t.find(".story").css("width",n/r-30+"px")},changeFilter:function(e){var n,r=$(e.currentTarget);if(!r.hasClass("selected")){if(this.el.filter.removeClass("selected"),"SELECT"===r[0].nodeName?(n=r.val(),this.el.filter.filter('[data-filter="'+n+'"]').addClass("selected")):(n=r.data("filter"),r.addClass("selected"),this.el.filtersDropdown.val(n)),"private"===n){var i=this.el.filter.filter('[data-filter="private"]').data("enabled");this.el.description.html(t("filterDescription::private::"+(i?"enabled":"disabled")))}else this.el.description.html(t("filterDescription::"+n));this.el.stories.addClass("hidden"),this.el.stories.filter("."+n).removeClass("hidden"),this.filters[n]?(this.filters[n].more?this.el.loadMoreButton.removeClass("hidden"):this.el.loadMoreButton.addClass("hidden"),this.resize()):(this.filters[n]={page:0},this.loadStories(null,n))}},loadStories:function(e,n){var r=this,i=12,n=n||this.el.filter.filter(".selected").data("filter"),a=++this.filters[n].page,o="/stories/"+s.auth.user.username,l={username:s.auth.user.username,_token:s.auth.user._token,per_page:i,extra:!0,page:a,filter:n};this.el.loadMoreButton.addClass("hidden"),this.filters[n].more=!1,s.api.request("GET",o,l,{},function(e,a){if(e)s.notify.error(t("Error loading more stories"),{element:$("#content"),duration:4e3});else{var o=a.content.stories;if(_.each(o,function(e,t){if(i>t){var a=$(s.templates.render("story/_my-stories",{story:e,filter:n}));r.el.stories.filter("."+n).append(a)}else r.el.loadMoreButton.removeClass("hidden"),r.filters[n].more=!0}),0===o.length){var l='<div class="empty-state">'+t("emptyState::"+n)+"</div>";r.el.stories.filter("."+n).append(l)}r.resize()}})},showDeleteModal:function(e){this.selectedStory=$(e.currentTarget).parents(".story"),this.el.deleteStoryTitle.text(this.selectedStory.find(".title").text()),this.deleteModal.show(),this.el.storyTitleInput.val("").focus()},hideDeleteModal:function(){this.deleteModal.hide()},inputTitle:function(e){var t=$(e.target).val().trim().toLowerCase(),n=this.el.deleteStoryTitle.text().trim().toLowerCase();t===n?this.deleteStoryButton.enable():this.deleteStoryButton.disable()},deleteStory:function(){var e=this,n=this.selectedStory.attr("data-path"),r="/stories/"+n+"/delete",i={username:s.auth.user.username,_token:s.auth.user._token};s.api.request("POST",r,i,{},function(r){if(r){var i=t("Error while deleting story");i+=r.error&&r.error.message?" : "+t(r.error.message)+".":".",s.notify.error(i,{element:$("#content"),duration:4e3})}else s.notify.success(t("Your story has been deleted"),{element:$("#content"),duration:4e3}),e.selectedStory.fadeOut(800),setTimeout(function(){e.el.stories.find('[data-path="'+n+'"]').addClass("hidden")},800);e.deleteModal.hide()})}}),s.pages.Browse=s.Class.extend({initialize:function(){_.bindAll(this,"resize"),this.el={window:$(window),stories:$("#browse .stories"),story:$("#browse .story")},this.el.window.resize(this.resize),this.resize()},resize:function(){var e=252,t=this.el.stories.width(),n=Math.floor(t/e);this.el.story.css("width",t/n-30+"px")}});

//@ sourceMappingURL=3.2.81-production-01175131-ec6a9998739080326a53fe04c487dc6b.js.map